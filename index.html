<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Premium Shop</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg-color: var(--tg-theme-bg-color, #fff);
            --text-color: var(--tg-theme-text-color, #222);
            --hint-color: var(--tg-theme-hint-color, #999);
            --button-color: var(--tg-theme-button-color, #3390ec);
            --button-text: var(--tg-theme-button-text-color, #fff);
            --secondary-bg: var(--tg-theme-secondary-bg-color, #f4f4f5);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--secondary-bg);
            color: var(--text-color);
            margin: 0; padding: 0;
            user-select: none;
        }

        /* Header & Navigation */
        .header {
            background: var(--bg-color);
            padding: 15px;
            text-align: center;
            font-weight: bold;
            border-bottom: 1px solid rgba(0,0,0,0.1);
            position: sticky; top: 0; z-index: 100;
        }

        .container { padding: 15px; padding-bottom: 80px; }

        /* Cards */
        .card {
            background: var(--bg-color);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        .category-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 10px;
        }

        .btn {
            display: block; width: 100%; padding: 12px;
            border-radius: 10px; border: none;
            background: var(--button-color); color: var(--button-text);
            font-weight: 600; cursor: pointer; text-align: center;
            text-decoration: none; margin-top: 10px;
        }

        .btn-outline {
            background: transparent; color: var(--button-color);
            border: 1px solid var(--button-color);
        }

        /* Bottom Menu */
        .bottom-nav {
            position: fixed; bottom: 0; width: 100%;
            background: var(--bg-color);
            display: flex; justify-content: space-around;
            padding: 10px 0; border-top: 1px solid rgba(0,0,0,0.1);
        }

        .nav-item {
            font-size: 12px; color: var(--hint-color);
            text-align: center; cursor: pointer;
        }

        .nav-item.active { color: var(--button-color); }

        .hidden { display: none; }

        input, select, textarea {
            width: 100%; padding: 10px; margin: 5px 0;
            border-radius: 8px; border: 1px solid #ddd;
            background: var(--bg-color); color: var(--text-color);
            box-sizing: border-box;
        }

        .badge {
            font-size: 10px; padding: 2px 6px; border-radius: 4px;
            background: #e1f5fe; color: #01579b; margin-left: 5px;
        }
    </style>
</head>
<body>

    <div class="header" id="page-title">–ú–∞–≥–∞–∑–∏–Ω</div>

    <div class="container" id="app">
        <div id="view-main">
            <h3 style="margin-top:0">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</h3>
            <div class="category-grid" id="cat-list"></div>
        </div>

        <div id="view-products" class="hidden">
            <div id="prod-list"></div>
        </div>

        <div id="view-profile" class="hidden">
            <div class="card" style="text-align: center;">
                <img id="user-photo" src="" style="width: 80px; border-radius: 50%; display: none; margin: 0 auto 10px;">
                <h2 id="user-name" style="margin:0">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</h2>
                <p id="user-id" style="color: var(--hint-color); font-size: 14px;"></p>
            </div>
            <h3>–ò—Å—Ç–æ—Ä–∏—è –ø–æ–∫—É–ø–æ–∫</h3>
            <div id="order-history"></div>
        </div>

        <div id="view-payment" class="hidden">
            <div class="card">
                <h3>–û–ø–ª–∞—Ç–∞ –∑–∞–∫–∞–∑–∞</h3>
                <p id="pay-info"></p>
                <div style="background: #fffbe6; padding: 10px; border-radius: 8px; border: 1px solid #ffe58f; font-size: 14px;">
                    –†–µ–∫–≤–∏–∑–∏—Ç—ã: <b>4444 0000 1111 2222</b><br>–ü–æ–ª—É—á–∞—Ç–µ–ª—å: –ò–≤–∞–Ω –ò.
                </div>
                <p style="font-size: 13px; color: var(--hint-color);">–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç —á–µ–∫–∞ –Ω–∏–∂–µ:</p>
                <input type="file" id="receipt-file" accept="image/*">
                <button class="btn" onclick="processPayment()">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –æ–ø–ª–∞—Ç—É</button>
            </div>
        </div>

        <div id="view-admin" class="hidden">
            <div class="card">
                <h4>‚ûï –ù–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è</h4>
                <input type="text" id="adm-cat-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ">
                <button class="btn" onclick="addCategory()">–°–æ–∑–¥–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</button>
            </div>
            <div class="card">
                <h4>‚ûï –ù–æ–≤—ã–π —Ç–æ–≤–∞—Ä</h4>
                <input type="text" id="adm-prod-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ">
                <input type="number" id="adm-prod-price" placeholder="–¶–µ–Ω–∞ (—Ä—É–±)">
                <select id="adm-prod-cat"></select>
                <button class="btn" onclick="addProduct()">–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</button>
            </div>
        </div>
    </div>

    <div class="bottom-nav">
        <div class="nav-item active" onclick="switchTab('main')">üè†<br>–ú–∞–≥–∞–∑–∏–Ω</div>
        <div class="nav-item" onclick="switchTab('profile')">üë§<br>–ü—Ä–æ—Ñ–∏–ª—å</div>
        <div class="nav-item hidden" id="admin-tab" onclick="switchTab('admin')">‚öôÔ∏è<br>–ê–¥–º–∏–Ω</div>
    </div>

    <script>
        let tg = window.Telegram.WebApp;
        tg.expand();
        tg.headerColor = tg.themeParams.bg_color;

        const ADMIN_USERNAME = "–í–ê–®_–õ–û–ì–ò–ù_–ë–ï–ó_–°–û–ë–ê–ß–ö–ò"; // –í—Å—Ç–∞–≤—å—Ç–µ —Å—é–¥–∞ –≤–∞—à —é–∑–µ—Ä–Ω–µ–π–º –¥–ª—è —Å–≤—è–∑–∏

        // –î–∞–Ω–Ω—ã–µ (–∏–º–∏—Ç–∞—Ü–∏—è –ë–î)
        let state = JSON.parse(localStorage.getItem('store_db')) || {
            categories: [{id: 1, name: "–°–æ—Ñ—Ç"}],
            products: [{id: 101, catId: 1, name: "VPN Premium", price: 500}],
            orders: []
        };

        function save() {
            localStorage.setItem('store_db', JSON.stringify(state));
            render();
        }

        function switchTab(tab) {
            document.querySelectorAll('#app > div').forEach(el => el.classList.add('hidden'));
            document.getElementById('view-' + tab).classList.remove('hidden');
            document.getElementById('page-title').innerText = tab === 'main' ? '–ú–∞–≥–∞–∑–∏–Ω' : tab.toUpperCase();
            
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            // –ü—Ä–æ—Å—Ç–∞—è –ª–æ–≥–∏–∫–∞ –ø–æ–¥—Å–≤–µ—Ç–∫–∏
            if(tab === 'main') document.querySelectorAll('.nav-item')[0].classList.add('active');
            if(tab === 'profile') document.querySelectorAll('.nav-item')[1].classList.add('active');
        }

        function render() {
            // –ö–∞—Ç–µ–≥–æ—Ä–∏–∏
            const catList = document.getElementById('cat-list');
            const admSelect = document.getElementById('adm-prod-cat');
            catList.innerHTML = ''; admSelect.innerHTML = '';
            
            state.categories.forEach(c => {
                catList.innerHTML += `<div class="card" onclick="showProducts(${c.id}, '${c.name}')"><b>${c.name}</b></div>`;
                admSelect.innerHTML += `<option value="${c.id}">${c.name}</option>`;
            });

            // –ü—Ä–æ—Ñ–∏–ª—å
            if(tg.initDataUnsafe.user) {
                const user = tg.initDataUnsafe.user;
                document.getElementById('user-name').innerText = user.first_name;
                document.getElementById('user-id').innerText = "@" + (user.username || "id" + user.id);
                // –ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –≤–∏–¥–µ—Ç—å –∞–¥–º–∏–Ω–∫—É (–ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ ID –∏–ª–∏ username)
                if(user.username === ADMIN_USERNAME) {
                    document.getElementById('admin-tab').classList.remove('hidden');
                }
            }

            // –ò—Å—Ç–æ—Ä–∏—è
            const historyList = document.getElementById('order-history');
            historyList.innerHTML = state.orders.length ? '' : '<p style="color:gray; text-align:center">–ù–µ—Ç –ø–æ–∫—É–ø–æ–∫</p>';
            state.orders.forEach(o => {
                historyList.innerHTML += `<div class="card" style="font-size:14px">üõç ${o.item}<br><small>${o.date}</small> <span class="badge">${o.status}</span></div>`;
            });
        }

        function showProducts(catId, name) {
            switchTab('products');
            document.getElementById('page-title').innerText = name;
            const list = document.getElementById('prod-list');
            list.innerHTML = `<button class="btn btn-outline" onclick="switchTab('main')" style="margin-bottom:15px">‚¨Ö –ù–∞–∑–∞–¥</button>`;
            
            state.products.filter(p => p.catId === catId).forEach(p => {
                list.innerHTML += `
                    <div class="card">
                        <div style="display:flex; justify-content:space-between; align-items:center">
                            <b>${p.name}</b>
                            <span style="font-weight:bold; color:var(--button-color)">${p.price} ‚ÇΩ</span>
                        </div>
                        <button class="btn" onclick="startPay('${p.name}', ${p.price})">–ö—É–ø–∏—Ç—å</button>
                    </div>`;
            });
        }

        function startPay(name, price) {
            switchTab('payment');
            document.getElementById('pay-info').innerHTML = `–¢–æ–≤–∞—Ä: <b>${name}</b><br>–ö –æ–ø–ª–∞—Ç–µ: <b>${price} ‚ÇΩ</b>`;
            window.tempOrder = { name, price };
        }

        function processPayment() {
            const fileInput = document.getElementById('receipt-file');
            if(!fileInput.files[0]) {
                tg.showAlert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–∏–∫—Ä–µ–ø–∏—Ç–µ —Ñ–æ—Ç–æ —á–µ–∫–∞!");
                return;
            }

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é
            state.orders.unshift({
                item: window.tempOrder.name,
                price: window.tempOrder.price,
                date: new Date().toLocaleDateString(),
                status: "–ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è"
            });
            save();

            // –§–æ—Ä–º–∏—Ä—É–µ–º —Å—Å—ã–ª–∫—É –¥–ª—è –ø–µ—Ä–µ–Ω–æ—Å–∞ –≤ –õ–° –∫ –∞–¥–º–∏–Ω—É
            const messageText = encodeURIComponent(
                `üëã –ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –Ø –æ–ø–ª–∞—Ç–∏–ª –∑–∞–∫–∞–∑.\n\n` +
                `üì¶ –¢–æ–≤–∞—Ä: ${window.tempOrder.name}\n` +
                `üí∞ –¶–µ–Ω–∞: ${window.tempOrder.price} —Ä—É–±.\n` +
                `üñº –°–∫—Ä–∏–Ω—à–æ—Ç —á–µ–∫–∞ –ø—Ä–∏–ª–∞–≥–∞—é.`
            );
            
            const adminLink = `https://t.me/${ADMIN_USERNAME}?text=${messageText}`;

            tg.showConfirm("–î–∞–Ω–Ω—ã–µ –ø—Ä–∏–Ω—è—Ç—ã! –¢–µ–ø–µ—Ä—å –Ω—É–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É –≤ –õ–°. –ü–µ—Ä–µ–π—Ç–∏?", (ok) => {
                if(ok) {
                    tg.openTelegramLink(adminLink);
                    tg.close();
                }
            });
        }

        // –ê–¥–º–∏–Ω —Ñ—É–Ω–∫—Ü–∏–∏
        function addCategory() {
            const val = document.getElementById('adm-cat-name').value;
            if(val) { state.categories.push({id: Date.now(), name: val}); save(); }
        }

        function addProduct() {
            const name = document.getElementById('adm-prod-name').value;
            const price = document.getElementById('adm-prod-price').value;
            const catId = parseInt(document.getElementById('adm-prod-cat').value);
            if(name && price) {
                state.products.push({id: Date.now(), catId, name, price});
                save();
            }
        }

        render();
    </script>
</body>
</html>
