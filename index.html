<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Zikrov Digital Store Premium</title>

    <!-- –í–Ω–µ—à–Ω–∏–µ SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

    <style>
        /* 
        ========================================================================
        1. –î–ò–ó–ê–ô–ù-–°–ò–°–¢–ï–ú–ê –ò –¢–ï–ú–ê–¢–ò–ó–ê–¶–ò–Ø (APPLE / TELEGRAM STYLE)
        ========================================================================
        */
        :root {
            --bg-page: #f2f2f7;
            --bg-card: #ffffff;
            --text-main: #1c1c1e;
            --text-hint: #8e8e93;
            --accent: #007aff;
            --accent-soft: rgba(0, 122, 255, 0.1);
            --border: #d1d1d6;
            --success: #34c759;
            --warning: #ff9500;
            --error: #ff3b30;
            --radius-xl: 30px;
            --radius-lg: 20px;
            --radius-md: 14px;
            --shadow-sm: 0 2px 8px rgba(0,0,0,0.04);
            --shadow-md: 0 10px 30px rgba(0,0,0,0.06);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --safe-bottom: env(safe-area-inset-bottom);
        }

        /* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç–µ–º–Ω–æ–π —Ç–µ–º—ã Telegram */
        @media (prefers-color-scheme: dark) {
            :root {
                --bg-page: #000000;
                --bg-card: #1c1c1e;
                --text-main: #ffffff;
                --text-hint: #98989d;
                --border: #2c2c2e;
                --shadow-md: 0 10px 40px rgba(0,0,0,0.4);
            }
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            outline: none;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-page);
            color: var(--text-main);
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
        }

        /* 
        ========================================================================
        2. –û–°–ù–û–í–ù–´–ï –ö–û–ù–¢–ï–ô–ù–ï–†–´ –ò –†–û–£–¢–ò–ù–ì
        ========================================================================
        */
        .app-container {
            max-width: 600px;
            margin: 0 auto;
            min-height: 100vh;
            padding: 20px 16px 140px;
            position: relative;
        }

        .page {
            display: none;
            width: 100%;
            animation: fadeIn 0.4s ease-out;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* 
        ========================================================================
        3. –¢–ò–ü–û–ì–†–ê–§–ò–ö–ê
        ========================================================================
        */
        h1 { font-size: 34px; font-weight: 800; margin: 0 0 8px; letter-spacing: -1px; }
        h2 { font-size: 22px; font-weight: 700; margin: 30px 0 15px; letter-spacing: -0.5px; }
        .sub-header { font-size: 16px; color: var(--text-hint); margin-bottom: 25px; }
        .section-label { font-size: 11px; font-weight: 800; text-transform: uppercase; color: var(--text-hint); letter-spacing: 1px; margin: 25px 4px 10px; display: block; }

        /* 
        ========================================================================
        4. –ö–ù–û–ü–ö–ò, –ö–ê–†–¢–û–ß–ö–ò, –ò–ù–ü–£–¢–´
        ========================================================================
        */
        .card {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: 24px;
            margin-bottom: 16px;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border);
            transition: var(--transition);
        }

        .card:active {
            transform: scale(0.98);
        }

        .btn {
            background: var(--accent);
            color: #ffffff;
            border: none;
            padding: 16px 24px;
            border-radius: var(--radius-md);
            font-size: 17px;
            font-weight: 700;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            cursor: pointer;
            transition: var(--transition);
        }

        .btn:active {
            opacity: 0.8;
            transform: scale(0.96);
        }

        .btn-secondary { background: var(--border); color: var(--text-main); }
        .btn-outline { background: transparent; border: 2px solid var(--border); color: var(--text-main); }
        .btn-danger { color: var(--error); border-color: var(--error); background: transparent; }
        .btn-sm { padding: 10px 18px; font-size: 14px; border-radius: 12px; width: auto; }

        input, select, textarea {
            width: 100%;
            padding: 14px 16px;
            border-radius: var(--radius-md);
            border: 1.5px solid var(--border);
            background: var(--bg-card);
            color: var(--text-main);
            font-size: 16px;
            outline: none;
            margin-bottom: 15px;
        }

        input:focus { border-color: var(--accent); }

        .search-container {
            position: relative;
            margin-bottom: 25px;
        }

        .search-container input {
            padding-left: 50px;
            border: none;
            box-shadow: var(--shadow-md);
            margin-bottom: 0;
        }

        .search-icon {
            position: absolute;
            left: 18px; top: 14px;
            font-size: 20px;
            opacity: 0.5;
        }

        /* 
        ========================================================================
        5. –ù–ê–í–ò–ì–ê–¶–ò–Ø (TAB BAR)
        ========================================================================
        */
        .nav-bar {
            position: fixed;
            bottom: 0; left: 0; right: 0;
            background: rgba(var(--bg-card), 0.85);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            display: flex;
            padding: 12px 0 calc(12px + var(--safe-bottom));
            border-top: 0.5px solid var(--border);
            z-index: 2000;
        }

        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            color: var(--text-hint);
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            cursor: pointer;
            transition: color 0.2s;
        }

        .nav-item.active {
            color: var(--accent);
        }

        .nav-icon { font-size: 24px; }

        /* 
        ========================================================================
        6. –°–ü–ï–¶–ò–ê–õ–¨–ù–´–ï –≠–õ–ï–ú–ï–ù–¢–´ (–ú–ê–ì–ê–ó–ò–ù)
        ========================================================================
        */
        .categories-row {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding: 10px 0 25px;
            margin: 0 -16px;
            padding-left: 16px;
            scrollbar-width: none;
        }
        .categories-row::-webkit-scrollbar { display: none; }

        .chip {
            background: var(--bg-card);
            padding: 10px 22px;
            border-radius: 30px;
            font-size: 14px;
            font-weight: 700;
            white-space: nowrap;
            border: 1.5px solid var(--border);
            color: var(--text-hint);
            transition: var(--transition);
        }

        .chip.active {
            background: var(--text-main);
            color: var(--bg-page);
            border-color: var(--text-main);
        }

        .price-text {
            font-size: 22px;
            font-weight: 900;
            color: var(--accent);
        }

        /* 
        ========================================================================
        7. –ê–î–ú–ò–ù-–ü–ê–ù–ï–õ–¨ (–ê–ù–ê–õ–ò–¢–ò–ö–ê)
        ========================================================================
        */
        .analytics-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: var(--bg-card);
            padding: 20px;
            border-radius: var(--radius-lg);
            border: 1px solid var(--border);
            text-align: center;
        }

        .stat-val { font-size: 26px; font-weight: 900; color: var(--accent); }
        .stat-lbl { font-size: 11px; font-weight: 700; color: var(--text-hint); text-transform: uppercase; margin-top: 5px; }

        .status-badge {
            padding: 5px 12px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 800;
            text-transform: uppercase;
        }
        .status-review { background: rgba(255, 149, 0, 0.1); color: var(--warning); }
        .status-done { background: rgba(52, 199, 89, 0.1); color: var(--success); }
        .status-reject { background: rgba(255, 59, 48, 0.1); color: var(--error); }

        /* 
        ========================================================================
        8. –°–ò–°–¢–ï–ú–ù–´–ï –≠–õ–ï–ú–ï–ù–¢–´ (–õ–û–ê–î–ï–†, –¢–û–°–¢–´)
        ========================================================================
        */
        #global-loader {
            position: fixed; inset: 0;
            background: var(--bg-page);
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            z-index: 5000;
        }

        .loading-spinner {
            width: 44px; height: 44px;
            border: 4px solid var(--border);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: rotate 1s linear infinite;
        }

        @keyframes rotate { to { transform: rotate(360deg); } }

        #toast {
            position: fixed;
            top: 30px; left: 50%;
            transform: translateX(-50%) translateY(-100px);
            background: var(--text-main);
            color: var(--bg-page);
            padding: 12px 24px;
            border-radius: 40px;
            font-weight: 700;
            font-size: 14px;
            z-index: 6000;
            box-shadow: var(--shadow-md);
            transition: transform 0.4s cubic-bezier(0.18, 0.89, 0.32, 1.28);
        }
        #toast.active { transform: translateX(-50%) translateY(0); }

        .hidden { display: none !important; }

        .image-preview {
            width: 100%;
            border-radius: 14px;
            margin: 15px 0;
            border: 1px solid var(--border);
            cursor: pointer;
            box-shadow: var(--shadow-sm);
        }

        .data-box {
            background: var(--bg-page);
            padding: 16px;
            border-radius: var(--radius-md);
            border: 1.5px dashed var(--border);
            font-family: "SF Mono", monospace;
            font-size: 13px;
            word-break: break-all;
            margin-top: 15px;
        }

    </style>
</head>
<body>

    <!-- –≠–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <div id="global-loader">
        <div class="loading-spinner"></div>
        <p style="margin-top: 20px; font-weight: 800; color: var(--text-hint);">–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º...</p>
        <button id="safety-btn" class="btn btn-sm btn-outline hidden" style="margin-top: 20px;" onclick="forceCloseLoader()">–í–æ–π—Ç–∏ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ</button>
    </div>

    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
    <div id="toast">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ</div>

    <div class="app-container">

        <!-- –°–¢–†–ê–ù–ò–¶–ê 1: –ì–õ–ê–í–ù–ê–Ø (–í–ò–¢–†–ò–ù–ê) -->
        <section id="page-shop" class="page active">
            <h1>–í–∏—Ç—Ä–∏–Ω–∞</h1>
            <p class="sub-header">–õ—É—á—à–∏–µ —Ü–∏—Ñ—Ä–æ–≤—ã–µ —Ç–æ–≤–∞—Ä—ã –∏ –∞–∫–∫–∞—É–Ω—Ç—ã.</p>

            <div class="search-container">
                <span class="search-icon">üîç</span>
                <input type="text" id="shop-search-input" placeholder="–ù–∞–π—Ç–∏ –ø—Ä–æ–¥—É–∫—Ç..." oninput="handleSearch()">
            </div>

            <div class="categories-row" id="shop-categories-container">
                <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ–¥–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>

            <div id="shop-products-grid">
                <!-- –¢–æ–≤–∞—Ä—ã –ø–æ–¥–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </section>

        <!-- –°–¢–†–ê–ù–ò–¶–ê 2: –û–ü–õ–ê–¢–ê (–ß–ï–ö–ê–£–¢) -->
        <section id="page-checkout" class="page">
            <div style="display:flex; align-items:center; gap:15px; margin-bottom:30px;">
                <button class="btn btn-secondary btn-sm" onclick="navigateTo('shop')">‚Üê –ù–∞–∑–∞–¥</button>
                <h1 style="margin:0;">–û–ø–ª–∞—Ç–∞</h1>
            </div>

            <div class="card">
                <span class="section-label" style="margin-top:0;">–í–∞—à–∏ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã</span>
                <div id="checkout-reks-display" style="font-size:18px; font-weight:700; background:rgba(0,0,0,0.03); padding:20px; border-radius:16px; white-space:pre-wrap; margin:10px 0;"></div>
                <div style="display:flex; justify-content:space-between; align-items:center; margin-top:25px;">
                    <span style="font-weight:700; font-size:17px;">–ò—Ç–æ–≥–æ –∫ –æ–ø–ª–∞—Ç–µ:</span>
                    <span class="price-text" id="checkout-total-display">0 ‚ÇΩ</span>
                </div>
            </div>

            <div class="card">
                <span class="section-label" style="margin-top:0;">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</span>
                <p style="font-size:14px; margin-bottom:15px; color: var(--text-hint);">–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç —á–µ–∫–∞. –ú—ã –ø—Ä–æ–≤–µ—Ä–∏–º –æ–ø–ª–∞—Ç—É –∏ –≤—ã–¥–∞–¥–∏–º —Ç–æ–≤–∞—Ä –≤ —Ç–µ—á–µ–Ω–∏–µ 15 –º–∏–Ω—É—Ç.</p>
                <input type="file" id="checkout-file-picker" accept="image/*">
                <button class="btn" style="margin-top:25px;" onclick="submitNewOrder()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É</button>
            </div>
        </section>

        <!-- –°–¢–†–ê–ù–ò–¶–ê 3: –ò–°–¢–û–†–ò–Ø –ó–ê–ö–ê–ó–û–í -->
        <section id="page-history" class="page">
            <h1>–ú–æ–∏ –ø–æ–∫—É–ø–∫–∏</h1>
            <p class="sub-header">–ò—Å—Ç–æ—Ä–∏—è –≤–∞—à–∏—Ö –∑–∞–∫–∞–∑–æ–≤ –∏ –∫–ª—é—á–∏ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏.</p>
            <div id="history-container">
                <!-- –ó–∞–∫–∞–∑—ã –ø–æ–¥–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </section>

        <!-- –°–¢–†–ê–ù–ò–¶–ê 4: –ü–†–û–§–ò–õ–¨ -->
        <section id="page-profile" class="page">
            <h1>–ü—Ä–æ—Ñ–∏–ª—å</h1>
            <div class="card" style="text-align:center;">
                <div id="user-avatar" style="width:90px; height:90px; background:var(--accent); color:#fff; border-radius:50%; margin:0 auto 20px; display:flex; align-items:center; justify-content:center; font-size:36px; font-weight:900;">U</div>
                <div style="font-size:24px; font-weight:800;" id="user-display-name">User</div>
                <p class="sub-header" id="user-display-id" style="margin-top:5px;">ID: 00000000</p>
            </div>
            
            <h2 style="margin-top: 40px;">–ü–æ–º–æ—â—å</h2>
            <div class="card" onclick="openSupportLink()">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <div style="font-weight:700; font-size:17px;">–ù–∞–ø–∏—Å–∞—Ç—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É</div>
                    <span style="color:var(--text-hint); font-size:20px;">‚Üí</span>
                </div>
            </div>
        </section>

        <!-- –°–¢–†–ê–ù–ò–¶–ê 5: –ê–î–ú–ò–ù –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø -->
        <section id="page-admin-auth" class="page">
            <h1>–í—Ö–æ–¥ –≤ –ø–∞–Ω–µ–ª—å</h1>
            <div class="card">
                <label class="section-label">–ö–ª—é—á –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</label>
                <input type="password" id="admin-login-pass" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å...">
                <button class="btn" style="margin-top:20px;" onclick="authenticateAdmin()">–í–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É</button>
            </div>
        </section>

        <!-- –°–¢–†–ê–ù–ò–¶–ê 6: –ê–î–ú–ò–ù –ö–û–ù–°–û–õ–¨ -->
        <section id="page-admin-dashboard" class="page">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                <h1 style="margin:0">–ö–æ–Ω—Å–æ–ª—å</h1>
                <button class="btn btn-secondary btn-sm" onclick="logoutAdmin()">–í—ã–π—Ç–∏</button>
            </div>

            <!-- –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ -->
            <div class="analytics-grid">
                <div class="stat-card">
                    <div class="stat-val" id="adm-stat-revenue">0 ‚ÇΩ</div>
                    <div class="stat-lbl">–î–æ—Ö–æ–¥</div>
                </div>
                <div class="stat-card">
                    <div class="stat-val" id="adm-stat-sales">0</div>
                    <div class="stat-lbl">–ó–∞–∫–∞–∑—ã</div>
                </div>
            </div>

            <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –°–∏—Å—Ç–µ–º—ã -->
            <div class="card">
                <h2 style="margin-top:0;">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –°–∏—Å—Ç–µ–º—ã</h2>
                
                <label class="section-label">–†–µ–∫–≤–∏–∑–∏—Ç—ã –ø–ª–∞—Ç–µ–∂–µ–π</label>
                <textarea id="adm-set-reks" rows="3" placeholder="–ö–∞—Ä—Ç–∞ –°–±–µ—Ä–∞, –°–ë–ü, USDT TRC20..."></textarea>

                <label class="section-label">–Æ–∑–µ—Ä–Ω–µ–π–º –ø–æ–¥–¥–µ—Ä–∂–∫–∏ (–±–µ–∑ @)</label>
                <input type="text" id="adm-set-support" placeholder="zikrov_support">

                <label class="section-label">ImgBB API –ö–ª—é—á</label>
                <input type="text" id="adm-set-imgbb" placeholder="–í–∞—à –∫–ª—é—á —Å api.imgbb.com">

                <label class="section-label">Telegram Bot Token</label>
                <input type="text" id="adm-set-token" placeholder="6833... –æ—Ç @BotFather">

                <label class="section-label">–í–∞—à Telegram ID</label>
                <input type="text" id="adm-set-chatid" placeholder="ID –∏–∑ @userinfobot">

                <label class="section-label">Lolz Market Token</label>
                <input type="text" id="adm-set-lolz" placeholder="–¢–æ–∫–µ–Ω —Å lzt.market/account/api">

                <label class="section-label">–°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è –∞–¥–º–∏–Ω–∞</label>
                <input type="text" id="adm-set-pass" placeholder="–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å (–ø—É—Å—Ç–æ = –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)">

                <button class="btn btn-sm" style="margin-top:20px;" onclick="saveSystemSettings()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é</button>
            </div>

            <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ -->
            <div class="card">
                <h2>–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</h2>
                <div style="display:flex; gap:10px; margin-bottom:20px;">
                    <input type="text" id="adm-new-cat-input" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ...">
                    <button class="btn btn-sm" onclick="adminAddCategory()">–î–æ–±–∞–≤–∏—Ç—å</button>
                </div>
                <div id="adm-categories-list">
                    <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
                </div>
            </div>

            <!-- –°–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ -->
            <div class="card">
                <h2>–ù–æ–≤—ã–π —Ç–æ–≤–∞—Ä</h2>
                <div class="input-group">
                    <label class="section-label">–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞</label>
                    <input type="text" id="adm-prod-name">
                </div>
                <div class="input-group">
                    <label class="section-label">–°—Ç–æ–∏–º–æ—Å—Ç—å (RUB)</label>
                    <input type="number" id="adm-prod-price">
                </div>
                <div class="input-group">
                    <label class="section-label">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</label>
                    <select id="adm-prod-cat-select"></select>
                </div>
                <div class="input-group">
                    <label class="section-label">–ú–µ—Ç–æ–¥ –ø–æ—Å—Ç–∞–≤–∫–∏</label>
                    <select id="adm-prod-type-select" onchange="toggleAdminProductFields()">
                        <option value="text">–¢–µ–∫—Å—Ç (–ö–ª—é—á–∏ / –ê–∫–∫–∞—É–Ω—Ç—ã)</option>
                        <option value="file">–§–∞–π–ª (–°—Å—ã–ª–∫–∞ –Ω–∞ –æ–±–ª–∞–∫–æ)</option>
                        <option value="lolz">Lolz Market (API –ê–≤—Ç–æ–≤—ã–∫—É–ø)</option>
                    </select>
                </div>
                <div id="adm-field-manual">
                    <label class="section-label">–°–æ–¥–µ—Ä–∂–∏–º–æ–µ (–≤—ã–¥–∞–µ—Ç—Å—è —é–∑–µ—Ä—É)</label>
                    <textarea id="adm-prod-data" rows="3" placeholder="–î–∞–Ω–Ω—ã–µ –∞–∫–∫–∞—É–Ω—Ç–∞ –∏–ª–∏ –∫–ª—é—á..."></textarea>
                </div>
                <div id="adm-field-lolz" class="hidden">
                    <label class="section-label">Lolz Search URL (–°—Å—ã–ª–∫–∞ –∏–∑ –ø–æ–∏—Å–∫–∞)</label>
                    <input type="text" id="adm-prod-lolz-url" placeholder="https://lzt.market/telegram/...">
                </div>
                <button class="btn" style="margin-top:20px;" onclick="adminAddProduct()">–°–æ–∑–¥–∞—Ç—å –∏ –æ–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
            </div>

            <h2>–ó–∞–∫–∞–∑—ã –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏</h2>
            <div id="adm-orders-review-list">
                <!-- –û–∂–∏–¥–∞—é—â–∏–µ –∑–∞–∫–∞–∑—ã -->
            </div>

            <h2>–ë–∞–∑–∞ —Ç–æ–≤–∞—Ä–æ–≤</h2>
            <div id="adm-inventory-list">
                <!-- –í—Å–µ —Ç–æ–≤–∞—Ä—ã -->
            </div>
        </section>

    </div>

    <!-- –¢–ê–ë-–ë–ê–† -->
    <nav class="nav-bar">
        <div class="nav-item active" onclick="navigateTo('shop')">
            <span class="nav-icon">üõçÔ∏è</span>
            <span>–ú–∞–≥–∞–∑–∏–Ω</span>
        </div>
        <div class="nav-item" onclick="navigateTo('history')">
            <span class="nav-icon">üì¶</span>
            <span>–ó–∞–∫–∞–∑—ã</span>
        </div>
        <div class="nav-item" onclick="navigateTo('profile')">
            <span class="nav-icon">üë§</span>
            <span>–ü—Ä–æ—Ñ–∏–ª—å</span>
        </div>
        <div class="nav-item" id="nav-adm-link" onclick="navigateTo('admin')">
            <span class="nav-icon">‚öôÔ∏è</span>
            <span>–ê–¥–º–∏–Ω</span>
        </div>
    </nav>

    <script>
        /* 
        ========================================================================
        9. FIREBASE –ò –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –ë–ê–ó–´ –î–ê–ù–ù–´–•
        ========================================================================
        */
        
        // –í–ê–®–ò –ò–ù–î–ò–í–ò–î–£–ê–õ–¨–ù–´–ï –ö–õ–Æ–ß–ò:
        const firebaseConfig = {
            apiKey: "AIzaSyApyvMlfHcFqPt1ROpnqCPXjgkuUjV1hus",
            databaseURL: "https://zikrov09-default-rtdb.firebaseio.com",
            projectId: "zikrov09",
        };

        // –ó–∞—â–∏—Ç–∞ –æ—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–≥–æ –ª–æ–∞–¥–µ—Ä–∞ (5 —Å–µ–∫—É–Ω–¥ —Ç–∞–π–º–∞—É—Ç)
        const loaderSafetyTimer = setTimeout(() => {
            document.getElementById('safety-btn').classList.remove('hidden');
            document.querySelector('#global-loader p').innerText = "–ü—Ä–æ–±–ª–µ–º–∞ —Å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ–º Firebase. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ VPN –∏–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–∞–∑—ã.";
        }, 6000);

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—ä–µ–∫—Ç –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        let appData = {
            products: {},
            categories: {},
            orders: {},
            settings: {},
            activeCat: 'all',
            search: ''
        };

        const tgWebApp = window.Telegram.WebApp;
        const tgUser = tgWebApp.initDataUnsafe?.user || { id: 8888888, first_name: 'Zikrov User' };
        let currentPurchaseId = null;

        /* 
        ========================================================================
        10. –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ò –ü–û–õ–£–ß–ï–ù–ò–ï –î–ê–ù–ù–´–•
        ========================================================================
        */
        document.addEventListener('DOMContentLoaded', () => {
            tgWebApp.expand();
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è
            document.getElementById('user-display-name').innerText = tgUser.first_name;
            document.getElementById('user-display-id').innerText = `ID: ${tgUser.id}`;
            document.getElementById('user-avatar').innerText = tgUser.first_name[0].toUpperCase();

            // Real-time —Å–ª—É—à–∞—Ç–µ–ª—å –≤—Å–µ–π –±–∞–∑—ã
            database.ref('/').on('value', snapshot => {
                clearTimeout(loaderSafetyTimer); // –ë–∞–∑–∞ –æ—Ç–≤–µ—Ç–∏–ª–∞, —É–±–∏—Ä–∞–µ–º —Ç–∞–π–º–∞—É—Ç
                
                const data = snapshot.val() || {};
                appData.products = data.products || {};
                appData.categories = data.categories || {};
                appData.orders = data.orders || {};
                appData.settings = data.settings || {};

                renderStoreContent();
                renderOrdersHistory();
                
                if (sessionStorage.getItem('isAdminAuthorized')) {
                    renderAdminInterface();
                }

                hideLoader();
            }, (error) => {
                console.error("Firebase Error: ", error);
            });
        });

        /* 
        ========================================================================
        11. –†–û–£–¢–ò–ù–ì –ò –ù–ê–í–ò–ì–ê–¶–ò–Ø
        ========================================================================
        */
        function navigateTo(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));

            let targetId = `page-${pageId}`;
            if (pageId === 'admin') {
                targetId = sessionStorage.getItem('isAdminAuthorized') ? 'page-admin-dashboard' : 'page-admin-auth';
            }

            document.getElementById(targetId).classList.add('active');
            
            const navMap = { 'shop': 0, 'history': 1, 'profile': 2, 'admin': 3 };
            document.querySelectorAll('.nav-item')[navMap[pageId]].classList.add('active');
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function forceCloseLoader() {
            hideLoader();
        }

        function hideLoader() {
            const l = document.getElementById('global-loader');
            l.style.opacity = '0';
            setTimeout(() => l.style.display = 'none', 500);
        }

        function showStatusToast(message) {
            const toast = document.getElementById('toast');
            toast.innerText = message;
            toast.classList.add('active');
            setTimeout(() => toast.classList.remove('active'), 3000);
        }

        /* 
        ========================================================================
        12. –õ–û–ì–ò–ö–ê –ú–ê–ì–ê–ó–ò–ù–ê (SHOP)
        ========================================================================
        */
        function handleSearch() {
            appData.search = document.getElementById('shop-search-input').value.toLowerCase();
            renderProductsList();
        }

        function filterStoreByCategory(catId) {
            appData.activeCat = catId;
            renderStoreCategories();
            renderProductsList();
        }

        function renderStoreContent() {
            renderStoreCategories();
            renderProductsList();
        }

        function renderStoreCategories() {
            const container = document.getElementById('shop-categories-container');
            let html = `<div class="chip ${appData.activeCat === 'all' ? 'active' : ''}" onclick="filterStoreByCategory('all')">–í—Å–µ —Ç–æ–≤–∞—Ä—ã</div>`;
            
            Object.keys(appData.categories).forEach(id => {
                const c = appData.categories[id];
                html += `<div class="chip ${appData.activeCat === id ? 'active' : ''}" onclick="filterStoreByCategory('${id}')">${c.name}</div>`;
            });
            container.innerHTML = html;
        }

        function renderProductsList() {
            const grid = document.getElementById('shop-products-grid');
            grid.innerHTML = '';

            const productIds = Object.keys(appData.products).filter(id => {
                const p = appData.products[id];
                const matchesCategory = appData.activeCat === 'all' || p.catId === appData.activeCat;
                const matchesSearch = p.name.toLowerCase().includes(appData.search);
                return matchesCategory && matchesSearch;
            });

            if (productIds.length === 0) {
                grid.innerHTML = '<div style="text-align:center; padding:60px 0; color:var(--text-hint);">–í –¥–∞–Ω–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ–∫–∞ –ø—É—Å—Ç–æ...</div>';
                return;
            }

            productIds.forEach(id => {
                const p = appData.products[id];
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <div style="display:flex; justify-content:space-between; align-items:flex-start;">
                        <div style="flex:1;">
                            <div style="font-size:20px; font-weight:800; line-height:1.2;">${p.name}</div>
                            <div style="font-size:12px; color:var(--text-hint); margin-top:6px;">${p.type === 'lolz' ? '–ê–≤—Ç–æ–≤—ã–¥–∞—á–∞ Lolz Market' : '–í—ã–¥–∞—á–∞ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–æ–º'}</div>
                        </div>
                        <div class="price-text">${p.price} ‚ÇΩ</div>
                    </div>
                    <button class="btn btn-sm" style="width:100%; margin-top:20px;" onclick="initiatePurchase('${id}')">–ö—É–ø–∏—Ç—å —Å–µ–π—á–∞—Å</button>
                `;
                grid.appendChild(card);
            });
        }

        /* 
        ========================================================================
        13. –ü–õ–ê–¢–ï–ñ–ò –ò –û–§–û–†–ú–õ–ï–ù–ò–ï –ó–ê–ö–ê–ó–ê
        ========================================================================
        */
        function initiatePurchase(productId) {
            currentPurchaseId = productId;
            const product = appData.products[productId];
            document.getElementById('checkout-reks-display').innerText = appData.settings.reks || '–†–µ–∫–≤–∏–∑–∏—Ç—ã –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã.';
            document.getElementById('checkout-total-display').innerText = `${product.price} ‚ÇΩ`;
            
            // –ù–∞–≤–∏–≥–∞—Ü–∏—è –≤—Ä—É—á–Ω—É—é –±–µ–∑ —Å–±—Ä–æ—Å–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –º–∞–≥–∞–∑–∏–Ω–∞
            document.getElementById('page-shop').classList.remove('active');
            document.getElementById('page-checkout').classList.add('active');
        }

        async function submitNewOrder() {
            const fileInput = document.getElementById('checkout-file-picker');
            const file = fileInput.files[0];
            const imgbbKey = appData.settings.imgbb;

            if (!file) return showStatusToast('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª —á–µ–∫–∞');
            if (!imgbbKey) return showStatusToast('–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: API ImgBB –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω');

            setOverlayLoader(true, '–ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞...');

            try {
                // 1. –ó–∞–≥—Ä—É–∑–∫–∞ –≤ ImgBB (Cloud Storage)
                const formData = new FormData();
                formData.append('image', file);
                
                const imgBBResponse = await fetch(`https://api.imgbb.com/1/upload?key=${imgbbKey}`, {
                    method: 'POST', body: formData
                });
                const imgData = await imgBBResponse.json();
                if (!imgData.success) throw new Error('ImgBB Upload Error');

                const product = appData.products[currentPurchaseId];
                const orderId = 'ORD' + Date.now();
                
                const orderObject = {
                    id: orderId,
                    uId: tgUser.id,
                    uName: tgUser.first_name + (tgUser.username ? ` (@${tgUser.username})` : ''),
                    pId: currentPurchaseId,
                    pName: product.name,
                    price: Number(product.price),
                    screenshot: imgData.data.url,
                    status: 'review',
                    date: new Date().toLocaleString('ru-RU')
                };

                // 2. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ Firebase
                await database.ref('orders/' + orderId).set(orderObject);

                // 3. –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–æ—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≤ Telegram –ë–æ—Ç–∞ –ê–¥–º–∏–Ω—É
                await sendTelegramBotMessage(orderObject);

                showStatusToast('–£—Å–ø–µ—à–Ω–æ! –ó–∞–∫–∞–∑ –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ —É –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.');
                fileInput.value = '';
                navigateTo('history');

            } catch (err) {
                alert('–û—à–∏–±–∫–∞ —Å–∏—Å—Ç–µ–º—ã: ' + err.message);
            } finally {
                setOverlayLoader(false);
            }
        }

        async function sendTelegramBotMessage(order) {
            const token = appData.settings.bot;
            const chatId = appData.settings.chatid;
            if (!token || !chatId) return;

            const message = `üõç <b>–ù–û–í–´–ô –ó–ê–ö–ê–ó –í –ú–ê–ì–ê–ó–ò–ù–ï!</b>\n\n` +
                            `üë§ <b>–ö–ª–∏–µ–Ω—Ç:</b> ${order.uName}\n` +
                            `üì¶ <b>–¢–æ–≤–∞—Ä:</b> ${order.pName}\n` +
                            `üí∞ <b>–°—É–º–º–∞:</b> ${order.price} ‚ÇΩ\n\n` +
                            `üñº <a href="${order.screenshot}">–û—Ç–∫—Ä—ã—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç –æ–ø–ª–∞—Ç—ã</a>`;
            
            try {
                await fetch(`https://api.telegram.org/bot${token}/sendMessage`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        chat_id: chatId,
                        text: message,
                        parse_mode: 'HTML'
                    })
                });
            } catch (e) {
                console.error("Bot API Error: ", e);
            }
        }

        /* 
        ========================================================================
        14. –ò–°–¢–û–†–ò–Ø –ü–û–ö–£–ü–û–ö
        ========================================================================
        */
        function renderOrdersHistory() {
            const container = document.getElementById('history-container');
            const myOrders = Object.values(appData.orders)
                                .filter(o => o.uId == tgUser.id)
                                .sort((a, b) => b.id.localeCompare(a.id));

            if (myOrders.length === 0) {
                container.innerHTML = '<div style="text-align:center; padding:60px 0; color:var(--text-hint);">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –ø–æ–∫—É–ø–æ–∫. –°–æ–≤–µ—Ä—à–∏—Ç–µ —Å–≤–æ–π –ø–µ—Ä–≤—ã–π –∑–∞–∫–∞–∑!</div>';
                return;
            }

            container.innerHTML = myOrders.map(o => `
                <div class="card">
                    <div style="display:flex; justify-content:space-between; margin-bottom:15px;">
                        <div>
                            <div style="font-weight:800; font-size:18px;">${o.pName}</div>
                            <div style="font-size:11px; color:var(--text-hint);">${o.date}</div>
                        </div>
                        <span class="status-badge status-${o.status}">${o.status === 'review' ? '–í –æ–±—Ä–∞–±–æ—Ç–∫–µ' : (o.status === 'done' ? '–í—ã–ø–æ–ª–Ω–µ–Ω–æ' : '–û—Ç–∫–∞–∑–∞–Ω–æ')}</span>
                    </div>
                    <div class="price-text" style="font-size:18px; margin-bottom:12px;">${o.price} ‚ÇΩ</div>
                    ${o.status === 'done' ? `
                        <div class="data-box">
                            <b style="color:var(--success)">–î–ê–ù–ù–´–ï –ü–†–û–î–£–ö–¢–ê:</b><br><br>${o.data}
                        </div>
                    ` : ''}
                    ${o.status === 'reject' ? `<div style="color:var(--error); font-size:12px;">–í–∞—à –∑–∞–∫–∞–∑ –±—ã–ª –æ—Ç–∫–ª–æ–Ω–µ–Ω. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –æ–ø–ª–∞—Ç—ã.</div>` : ''}
                </div>
            `).join('');
        }

        function openSupportLink() {
            const username = appData.settings.support;
            if (username) {
                tgWebApp.openTelegramLink(`https://t.me/${username}`);
            } else {
                showStatusToast('–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º');
            }
        }

        /* 
        ========================================================================
        15. –ê–î–ú–ò–ù-–ü–ê–ù–ï–õ–¨: –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø –ò –ò–ù–¢–ï–†–§–ï–ô–°
        ========================================================================
        */
        function authenticateAdmin() {
            const inputPass = document.getElementById('admin-login-pass').value;
            const masterPass = appData.settings.adminPass || 'admin';
            
            if (inputPass === masterPass) {
                sessionStorage.setItem('isAdminAuthorized', 'true');
                navigateTo('admin');
            } else {
                showStatusToast('–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞!');
            }
        }

        function logoutAdmin() {
            sessionStorage.removeItem('isAdminAuthorized');
            location.reload();
        }

        function toggleAdminProductFields() {
            const type = document.getElementById('adm-prod-type-select').value;
            document.getElementById('adm-field-manual').classList.toggle('hidden', type === 'lolz');
            document.getElementById('adm-field-lolz').classList.toggle('hidden', type !== 'lolz');
        }

        function renderAdminInterface() {
            const s = appData.settings;
            document.getElementById('adm-set-reks').value = s.reks || '';
            document.getElementById('adm-set-support').value = s.support || '';
            document.getElementById('adm-set-imgbb').value = s.imgbb || '';
            document.getElementById('adm-set-token').value = s.bot || '';
            document.getElementById('adm-set-chatid').value = s.chatid || '';
            document.getElementById('adm-set-lolz').value = s.lolz || '';

            // –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
            const completed = Object.values(appData.orders).filter(o => o.status === 'done');
            const totalRev = completed.reduce((sum, o) => sum + Number(o.price), 0);
            document.getElementById('adm-stat-revenue').innerText = `${totalRev} ‚ÇΩ`;
            document.getElementById('adm-stat-sales').innerText = completed.length;

            // –†–µ–Ω–¥–µ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–π –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
            const catSelect = document.getElementById('adm-prod-cat-select');
            const catListContainer = document.getElementById('adm-categories-list');
            catSelect.innerHTML = ''; catListContainer.innerHTML = '';
            
            Object.keys(appData.categories).forEach(id => {
                const c = appData.categories[id];
                catSelect.innerHTML += `<option value="${id}">${c.name}</option>`;
                catListContainer.innerHTML += `
                    <div style="display:flex; justify-content:space-between; padding:12px 0; border-bottom:1px solid var(--border);">
                        <span>${c.name}</span>
                        <span style="color:var(--error); font-weight:800; cursor:pointer;" onclick="deleteCategoryFromDB('${id}')">–£–¥–∞–ª–∏—Ç—å</span>
                    </div>
                `;
            });

            // –ó–∞–∫–∞–∑—ã –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É
            const reviewCont = document.getElementById('adm-orders-review-list');
            const pending = Object.values(appData.orders).filter(o => o.status === 'review');
            reviewCont.innerHTML = pending.map(o => `
                <div class="card" style="border-left:6px solid var(--warning);">
                    <div style="font-weight:800; font-size:18px;">${o.pName} | ${o.price} ‚ÇΩ</div>
                    <div style="font-size:12px; margin:5px 0; color:var(--text-hint);">–ö–ª–∏–µ–Ω—Ç: ${o.uName}</div>
                    <img src="${o.screenshot}" class="image-preview" onclick="window.open('${o.screenshot}')">
                    <div style="display:flex; gap:12px; margin-top:15px;">
                        <button class="btn btn-sm" style="flex:1" onclick="approveUserOrder('${o.id}')">–ü—Ä–∏–Ω—è—Ç—å</button>
                        <button class="btn btn-sm btn-outline btn-danger" style="flex:1" onclick="updateOrderStatusInDB('${o.id}', 'reject')">–û—Ç–∫–∞–∑</button>
                    </div>
                </div>
            `).join('') || '<p style="color:var(--text-hint); text-align:center; padding:20px;">–ù–µ—Ç –Ω–æ–≤—ã—Ö –∑–∞–∫–∞–∑–æ–≤ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏.</p>';

            // –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å —Ç–æ–≤–∞—Ä–æ–≤
            const inventoryCont = document.getElementById('adm-inventory-list');
            inventoryCont.innerHTML = Object.keys(appData.products).map(id => `
                <div style="display:flex; justify-content:space-between; align-items:center; padding:15px 0; border-bottom:1px solid var(--border);">
                    <div>
                        <div style="font-weight:700;">${appData.products[id].name}</div>
                        <div style="font-size:11px; color:var(--text-hint);">${appState.products[id].price || appData.products[id].price} ‚ÇΩ ‚Ä¢ ${appData.products[id].type}</div>
                    </div>
                    <button class="btn btn-sm btn-danger" onclick="deleteProductFromDB('${id}')">–£–¥–∞–ª–∏—Ç—å</button>
                </div>
            `).join('');
        }

        /* 
        ========================================================================
        16. DATABASE CRUD OPERATIONS (–ê–î–ú–ò–ù)
        ========================================================================
        */
        async function approveUserOrder(orderId) {
            const order = appData.orders[orderId];
            const product = appData.products[order.pId];
            
            setOverlayLoader(true, '–û–±—Ä–∞–±–æ—Ç–∫–∞ –∏ –≤—ã–¥–∞—á–∞ —Ç–æ–≤–∞—Ä–∞...');

            try {
                let deliveredContent = "";
                
                if (product.type === 'lolz') {
                    deliveredContent = await autoBuyOnLolzMarket(product.lolzUrl);
                } else {
                    deliveredContent = product.data || "–ö–æ–Ω—Ç–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω";
                }

                await database.ref(`orders/${orderId}`).update({
                    status: 'done',
                    data: deliveredContent
                });
                
                showStatusToast('–ó–∞–∫–∞–∑ —É—Å–ø–µ—à–Ω–æ –≤—ã–¥–∞–Ω!');
            } catch (err) {
                alert('–û—à–∏–±–∫–∞: ' + err.message + '. –ï—Å–ª–∏ –∞–≤—Ç–æ–≤—ã–¥–∞—á–∞ Lolz –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–∞, –≤—ã–¥–∞–π—Ç–µ –≤—Ä—É—á–Ω—É—é –∏–ª–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω.');
            } finally {
                setOverlayLoader(false);
            }
        }

        async function autoBuyOnLolzMarket(searchUrl) {
            const token = appData.settings.lolz;
            if (!token) throw new Error('–¢–æ–∫–µ–Ω Lolz Market –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ –∫–æ–Ω—Å–æ–ª–∏');

            // –ü—É–±–ª–∏—á–Ω—ã–π CORS –ø—Ä–æ–∫—Å–∏ –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ LZT
            const proxySrv = "https://corsproxy.io/?"; 
            const apiTarget = searchUrl.includes('?') ? `https://api.lzt.market/list?${searchUrl.split('?')[1]}` : `https://api.lzt.market/list`;
            
            const requestUrl = proxySrv + encodeURIComponent(apiTarget);

            try {
                const response = await fetch(requestUrl, {
                    headers: { 'Authorization': `Bearer ${token}`, 'Accept': 'application/json' }
                });

                if (!response.ok) throw new Error(`Lolz Market –≤–µ—Ä–Ω—É–ª —Å—Ç–∞—Ç—É—Å ${response.status}`);

                const result = await response.json();
                if (!result.items || result.items.length === 0) throw new Error('–ü–æ –≤–∞—à–∏–º —Ñ–∏–ª—å—Ç—Ä–∞–º –Ω–∞ –ú–∞—Ä–∫–µ—Ç–µ –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤');
                
                const item = result.items[0];
                // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –¥–∞–Ω–Ω—ã–µ. –ü–æ–ª–Ω–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —á–µ—Ä–µ–∑ CORS –ø—Ä–æ–∫—Å–∏ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–∞, 
                // –ø–æ—ç—Ç–æ–º—É –æ—Ç–¥–∞–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ —Ç–æ–≤–∞—Ä –∏ –æ–ø–∏—Å–∞–Ω–∏–µ.
                return `üåü –ê–∫–∫–∞—É–Ω—Ç –Ω–∞–π–¥–µ–Ω!\n\nID: ${item.item_id}\n–û–ø–∏—Å–∞–Ω–∏–µ: ${item.item_title}\n–¶–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏: ${item.price} ${item.currency}\n\n–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª "–ü–æ–∫—É–ø–∫–∏" –Ω–∞ lzt.market –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–ª–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.`;
            } catch (e) {
                throw new Error("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ Lolz Market. –í–æ–∑–º–æ–∂–Ω–æ, CORS –ø—Ä–æ–∫—Å–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω.");
            }
        }

        function updateOrderStatusInDB(id, status) {
            if (confirm('–í—ã –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º?')) {
                database.ref(`orders/${id}/status`).set(status);
            }
        }

        function saveSystemSettings() {
            const newAdminPass = document.getElementById('adm-set-pass').value;
            const settingsObject = {
                reks: document.getElementById('adm-set-reks').value,
                support: document.getElementById('adm-set-support').value,
                imgbb: document.getElementById('adm-set-imgbb').value,
                bot: document.getElementById('adm-set-token').value,
                chatid: document.getElementById('adm-set-chatid').value,
                lolz: document.getElementById('adm-set-lolz').value,
                adminPass: newAdminPass || appData.settings.adminPass || 'admin'
            };
            
            database.ref('settings').set(settingsObject).then(() => {
                showStatusToast('–°–∏—Å—Ç–µ–º–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã!');
                document.getElementById('adm-set-pass').value = '';
            });
        }

        function adminAddCategory() {
            const catName = document.getElementById('adm-new-cat-input').value;
            if (!catName) return;
            database.ref('categories').push({ name: catName }).then(() => {
                document.getElementById('adm-new-cat-input').value = '';
                showStatusToast('–ö–∞—Ç–µ–≥–æ—Ä–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∞');
            });
        }

        function deleteCategoryFromDB(id) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é? –¢–æ–≤–∞—Ä—ã –æ—Å—Ç–∞–Ω—É—Ç—Å—è –±–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏.')) {
                database.ref(`categories/${id}`).remove();
            }
        }

        function adminAddProduct() {
            const name = document.getElementById('adm-prod-name').value;
            const price = document.getElementById('adm-prod-price').value;
            const catId = document.getElementById('adm-prod-cat-select').value;
            const type = document.getElementById('adm-prod-type-select').value;
            const data = document.getElementById('adm-prod-data').value;
            const lolzUrl = document.getElementById('adm-prod-lolz-url').value;

            if (!name || !price || !catId) return showStatusToast('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è (–ò–º—è, –¶–µ–Ω–∞, –ö–∞—Ç–µ–≥–æ—Ä–∏—è)');

            const productData = {
                name, 
                price: Number(price), 
                catId, 
                type,
                data: type === 'lolz' ? '' : data,
                lolzUrl: type === 'lolz' ? lolzUrl : ''
            };

            database.ref('products').push(productData).then(() => {
                showStatusToast('–¢–æ–≤–∞—Ä —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!');
                // –û—á–∏—Å—Ç–∫–∞ –ø–æ–ª–µ–π
                document.getElementById('adm-prod-name').value = '';
                document.getElementById('adm-prod-price').value = '';
                document.getElementById('adm-prod-data').value = '';
                document.getElementById('adm-prod-lolz-url').value = '';
            });
        }

        function deleteProductFromDB(id) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä –Ω–∞–≤—Å–µ–≥–¥–∞?')) {
                database.ref(`products/${id}`).remove();
            }
        }

        /* 
        ========================================================================
        17. –í–ï–†–•–û–í–ù–´–ï –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò (UTILS)
        ========================================================================
        */
        function setOverlayLoader(isVisible, text = '–û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö...') {
            const l = document.getElementById('global-loader');
            if (isVisible) {
                l.style.display = 'flex';
                l.style.opacity = '1';
                l.querySelector('p').innerText = text;
            } else {
                hideLoader();
            }
        }

    </script>
</body>
</html>
