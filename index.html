<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Minimalist Digital Store</title>
    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Telegram WebApp API -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* –û–°–ù–û–í–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï –ò –¢–ï–ú–ê (–ß–ï–†–ù–û-–ë–ï–õ–ê–Ø) */
        :root {
            --bg-color: #ffffff;
            --text-color: #000000;
            --accent-color: #000000;
            --secondary-bg: #f5f5f5;
            --border-color: #e0e0e0;
            --hint-color: #888888;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --user-font-color: #000000; /* –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º */
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--bg-color);
            color: var(--user-font-color);
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* –ö–û–ù–¢–ï–ô–ù–ï–†–´ –°–¢–†–ê–ù–ò–¶ */
        .container {
            padding: 20px 16px 100px 16px;
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
            flex-grow: 1;
        }

        .page {
            display: none;
            animation: fadeIn 0.4s ease;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* –¢–ò–ü–û–ì–†–ê–§–ò–ö–ê */
        h1 { font-size: 28px; font-weight: 800; margin-bottom: 24px; letter-spacing: -1px; }
        h2 { font-size: 20px; font-weight: 700; margin-bottom: 16px; }
        .hint { color: var(--hint-color); font-size: 14px; }

        /* –ö–ù–û–ü–ö–ò */
        .btn {
            background: var(--accent-color);
            color: #ffffff;
            border: 1px solid var(--accent-color);
            padding: 14px 20px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn:active { transform: scale(0.96); opacity: 0.8; }

        .btn-outline {
            background: transparent;
            color: var(--text-color);
            border: 1px solid var(--text-color);
        }

        .btn-sm { padding: 8px 12px; font-size: 14px; width: auto; }

        /* –ú–ê–ì–ê–ó–ò–ù: –ö–ê–¢–ï–ì–û–†–ò–ò –ò –¢–û–í–ê–†–´ */
        .category-section { margin-bottom: 32px; }
        
        .products-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 16px;
        }

        .product-card {
            background: var(--bg-color);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 16px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            transition: var(--transition);
        }

        .product-card:active { border-color: var(--text-color); }

        .product-info h3 { margin: 0 0 8px 0; font-size: 18px; }
        .product-info p { margin: 0 0 16px 0; font-size: 14px; color: var(--hint-color); }
        
        .product-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 12px;
        }

        .price { font-size: 20px; font-weight: 800; }

        /* –ü–†–û–§–ò–õ–¨ */
        .profile-stat {
            background: var(--secondary-bg);
            padding: 20px;
            border-radius: 16px;
            margin-bottom: 24px;
            text-align: center;
        }

        .stat-value { font-size: 32px; font-weight: 800; display: block; }
        .stat-label { font-size: 14px; text-transform: uppercase; letter-spacing: 1px; }

        .order-item {
            border-bottom: 1px solid var(--border-color);
            padding: 12px 0;
            display: flex;
            justify-content: space-between;
            font-size: 14px;
        }

        /* –§–û–†–ú–´ */
        .form-group { margin-bottom: 16px; }
        label { display: block; margin-bottom: 6px; font-size: 14px; font-weight: 600; }
        input, select, textarea {
            width: 100%;
            padding: 12px;
            border-radius: 10px;
            border: 1px solid var(--border-color);
            background: var(--secondary-bg);
            color: var(--text-color);
            font-size: 16px;
            outline: none;
        }
        input:focus { border-color: var(--text-color); }

        /* –ù–ê–í–ò–ì–ê–¶–ò–Ø */
        .nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: space-around;
            padding: 12px 0 env(safe-area-inset-bottom);
            border-top: 1px solid var(--border-color);
            z-index: 1000;
        }

        .nav-item {
            flex: 1;
            text-align: center;
            background: none;
            border: none;
            color: var(--hint-color);
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }

        .nav-item.active { color: var(--text-color); }
        .nav-icon { font-size: 20px; }

        /* –ê–î–ú–ò–ù–ö–ê */
        .admin-list-item {
            background: var(--secondary-bg);
            padding: 12px;
            border-radius: 10px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
    </style>
</head>
<body>

    <div class="container">
        <!-- –°–¢–†–ê–ù–ò–¶–ê: –ú–ê–ì–ê–ó–ò–ù -->
        <div id="shop-page" class="page active">
            <h1>–ú–∞–≥–∞–∑–∏–Ω</h1>
            <div id="shop-content">
                <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ —Ç–æ–≤–∞—Ä—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
            </div>
        </div>

        <!-- –°–¢–†–ê–ù–ò–¶–ê: –ü–†–û–§–ò–õ–¨ -->
        <div id="profile-page" class="page">
            <h1>–ü—Ä–æ—Ñ–∏–ª—å</h1>
            <div class="profile-stat">
                <span class="stat-label">–ü–æ—Ç—Ä–∞—á–µ–Ω–æ –≤—Å–µ–≥–æ</span>
                <span id="total-spent" class="stat-value">0 ‚ÇΩ</span>
            </div>

            <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–µ–º—ã</h2>
            <div class="form-group">
                <label>–¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞</label>
                <input type="color" id="font-color-picker" onchange="changeFontColor(this.value)">
            </div>

            <h2>–ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤</h2>
            <div id="order-history">
                <!-- –ó–∞–∫–∞–∑—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
            </div>
        </div>

        <!-- –°–¢–†–ê–ù–ò–¶–ê: –í–•–û–î –í –ê–î–ú–ò–ù–ö–£ -->
        <div id="admin-login-page" class="page">
            <h1>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h1>
            <div class="form-group">
                <label>–ü–∞—Ä–æ–ª—å</label>
                <input type="password" id="admin-password" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
            </div>
            <button class="btn" onclick="tryAdminLogin()">–í–æ–π—Ç–∏</button>
        </div>

        <!-- –°–¢–†–ê–ù–ò–¶–ê: –£–ü–†–ê–í–õ–ï–ù–ò–ï –ê–î–ú–ò–ù–ö–û–ô -->
        <div id="admin-panel-page" class="page">
            <h1>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h1>
            <button class="btn btn-outline btn-sm" onclick="adminLogout()" style="margin-bottom: 20px;">–í—ã–π—Ç–∏</button>

            <div class="category-section">
                <h2>–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</h2>
                <div class="form-group" style="display:flex; gap:8px;">
                    <input type="text" id="new-cat-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏">
                    <button class="btn btn-sm" onclick="addCategory()">+</button>
                </div>
                <div id="admin-categories-list"></div>
            </div>

            <div class="category-section">
                <h2>–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</h2>
                <div class="form-group">
                    <select id="prod-cat-select"></select>
                    <input type="text" id="new-prod-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞">
                    <input type="number" id="new-prod-price" placeholder="–¶–µ–Ω–∞">
                    <button class="btn btn-sm" style="margin-top:8px; width:100%" onclick="addProduct()">–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</button>
                </div>
                <h2>–¢–æ–≤–∞—Ä—ã</h2>
                <div id="admin-products-list"></div>
            </div>
        </div>
    </div>

    <!-- –ù–ê–í–ò–ì–ê–¶–ò–Ø -->
    <nav class="nav">
        <button class="nav-item active" onclick="navigate('shop')">
            <span class="nav-icon">üõçÔ∏è</span>
            <span>–ú–∞–≥–∞–∑–∏–Ω</span>
        </button>
        <button class="nav-item" onclick="navigate('profile')">
            <span class="nav-icon">üë§</span>
            <span>–ü—Ä–æ—Ñ–∏–ª—å</span>
        </button>
        <button class="nav-item" onclick="navigate('admin')">
            <span class="nav-icon">‚öôÔ∏è</span>
            <span>–ê–¥–º–∏–Ω</span>
        </button>
    </nav>

    <script>
        // --- –î–ê–ù–ù–´–ï –ò –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ---
        let state = {
            categories: [],
            products: [],
            orders: [],
            settings: {
                fontColor: '#000000'
            }
        };

        const ADMIN_PASSWORD = "admin12"; // –ü—Ä–æ—Å—Ç–æ–π –ø–∞—Ä–æ–ª—å –¥–ª—è –ø—Ä–∏–º–µ—Ä–∞

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ localStorage
        function loadData() {
            const saved = localStorage.getItem('tma_store_db');
            if (saved) {
                state = JSON.parse(saved);
            } else {
                // –î–µ—Ñ–æ–ª—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ
                state.categories = [{id: 1, name: '–°–æ—Ñ—Ç'}, {id: 2, name: '–ü–æ–¥–ø–∏—Å–∫–∏'}];
                state.products = [
                    {id: 1, catId: 1, name: 'Antivirus 2024', price: 1200},
                    {id: 2, catId: 2, name: 'Premium Pass', price: 500}
                ];
                saveData();
            }
            applySettings();
        }

        function saveData() {
            localStorage.setItem('tma_store_db', JSON.stringify(state));
        }

        function applySettings() {
            document.documentElement.style.setProperty('--user-font-color', state.settings.fontColor);
            document.getElementById('font-color-picker').value = state.settings.fontColor;
        }

        // --- –†–û–£–¢–ò–ù–ì ---
        function navigate(page) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));

            if (page === 'shop') {
                document.getElementById('shop-page').classList.add('active');
                document.querySelectorAll('.nav-item')[0].classList.add('active');
                renderShop();
            } else if (page === 'profile') {
                document.getElementById('profile-page').classList.add('active');
                document.querySelectorAll('.nav-item')[1].classList.add('active');
                renderProfile();
            } else if (page === 'admin') {
                const isAuth = sessionStorage.getItem('admin_auth');
                const target = isAuth ? 'admin-panel-page' : 'admin-login-page';
                document.getElementById(target).classList.add('active');
                document.querySelectorAll('.nav-item')[2].classList.add('active');
                if (isAuth) renderAdmin();
            }
        }

        // --- –ú–ê–ì–ê–ó–ò–ù ---
        function renderShop() {
            const container = document.getElementById('shop-content');
            container.innerHTML = '';

            state.categories.forEach(cat => {
                const catProds = state.products.filter(p => p.catId === cat.id);
                if (catProds.length === 0) return;

                const section = document.createElement('div');
                section.className = 'category-section';
                section.innerHTML = `<h2>${cat.name}</h2>`;
                
                const grid = document.createElement('div');
                grid.className = 'products-grid';

                catProds.forEach(p => {
                    grid.innerHTML += `
                        <div class="product-card">
                            <div class="product-info">
                                <h3>${p.name}</h3>
                                <p>–¶–∏—Ñ—Ä–æ–≤–æ–π —Ç–æ–≤–∞—Ä ‚Ä¢ –ú–æ–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞</p>
                            </div>
                            <div class="product-footer">
                                <span class="price">${p.price} ‚ÇΩ</span>
                                <button class="btn btn-sm" onclick="buyProduct(${p.id})">–ö—É–ø–∏—Ç—å</button>
                            </div>
                        </div>
                    `;
                });

                section.appendChild(grid);
                container.appendChild(section);
            });
        }

        function buyProduct(id) {
            const prod = state.products.find(p => p.id === id);
            const order = {
                id: Date.now(),
                name: prod.name,
                price: prod.price,
                date: new Date().toLocaleDateString('ru-RU')
            };
            state.orders.push(order);
            saveData();
            
            if (window.Telegram.WebApp) {
                window.Telegram.WebApp.HapticFeedback.notificationOccurred('success');
                window.Telegram.WebApp.showAlert(`–í—ã —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–æ–±—Ä–µ–ª–∏ ${prod.name}!`);
            } else {
                alert(`–ö—É–ø–ª–µ–Ω–æ: ${prod.name}`);
            }
        }

        // --- –ü–†–û–§–ò–õ–¨ ---
        function renderProfile() {
            const total = state.orders.reduce((sum, o) => sum + o.price, 0);
            document.getElementById('total-spent').innerText = `${total} ‚ÇΩ`;

            const history = document.getElementById('order-history');
            history.innerHTML = '';
            
            if (state.orders.length === 0) {
                history.innerHTML = '<p class="hint">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –ø–æ–∫—É–ø–æ–∫</p>';
                return;
            }

            [...state.orders].reverse().forEach(o => {
                history.innerHTML += `
                    <div class="order-item">
                        <span>${o.name}</span>
                        <span><b>${o.price} ‚ÇΩ</b></span>
                        <span class="hint">${o.date}</span>
                    </div>
                `;
            });
        }

        function changeFontColor(color) {
            state.settings.fontColor = color;
            saveData();
            applySettings();
        }

        // --- –ê–î–ú–ò–ù–ö–ê ---
        function tryAdminLogin() {
            const pass = document.getElementById('admin-password').value;
            if (pass === ADMIN_PASSWORD) {
                sessionStorage.setItem('admin_auth', 'true');
                navigate('admin');
            } else {
                alert('–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å');
            }
        }

        function adminLogout() {
            sessionStorage.removeItem('admin_auth');
            navigate('admin');
        }

        function renderAdmin() {
            // –°–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –¥–ª—è –≤—ã–±–æ—Ä–∞ –≤ —Ç–æ–≤–∞—Ä–µ
            const select = document.getElementById('prod-cat-select');
            select.innerHTML = state.categories.map(c => `<option value="${c.id}">${c.name}</option>`).join('');

            // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏
            const catList = document.getElementById('admin-categories-list');
            catList.innerHTML = state.categories.map(c => `
                <div class="admin-list-item">
                    <span>${c.name}</span>
                    <button class="btn btn-sm btn-outline" onclick="deleteCategory(${c.id})">–£–¥–∞–ª–∏—Ç—å</button>
                </div>
            `).join('');

            // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏
            const prodList = document.getElementById('admin-products-list');
            prodList.innerHTML = state.products.map(p => `
                <div class="admin-list-item">
                    <div style="display:flex; flex-direction:column">
                        <input type="text" value="${p.name}" onchange="editProduct(${p.id}, 'name', this.value)" style="padding:4px; font-size:12px; margin-bottom:4px">
                        <input type="number" value="${p.price}" onchange="editProduct(${p.id}, 'price', this.value)" style="padding:4px; font-size:12px">
                    </div>
                    <button class="btn btn-sm btn-outline" onclick="deleteProduct(${p.id})">‚ùå</button>
                </div>
            `).join('');
        }

        function addCategory() {
            const name = document.getElementById('new-cat-name').value;
            if (!name) return;
            state.categories.push({ id: Date.now(), name });
            saveData();
            renderAdmin();
            document.getElementById('new-cat-name').value = '';
        }

        function deleteCategory(id) {
            state.categories = state.categories.filter(c => c.id !== id);
            state.products = state.products.filter(p => p.catId !== id);
            saveData();
            renderAdmin();
        }

        function addProduct() {
            const catId = parseInt(document.getElementById('prod-cat-select').value);
            const name = document.getElementById('new-prod-name').value;
            const price = parseInt(document.getElementById('new-prod-price').value);
            
            if (!name || !price) return;
            
            state.products.push({ id: Date.now(), catId, name, price });
            saveData();
            renderAdmin();
            
            document.getElementById('new-prod-name').value = '';
            document.getElementById('new-prod-price').value = '';
        }

        function editProduct(id, field, value) {
            const p = state.products.find(x => x.id === id);
            if (field === 'price') value = parseInt(value);
            p[field] = value;
            saveData();
        }

        function deleteProduct(id) {
            state.products = state.products.filter(p => p.id !== id);
            saveData();
            renderAdmin();
        }

        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        window.onload = () => {
            loadData();
            renderShop();
            if (window.Telegram && window.Telegram.WebApp) {
                window.Telegram.WebApp.ready();
            }
        };
    </script>
</body>
</html>
