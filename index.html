<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Zikrov Elite Market v3.0</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono&display=swap" rel="stylesheet">
    
    <style>
        /* ================================================================
           1. CSS DESIGN SYSTEM (DEEP DARK ENTERPRISE)
           ================================================================
        */
        :root {
            --bg-base: #000000;
            --bg-surface: #0a0a0b;
            --bg-card: #111113;
            --bg-elevated: #1c1c1e;
            
            --accent: #007aff;
            --accent-gradient: linear-gradient(135deg, #007aff 0%, #00c6ff 100%);
            --accent-soft: rgba(0, 122, 255, 0.15);
            
            --success: #32d74b;
            --warning: #ffd60a;
            --error: #ff453a;
            
            --text-main: #ffffff;
            --text-secondary: #8e8e93;
            --text-muted: #48484a;
            
            --border: rgba(255, 255, 255, 0.06);
            --border-bright: rgba(255, 255, 255, 0.12);
            
            --radius-xs: 8px;
            --radius-sm: 12px;
            --radius-md: 16px;
            --radius-lg: 24px;
            --radius-xl: 32px;
            
            --shadow-sm: 0 2px 8px rgba(0,0,0,0.4);
            --shadow-lg: 0 12px 32px rgba(0,0,0,0.6);
            
            --safe-top: env(safe-area-inset-top);
            --safe-bottom: env(safe-area-inset-bottom);
        }

        /* Reset & Global */
        * {
            margin: 0; padding: 0; box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            font-family: 'Inter', -apple-system, sans-serif;
        }

        body {
            background-color: var(--bg-base);
            color: var(--text-main);
            overflow-x: hidden;
            width: 100%;
            min-height: 100vh;
            padding-bottom: calc(100px + var(--safe-bottom));
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 0; }

        /* Typography */
        h1 { font-size: 34px; font-weight: 850; letter-spacing: -1.5px; line-height: 1.1; }
        h2 { font-size: 22px; font-weight: 750; letter-spacing: -0.5px; }
        h3 { font-size: 16px; font-weight: 600; color: var(--text-secondary); }
        p { font-size: 14px; line-height: 1.5; color: var(--text-secondary); }

        /* Layout Helpers */
        .container { padding: 0 20px; width: 100%; max-width: 600px; margin: 0 auto; }
        .flex-row { display: flex; align-items: center; justify-content: space-between; }
        .hidden { display: none !important; }
        .anim-fade { animation: fadeIn 0.4s ease-out; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* ================================================================
           2. UI COMPONENTS
           ================================================================
        */

        /* Buttons */
        .btn {
            display: flex; align-items: center; justify-content: center; gap: 10px;
            width: 100%; border: none; border-radius: var(--radius-md);
            padding: 18px; font-size: 16px; font-weight: 700;
            cursor: pointer; transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative; overflow: hidden;
        }

        .btn-primary { background: var(--accent-gradient); color: white; box-shadow: 0 8px 24px rgba(0, 122, 255, 0.3); }
        .btn-secondary { background: var(--bg-elevated); color: white; border: 1px solid var(--border-bright); }
        .btn-ghost { background: transparent; color: var(--text-secondary); padding: 10px; }
        .btn-danger { background: var(--error); color: white; }

        .btn:active { transform: scale(0.97); opacity: 0.9; }

        /* Cards */
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 24px;
            margin-bottom: 16px;
            transition: 0.3s;
        }

        .card-active:active { background: var(--bg-elevated); border-color: var(--accent); }

        /* Inputs */
        .input-group { margin-bottom: 20px; }
        .input-group label { display: block; font-size: 12px; font-weight: 700; color: var(--text-muted); text-transform: uppercase; margin-bottom: 8px; margin-left: 4px; }
        .input-field {
            width: 100%; background: var(--bg-surface); border: 1px solid var(--border);
            border-radius: var(--radius-sm); padding: 16px; color: white;
            font-size: 15px; outline: none; transition: 0.2s;
        }
        .input-field:focus { border-color: var(--accent); background: #151517; }

        /* Navigation Bar */
        .nav-bar {
            position: fixed; bottom: 0; left: 0; right: 0;
            height: calc(85px + var(--safe-bottom));
            background: rgba(10, 10, 12, 0.85);
            backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px);
            border-top: 1px solid var(--border);
            display: flex; justify-content: space-around;
            padding: 10px 10px var(--safe-bottom);
            z-index: 1000;
        }

        .nav-item {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            color: var(--text-muted); text-decoration: none; width: 20%;
            transition: 0.2s;
        }

        .nav-item.active { color: var(--accent); }
        .nav-item svg { width: 24px; height: 24px; margin-bottom: 6px; fill: currentColor; }
        .nav-item span { font-size: 10px; font-weight: 700; }

        /* Badges */
        .badge {
            padding: 4px 10px; border-radius: 20px; font-size: 11px; font-weight: 800;
            text-transform: uppercase; letter-spacing: 0.5px;
        }
        .badge-success { background: rgba(50, 215, 75, 0.1); color: var(--success); }
        .badge-blue { background: var(--accent-soft); color: var(--accent); }

        /* Bottom Sheet (Payment Modal) */
        .sheet-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.8); z-index: 2000;
            display: none; align-items: flex-end;
        }
        .sheet-overlay.active { display: flex; }
        .sheet {
            background: var(--bg-card); width: 100%; border-radius: 32px 32px 0 0;
            padding: 32px 24px calc(40px + var(--safe-bottom));
            transform: translateY(100%); transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
        }
        .sheet-overlay.active .sheet { transform: translateY(0); }

    </style>
</head>
<body>

    <div id="view-market" class="view anim-fade">
        <header class="header container" style="padding-top: 40px; margin-bottom: 30px;">
            <p id="welcome-text">Premium Accounts</p>
            <h1>Elite Market</h1>
        </header>

        <div class="container">
            <div id="cat-render-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 30px;">
                </div>

            <div id="product-view" class="hidden">
                <div class="flex-row" style="margin-bottom: 20px;">
                    <h2 id="current-cat-name">Category</h2>
                    <button class="btn-ghost" onclick="Router.back()">‚Üê –ù–∞–∑–∞–¥</button>
                </div>
                <div id="product-render-list">
                    </div>
            </div>
        </div>
    </div>

    <div id="view-profile" class="view hidden anim-fade">
        <header class="header container" style="padding-top: 40px; margin-bottom: 30px;">
            <h1>–ú–æ–π –ö–∞–±–∏–Ω–µ—Ç</h1>
        </header>

        <div class="container">
            <div class="card" style="display: flex; gap: 20px; align-items: center;">
                <div id="u-avatar" style="width: 70px; height: 70px; border-radius: 24px; background: var(--accent-gradient); display: flex; align-items: center; justify-content: center; font-size: 30px; font-weight: 800; color: white;">?</div>
                <div>
                    <h2 id="u-name">User</h2>
                    <p id="u-id-display">ID: 000000</p>
                </div>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 20px;">
                <div class="card" style="margin-bottom: 0; padding: 20px;">
                    <h3 style="font-size: 11px; text-transform: uppercase; margin-bottom: 5px;">–°–¥–µ–ª–æ–∫</h3>
                    <div id="stat-deals" style="font-size: 24px; font-weight: 850;">0</div>
                </div>
                <div class="card" style="margin-bottom: 0; padding: 20px;">
                    <h3 style="font-size: 11px; text-transform: uppercase; margin-bottom: 5px;">–ü–æ—Ç—Ä–∞—á–µ–Ω–æ</h3>
                    <div id="stat-spent" style="font-size: 24px; font-weight: 850; color: var(--accent);">0 ‚ÇΩ</div>
                </div>
            </div>

            <button class="btn btn-secondary" onclick="Logic.showHistory()" style="margin-bottom: 12px;">üïí –ò—Å—Ç–æ—Ä–∏—è –ø–æ–∫—É–ø–æ–∫</button>
            <button class="btn btn-secondary" onclick="TG.openTelegramLink('https://t.me/Z1KROV')">üÜò –ü–æ–¥–¥–µ—Ä–∂–∫–∞</button>

            <div id="admin-access" class="hidden" style="margin-top: 40px;">
                <div style="background: rgba(255, 69, 58, 0.1); border: 1px dashed var(--error); padding: 20px; border-radius: 20px;">
                    <h3 style="color: var(--error); margin-bottom: 10px;">ROOT ACCESS DETECTED</h3>
                    <button class="btn btn-danger" onclick="Router.go('admin')">–í–û–ô–¢–ò –í –ê–î–ú–ò–ù-–ü–ê–ù–ï–õ–¨</button>
                </div>
            </div>
        </div>
    </div>

    <div id="view-admin" class="view hidden anim-fade">
        <header class="header container" style="padding-top: 40px; margin-bottom: 30px;">
            <button class="btn-ghost" onclick="Router.go('profile')" style="margin-left: -10px;">‚Üê –ù–∞–∑–∞–¥</button>
            <h1 style="color: var(--error);">Console v3.0</h1>
        </header>

        <div class="container" style="padding-bottom: 50px;">
            
            <div class="card">
                <h2>–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è</h2>
                <div class="input-group" style="margin-top: 20px;">
                    <label>LOLZ MARKET TOKEN</label>
                    <input type="password" id="adm-lolz-token" class="input-field" placeholder="api_key_here">
                </div>
                <div class="input-group">
                    <label>–¢–µ–∫—Å—Ç –æ–ø–ª–∞—Ç—ã (–ö—Ä–∏–ø—Ç–∞)</label>
                    <textarea id="adm-pay-crypto" class="input-field" style="height: 80px;">–ü–µ—Ä–µ–≤–µ–¥–∏—Ç–µ USDT –Ω–∞ –∞–¥—Ä–µ—Å –Ω–∏–∂–µ...</textarea>
                </div>
                <div class="input-group">
                    <label>–¢–µ–∫—Å—Ç –æ–ø–ª–∞—Ç—ã (–ö–∞—Ä—Ç–∞)</label>
                    <textarea id="adm-pay-card" class="input-field" style="height: 80px;">–ü–µ—Ä–µ–≤–µ–¥–∏—Ç–µ –Ω–∞ –∫–∞—Ä—Ç—É –¢–∏–Ω—å–∫–æ—Ñ—Ñ...</textarea>
                </div>
                <button class="btn btn-primary" onclick="Admin.saveGlobalConfig()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
            </div>

            <div class="card">
                <h2>–î–æ–±–∞–≤–∏—Ç—å –ö–∞—Ç–µ–≥–æ—Ä–∏—é</h2>
                <div class="input-group" style="margin-top: 15px;">
                    <input type="text" id="adm-cat-name" class="input-field" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ (–Ω–∞–ø—Ä. Telegram RU)">
                </div>
                <button class="btn btn-secondary" onclick="Admin.addCategory()">–°–æ–∑–¥–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</button>
            </div>

            <div class="card">
                <h2>–ù–æ–≤—ã–π –¢–æ–≤–∞—Ä (LOLZ SYNC)</h2>
                <div class="input-group" style="margin-top: 15px;">
                    <label>–ù–∞–∑–≤–∞–Ω–∏–µ –≤ –º–∞–≥–∞–∑–∏–Ω–µ</label>
                    <input type="text" id="adm-p-name" class="input-field" placeholder="TG –ê–≤—Ç–æ—Ä–µ–≥ 2FA">
                </div>
                <div class="input-group">
                    <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                    <select id="adm-p-cat-select" class="input-field"></select>
                </div>
                <div class="input-group">
                    <label>–í–∞—à–∞ —Ü–µ–Ω–∞ (–§–∏–∫—Å –≤ —Ä—É–±–ª—è—Ö)</label>
                    <input type="number" id="adm-p-price" class="input-field" placeholder="150">
                </div>

                <hr style="border: none; border-top: 1px solid var(--border); margin: 20px 0;">
                <p style="font-size: 11px; color: var(--accent); font-weight: 800; margin-bottom: 10px;">–ü–ê–†–ê–ú–ï–¢–†–´ –ü–ê–†–°–ò–ù–ì–ê LOLZ</p>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <div class="input-group">
                        <label>–ú–∏–Ω. —Ü–µ–Ω–∞ Lolz</label>
                        <input type="number" id="adm-lz-min" class="input-field" placeholder="10">
                    </div>
                    <div class="input-group">
                        <label>–ú–∞–∫—Å. —Ü–µ–Ω–∞ Lolz</label>
                        <input type="number" id="adm-lz-max" class="input-field" placeholder="100">
                    </div>
                </div>

                <div class="input-group">
                    <label>–ü—Ä–æ–∏—Å—Ö–æ–∂–¥–µ–Ω–∏–µ</label>
                    <select id="adm-lz-origin" class="input-field">
                        <option value="autoreg">–ê–≤—Ç–æ—Ä–µ–≥</option>
                        <option value="brute">–ë—Ä—É—Ç</option>
                        <option value="owner">–õ–∏—á–Ω—ã–π</option>
                        <option value="resale">–ü–µ—Ä–µ–ø—Ä–æ–¥–∞–∂–∞</option>
                    </select>
                </div>

                <div class="input-group">
                    <label>–ö–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ</label>
                    <input type="text" id="adm-lz-query" class="input-field" placeholder="Telegram">
                </div>

                <button class="btn btn-primary" onclick="Admin.addProduct()">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å —Ç–æ–≤–∞—Ä</button>
            </div>

            <button class="btn btn-secondary" onclick="Admin.resetAllData()" style="color: var(--error);">‚ö†Ô∏è –°–ë–†–û–°–ò–¢–¨ –í–°–ï –î–ê–ù–ù–´–ï</button>
        </div>
    </div>

    <div id="pay-sheet-overlay" class="sheet-overlay" onclick="UI.closePaymentSheet()">
        <div class="sheet" onclick="event.stopPropagation()">
            <div style="width: 40px; height: 5px; background: var(--text-muted); border-radius: 10px; margin: 0 auto 25px;"></div>
            <h2 id="pay-sheet-title">–í—ã–±–æ—Ä –æ–ø–ª–∞—Ç—ã</h2>
            <p id="pay-sheet-price" style="font-size: 28px; font-weight: 900; color: var(--accent); margin: 10px 0 25px;">0 ‚ÇΩ</p>
            
            <div id="pay-step-1">
                <button class="btn btn-secondary" style="margin-bottom: 12px; justify-content: flex-start; padding-left: 20px;" onclick="Logic.selectPaymentMethod('card')">
                    <span style="font-size: 24px;">üí≥</span> 
                    <div style="text-align: left;">
                        <div style="font-weight: 700;">–ë–∞–Ω–∫–æ–≤—Å–∫–∞—è –∫–∞—Ä—Ç–∞</div>
                        <div style="font-size: 11px; color: var(--text-muted);">–†–§ / –°–ù–ì / –ú–∏—Ä</div>
                    </div>
                </button>
                <button class="btn btn-secondary" style="justify-content: flex-start; padding-left: 20px;" onclick="Logic.selectPaymentMethod('crypto')">
                    <span style="font-size: 24px;">üíé</span>
                    <div style="text-align: left;">
                        <div style="font-weight: 700;">–ö—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞</div>
                        <div style="font-size: 11px; color: var(--text-muted);">USDT / BTC / TON</div>
                    </div>
                </button>
            </div>

            <div id="pay-step-2" class="hidden">
                <div id="pay-instruction-text" style="background: var(--bg-surface); padding: 15px; border-radius: 15px; font-size: 13px; color: var(--text-secondary); margin-bottom: 20px;">
                    –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è...
                </div>
                <button class="btn btn-primary" onclick="Logic.submitPaymentVerification()">–Ø –û–ü–õ–ê–¢–ò–õ</button>
                <button class="btn btn-ghost" onclick="Logic.resetPaymentSteps()">‚Üê –ù–∞–∑–∞–¥</button>
            </div>
        </div>
    </div>

    <nav class="nav-bar">
        <a href="javascript:void(0)" class="nav-item active" onclick="Router.go('market')">
            <svg viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
            <span>–ú–ê–†–ö–ï–¢</span>
        </a>
        <a href="javascript:void(0)" class="nav-item" onclick="Router.go('profile')">
            <svg viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
            <span>–ü–†–û–§–ò–õ–¨</span>
        </a>
    </nav>

    <script>
        const TG = window.Telegram.WebApp;

        /**
         * DB & STATE MANAGEMENT
         */
        const App = {
            Config: JSON.parse(localStorage.getItem('z_cfg')) || {
                admin_id: 1577146268, // –ó–ê–ú–ï–ù–ò–¢–ï –ù–ê –°–í–û–ô ID
                lolz_token: 'eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzUxMiJ9.eyJzdWIiOjU3NzQxOTcsImlzcyI6Imx6dCIsImlhdCI6MTc2NjE1Mjg1MiwianRpIjoiODk4NTUzIiwic2NvcGUiOiJiYXNpYyByZWFkIHBvc3QgY29udmVyc2F0ZSBwYXltZW50IGludm9pY2UgY2hhdGJveCBtYXJrZXQiLCJleHAiOjE5MjM4MzI4NTJ9.tnYGD1LYkhLXKS3-OKqN28hirnz9782jiHU2eo6kotkE4-eAappDadFRnX4vLsSBc0zihc2M1oZt9EYx_Fex17Wxue9Vu7sLz61P8ujeSjUb-CWpPYVXPBIfcMJyJ_RBYXvdjJQTlxCxtiIS1l1EJIbukgJhe78RTxhuLy4lFRE',
                pay_crypto: '–ü–µ—Ä–µ–≤–µ–¥–∏—Ç–µ USDT TRC-20 –Ω–∞ –∞–¥—Ä–µ—Å: TXxxxxx...',
                pay_card: '–ü–µ—Ä–µ–≤–µ–¥–∏—Ç–µ –Ω–∞ –∫–∞—Ä—Ç—É: 4400 1122 3344 5566'
            },
            Data: {
                categories: JSON.parse(localStorage.getItem('z_cats')) || [],
                products: JSON.parse(localStorage.getItem('z_prods')) || [],
                orders: JSON.parse(localStorage.getItem('z_orders')) || []
            },
            State: {
                user: TG.initDataUnsafe.user || { id: 0, first_name: 'Tester' },
                activeCat: null,
                activeProd: null,
                activeMethod: null
            }
        };

        /**
         * ROUTER SYSTEM
         */
        const Router = {
            go(view) {
                document.querySelectorAll('.view').forEach(v => v.classList.add('hidden'));
                document.getElementById('view-' + view).classList.remove('hidden');
                
                // Nav UI
                document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
                if(view === 'market') document.querySelectorAll('.nav-item')[0].classList.add('active');
                if(view === 'profile') document.querySelectorAll('.nav-item')[1].classList.add('active');
                
                TG.HapticFeedback.selectionChanged();
                window.scrollTo(0,0);
            },
            back() {
                document.getElementById('cat-render-grid').classList.remove('hidden');
                document.getElementById('product-view').classList.add('hidden');
            }
        };

        /**
         * LOLZ API SERVICE
         */
        const LolzAPI = {
            async searchItem(params) {
                // –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–∞ –∫ –º–∞—Ä–∫–µ—Ç—É (—Ä–µ–∞–ª—å–Ω–æ —á–µ—Ä–µ–∑ –≤–∞—à –ø—Ä–æ–∫—Å–∏/—Å–µ—Ä–≤–µ—Ä)
                return new Promise(resolve => {
                    setTimeout(() => {
                        resolve({
                            item_id: Math.floor(Math.random() * 999999),
                            title: params.query,
                            price: params.min,
                            creds: "LOG:PASS:2FA_TOKEN_" + Math.random().toString(36).substr(2, 5).toUpperCase()
                        });
                    }, 1500);
                });
            }
        };

        /**
         * LOGIC CONTROLLER
         */
        const Logic = {
            init() {
                TG.ready();
                TG.expand();
                
                this.renderCategories();
                this.updateProfile();
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–¥–º–∏–Ω–∞
                if(App.State.user.id == App.Config.admin_id) {
                    document.getElementById('admin-access').classList.remove('hidden');
                }

                // –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤ –∞–¥–º–∏–Ω–∫—É
                document.getElementById('adm-lolz-token').value = App.Config.lolz_token;
                document.getElementById('adm-pay-crypto').value = App.Config.pay_crypto;
                document.getElementById('adm-pay-card').value = App.Config.pay_card;
            },

            renderCategories() {
                const grid = document.getElementById('cat-render-grid');
                if(App.Data.categories.length === 0) {
                    grid.innerHTML = '<p style="grid-column: 1/3; text-align: center; padding: 40px;">–¢–æ–≤–∞—Ä–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç...</p>';
                    return;
                }
                grid.innerHTML = App.Data.categories.map(c => `
                    <div class="card card-active" style="padding: 30px 15px; text-align: center; margin-bottom: 0;" onclick="Logic.openCategory('${c.id}')">
                        <div style="font-size: 40px; margin-bottom: 10px;">üì¶</div>
                        <div style="font-weight: 800; font-size: 15px;">${c.name}</div>
                    </div>
                `).join('');
                Admin.updateCatSelect();
            },

            openCategory(id) {
                const cat = App.Data.categories.find(x => x.id == id);
                App.State.activeCat = cat;
                
                document.getElementById('current-cat-name').innerText = cat.name;
                document.getElementById('cat-render-grid').classList.add('hidden');
                document.getElementById('product-view').classList.remove('hidden');
                
                this.renderProducts(id);
                TG.HapticFeedback.impactOccurred('medium');
            },

            renderProducts(catId) {
                const list = document.getElementById('product-render-list');
                const prods = App.Data.products.filter(p => p.catId == catId);
                
                if(prods.length === 0) {
                    list.innerHTML = '<p style="text-align: center; padding: 30px;">–ù–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤ –≤ —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</p>';
                    return;
                }

                list.innerHTML = prods.map(p => `
                    <div class="card" style="display: flex; justify-content: space-between; align-items: center; padding: 18px;">
                        <div>
                            <div style="font-weight: 800; font-size: 16px; margin-bottom: 4px;">${p.name}</div>
                            <div class="badge badge-blue">Lolz Sync</div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-size: 18px; font-weight: 900; color: var(--accent);">${p.price} ‚ÇΩ</div>
                            <button class="btn btn-primary" style="padding: 8px 15px; font-size: 12px; margin-top: 8px;" onclick="Logic.openPayment('${p.id}')">–ö—É–ø–∏—Ç—å</button>
                        </div>
                    </div>
                `).join('');
            },

            openPayment(id) {
                const prod = App.Data.products.find(x => x.id == id);
                App.State.activeProd = prod;
                
                document.getElementById('pay-sheet-price').innerText = prod.price + ' ‚ÇΩ';
                UI.openPaymentSheet();
            },

            selectPaymentMethod(method) {
                App.State.activeMethod = method;
                document.getElementById('pay-step-1').classList.add('hidden');
                document.getElementById('pay-step-2').classList.remove('hidden');
                
                const text = method === 'card' ? App.Config.pay_card : App.Config.pay_crypto;
                document.getElementById('pay-instruction-text').innerText = text;
                TG.HapticFeedback.impactOccurred('light');
            },

            resetPaymentSteps() {
                document.getElementById('pay-step-1').classList.remove('hidden');
                document.getElementById('pay-step-2').classList.add('hidden');
            },

            async submitPaymentVerification() {
                TG.showConfirm("–í—ã –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç–µ –æ–ø–ª–∞—Ç—É? –ü–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –Ω–∞—á–Ω–µ—Ç—Å—è –ø–æ–∏—Å–∫ –∞–∫–∫–∞—É–Ω—Ç–∞ –Ω–∞ Lolz.", async (ok) => {
                    if(!ok) return;
                    
                    UI.closePaymentSheet();
                    TG.MainButton.setText("–ü–û–ò–°–ö –ò –ü–û–ö–£–ü–ö–ê –ù–ê LOLZ...");
                    TG.MainButton.show();
                    TG.MainButton.showProgress();

                    // –†–µ–∞–ª—å–Ω—ã–π –≤—ã–∑–æ–≤ API Lolz (—á–µ—Ä–µ–∑ –∑–∞–≥–ª—É—à–∫—É)
                    const p = App.State.activeProd;
                    const result = await LolzAPI.searchItem({
                        min: p.lz_min, max: p.lz_max, origin: p.lz_origin, query: p.lz_query
                    });

                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∑–∞–∫–∞–∑
                    const order = {
                        id: Date.now(),
                        name: p.name,
                        price: p.price,
                        creds: result.creds,
                        date: new Date().toLocaleString()
                    };
                    
                    App.Data.orders.push(order);
                    localStorage.setItem('z_orders', JSON.stringify(App.Data.orders));
                    
                    TG.MainButton.hideProgress();
                    TG.MainButton.hide();
                    
                    this.updateProfile();
                    TG.HapticFeedback.notificationOccurred('success');
                    
                    TG.showConfirm(`–¢–û–í–ê–† –ö–£–ü–õ–ï–ù!\n\n–î–∞–Ω–Ω—ã–µ: ${order.creds}\n\n–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤ –±—É—Ñ–µ—Ä?`, (copy) => {
                        if(copy) {
                            navigator.clipboard.writeText(order.creds);
                            TG.showAlert("–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!");
                        }
                    });
                });
            },

            updateProfile() {
                document.getElementById('u-name').innerText = App.State.user.first_name;
                document.getElementById('u-id-display').innerText = "ID: " + App.State.user.id;
                document.getElementById('u-avatar').innerText = App.State.user.first_name[0];
                
                const totalSpent = App.Data.orders.reduce((acc, curr) => acc + curr.price, 0);
                document.getElementById('stat-deals').innerText = App.Data.orders.length;
                document.getElementById('stat-spent').innerText = totalSpent + ' ‚ÇΩ';
            },

            showHistory() {
                if(App.Data.orders.length === 0) {
                    TG.showAlert("–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –ø–æ–∫—É–ø–æ–∫.");
                    return;
                }
                const list = App.Data.orders.map(o => `${o.date} | ${o.name}\n–î–∞–Ω–Ω—ã–µ: ${o.creds}`).join('\n\n---\n\n');
                TG.showAlert("–í–ê–®–ò –ü–û–ö–£–ü–ö–ò:\n\n" + list);
            }
        };

        /**
         * ADMIN CONTROLLER
         */
        const Admin = {
            saveGlobalConfig() {
                App.Config.lolz_token = document.getElementById('adm-lolz-token').value;
                App.Config.pay_crypto = document.getElementById('adm-pay-crypto').value;
                App.Config.pay_card = document.getElementById('adm-pay-card').value;
                
                localStorage.setItem('z_cfg', JSON.stringify(App.Config));
                TG.showAlert("–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!");
            },

            addCategory() {
                const name = document.getElementById('adm-cat-name').value;
                if(!name) return;

                const newCat = { id: Date.now(), name: name };
                App.Data.categories.push(newCat);
                localStorage.setItem('z_cats', JSON.stringify(App.Data.categories));
                
                document.getElementById('adm-cat-name').value = '';
                Logic.renderCategories();
                TG.showAlert("–ö–∞—Ç–µ–≥–æ—Ä–∏—è —Å–æ–∑–¥–∞–Ω–∞!");
            },

            updateCatSelect() {
                const sel = document.getElementById('adm-p-cat-select');
                sel.innerHTML = App.Data.categories.map(c => `<option value="${c.id}">${c.name}</option>`).join('');
            },

            addProduct() {
                const name = document.getElementById('adm-p-name').value;
                const catId = document.getElementById('adm-p-cat-select').value;
                const price = document.getElementById('adm-p-price').value;
                
                const min = document.getElementById('adm-lz-min').value;
                const max = document.getElementById('adm-lz-max').value;
                const origin = document.getElementById('adm-lz-origin').value;
                const query = document.getElementById('adm-lz-query').value;

                if(!name || !price) {
                    TG.showAlert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ —Ü–µ–Ω—É!");
                    return;
                }

                const newProd = {
                    id: Date.now(),
                    catId, name, price: Number(price),
                    lz_min: min, lz_max: max, lz_origin: origin, lz_query: query
                };

                App.Data.products.push(newProd);
                localStorage.setItem('z_prods', JSON.stringify(App.Data.products));
                
                TG.showAlert("–¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω!");
                Router.go('market');
                Logic.renderCategories();
            },

            resetAllData() {
                TG.showConfirm("–í–´ –£–í–ï–†–ï–ù–´? –≠—Ç–æ —É–¥–∞–ª–∏—Ç –≤—Å–µ —Ç–æ–≤–∞—Ä—ã, –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏!", (ok) => {
                    if(ok) {
                        localStorage.clear();
                        location.reload();
                    }
                });
            }
        };

        /**
         * UI HELPERS
         */
        const UI = {
            openPaymentSheet() {
                document.getElementById('pay-sheet-overlay').classList.add('active');
                Logic.resetPaymentSteps();
            },
            closePaymentSheet() {
                document.getElementById('pay-sheet-overlay').classList.remove('active');
            }
        };

        // RUN APP
        Logic.init();

    </script>
</body>
</html>
