<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Elite Digital Ecosystem v3.0</title>

    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫ -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

    <style>
        /* 
        ========================================
        CSS –ü–ï–†–ï–ú–ï–ù–ù–´–ï –ò –¢–ï–ú–ê
        ========================================
        */
        :root {
            --bg-main: #f4f4f7;
            --bg-card: #ffffff;
            --text-primary: #1c1c1e;
            --text-secondary: #8e8e93;
            --accent: #007aff;
            --border: #d1d1d6;
            --success: #34c759;
            --warning: #ff9500;
            --error: #ff3b30;
            --radius-xl: 24px;
            --radius-lg: 18px;
            --radius-md: 12px;
            --shadow: 0 10px 40px rgba(0,0,0,0.04);
            --font-main: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            --safe-bottom: env(safe-area-inset-bottom);
        }

        /* –¢–µ–º–Ω–∞—è —Ç–µ–º–∞ Telegram */
        @media (prefers-color-scheme: dark) {
            :root {
                --bg-main: #000000;
                --bg-card: #1c1c1e;
                --text-primary: #ffffff;
                --text-secondary: #a1a1a6;
                --border: #2c2c2e;
                --shadow: 0 10px 40px rgba(0,0,0,0.3);
            }
        }

        /* 
        ========================================
        –ë–ê–ó–û–í–´–ï –°–¢–ò–õ–ò
        ========================================
        */
        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            font-family: var(--font-main);
        }

        body {
            background-color: var(--bg-main);
            color: var(--text-primary);
            margin: 0;
            padding: 0;
            user-select: none;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }

        .app-wrapper {
            max-width: 650px;
            margin: 0 auto;
            min-height: 100vh;
            padding: 20px 16px 140px;
            display: flex;
            flex-direction: column;
        }

        /* 
        ========================================
        –°–¢–†–ê–ù–ò–¶–´ –ò –ê–ù–ò–ú–ê–¶–ò–ò
        ========================================
        */
        .page {
            display: none;
            animation: pageSlideIn 0.4s cubic-bezier(0.1, 0.7, 0.1, 1);
        }

        .page.active {
            display: block;
        }

        @keyframes pageSlideIn {
            from { opacity: 0; transform: translateX(20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        /* 
        ========================================
        –¢–ò–ü–û–ì–†–ê–§–ò–ö–ê
        ========================================
        */
        h1 { font-size: 32px; font-weight: 800; margin-bottom: 8px; letter-spacing: -1.2px; }
        h2 { font-size: 20px; font-weight: 700; margin: 24px 0 16px; letter-spacing: -0.4px; }
        .description { font-size: 15px; color: var(--text-secondary); margin-bottom: 24px; }
        .label-small { font-size: 11px; font-weight: 800; text-transform: uppercase; color: var(--text-secondary); letter-spacing: 0.8px; margin-bottom: 6px; display: block; }

        /* 
        ========================================
        –ö–û–ú–ü–û–ù–ï–ù–¢–´: –ö–ê–†–¢–û–ß–ö–ò, –ö–ù–û–ü–ö–ò
        ========================================
        */
        .card {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: 20px;
            margin-bottom: 16px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            transition: all 0.2s ease;
        }

        .card:active { transform: scale(0.98); }

        .btn {
            background: var(--accent);
            color: #ffffff;
            border: none;
            padding: 16px 24px;
            border-radius: var(--radius-md);
            font-size: 17px;
            font-weight: 700;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .btn:active { transform: scale(0.96); opacity: 0.85; }
        .btn-secondary { background: var(--border); color: var(--text-primary); }
        .btn-outline { background: transparent; border: 1.5px solid var(--border); color: var(--text-primary); }
        .btn-danger { color: var(--error); border-color: var(--error); }
        .btn-sm { padding: 10px 16px; font-size: 14px; border-radius: 10px; width: auto; }

        /* 
        ========================================
        –§–û–†–ú–´ –ò –ò–ù–ü–£–¢–´
        ========================================
        */
        .input-group { margin-bottom: 20px; }
        
        input, select, textarea {
            width: 100%;
            padding: 14px 16px;
            border-radius: var(--radius-md);
            border: 1.5px solid var(--border);
            background: var(--bg-card);
            color: var(--text-primary);
            font-size: 16px;
            outline: none;
            transition: border-color 0.2s;
            appearance: none;
        }

        input:focus, textarea:focus { border-color: var(--accent); }

        .search-container {
            position: relative;
            margin-bottom: 24px;
        }

        .search-container input {
            padding-left: 44px;
            background: var(--bg-card);
            border: none;
            box-shadow: var(--shadow);
        }

        .search-icon {
            position: absolute;
            left: 16px; top: 50%;
            transform: translateY(-50%);
            font-size: 18px;
            color: var(--text-secondary);
        }

        /* 
        ========================================
        –ú–ê–ì–ê–ó–ò–ù: –ö–ê–¢–ï–ì–û–†–ò–ò
        ========================================
        */
        .cat-slider {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding: 4px 16px 20px;
            margin: 0 -16px;
            scrollbar-width: none;
        }
        .cat-slider::-webkit-scrollbar { display: none; }

        .chip {
            background: var(--bg-card);
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 700;
            white-space: nowrap;
            border: 1px solid var(--border);
            color: var(--text-secondary);
            transition: all 0.2s;
        }

        .chip.active {
            background: var(--text-primary);
            color: var(--bg-main);
            border-color: var(--text-primary);
        }

        /* 
        ========================================
        –ù–ê–í–ò–ì–ê–¶–ò–Ø (TAB BAR)
        ========================================
        */
        .nav-tabs {
            position: fixed;
            bottom: 0; left: 0; right: 0;
            background: rgba(var(--bg-card), 0.85);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            display: flex;
            padding: 12px 0 calc(12px + var(--safe-bottom));
            border-top: 0.5px solid var(--border);
            z-index: 2000;
        }

        .tab-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            color: var(--text-secondary);
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.4px;
            cursor: pointer;
        }

        .tab-item.active { color: var(--accent); }
        .tab-icon { font-size: 24px; }

        /* 
        ========================================
        –°–¢–ê–¢–£–°–´ –ò –ë–ï–î–ñ–ò
        ========================================
        */
        .badge {
            padding: 5px 12px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 800;
            text-transform: uppercase;
        }
        .status-review { background: rgba(255, 149, 0, 0.12); color: var(--warning); }
        .status-done { background: rgba(52, 199, 89, 0.12); color: var(--success); }
        .status-reject { background: rgba(255, 59, 48, 0.12); color: var(--error); }

        /* 
        ========================================
        –°–ü–ï–¶-–í–ò–î–ñ–ï–¢–´ –ê–î–ú–ò–ù–ö–ò
        ========================================
        */
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 24px;
        }

        .stat-item {
            background: var(--bg-card);
            padding: 20px;
            border-radius: var(--radius-lg);
            border: 1px solid var(--border);
        }

        .stat-val { font-size: 26px; font-weight: 800; margin-bottom: 4px; }
        .stat-lbl { font-size: 12px; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; }

        /* 
        ========================================
        –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–û–ï
        ========================================
        */
        #master-loader {
            position: fixed; inset: 0;
            background: var(--bg-main);
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            z-index: 9999;
        }

        .loading-ring {
            width: 45px; height: 45px;
            border: 4px solid var(--border);
            border-top: 4px solid var(--accent);
            border-radius: 50%;
            animation: ringSpin 0.8s linear infinite;
        }

        @keyframes ringSpin { to { transform: rotate(360deg); } }

        .hidden { display: none !important; }
        .price-tag { font-size: 22px; font-weight: 900; color: var(--accent); }
        .img-full { width: 100%; border-radius: 14px; margin: 15px 0; border: 1px solid var(--border); box-shadow: var(--shadow); cursor: pointer; }

        .order-info-block {
            background: var(--bg-main);
            padding: 16px;
            border-radius: var(--radius-md);
            border: 1px dashed var(--border);
            font-family: "SF Mono", "Menlo", monospace;
            font-size: 13px;
            word-break: break-all;
            margin-top: 12px;
        }
    </style>
</head>
<body>

    <!-- –ì–õ–û–ë–ê–õ–¨–ù–´–ô –ó–ê–ì–†–£–ó–ß–ò–ö -->
    <div id="master-loader">
        <div class="loading-ring"></div>
        <p style="margin-top: 20px; font-weight: 700; font-size: 14px; color: var(--text-secondary);">–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö...</p>
    </div>

    <div class="app-wrapper">

        <!-- –°–¢–†–ê–ù–ò–¶–ê 1: –ì–õ–ê–í–ù–ê–Ø (–í–ò–¢–†–ò–ù–ê) -->
        <section id="page-shop" class="page active">
            <h1>–ú–∞–≥–∞–∑–∏–Ω</h1>
            <p class="description">–¶–∏—Ñ—Ä–æ–≤—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã —Å –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–æ–π.</p>

            <div class="search-container">
                <span class="search-icon">üîç</span>
                <input type="text" id="shop-search" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é..." oninput="filterStore()">
            </div>

            <div class="cat-slider" id="shop-cats-list">
                <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ä–µ–Ω–¥–µ—Ä—è—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
            </div>

            <div id="shop-items-grid">
                <!-- –¢–æ–≤–∞—Ä—ã —Ä–µ–Ω–¥–µ—Ä—è—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
            </div>
        </section>

        <!-- –°–¢–†–ê–ù–ò–¶–ê 2: –ß–ï–ö–ê–£–¢ (–û–§–û–†–ú–õ–ï–ù–ò–ï) -->
        <section id="page-checkout" class="page">
            <div style="display:flex; align-items:center; gap:12px; margin-bottom:24px;">
                <button class="btn btn-secondary btn-sm" onclick="switchTab('shop')">‚Üê</button>
                <h1 style="margin:0">–û–ø–ª–∞—Ç–∞</h1>
            </div>

            <div class="card">
                <span class="label-small">–†–µ–∫–≤–∏–∑–∏—Ç—ã –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞</span>
                <div id="check-reks-display" style="font-size:17px; font-weight:700; margin:10px 0; white-space:pre-wrap; background:rgba(0,0,0,0.03); padding:15px; border-radius:12px;"></div>
                <div style="display:flex; justify-content:space-between; align-items:center; margin-top:20px;">
                    <span style="font-weight:600;">–ò—Ç–æ–≥–æ:</span>
                    <span class="price-tag" id="check-price-display">0 ‚ÇΩ</span>
                </div>
            </div>

            <div class="card">
                <span class="label-small">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</span>
                <p style="margin-bottom:15px; font-size:14px;">–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç —á–µ–∫–∞ –æ–± –æ–ø–ª–∞—Ç–µ. –ú—ã –ø—Ä–æ–≤–µ—Ä–∏–º –µ–≥–æ –≤—Ä—É—á–Ω—É—é.</p>
                <input type="file" id="check-file-input" accept="image/*">
                <button class="btn" style="margin-top:25px;" onclick="createOrderRequest()">
                    –û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É
                </button>
            </div>
        </section>

        <!-- –°–¢–†–ê–ù–ò–¶–ê 3: –ó–ê–ö–ê–ó–´ –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø -->
        <section id="page-orders" class="page">
            <h1>–ú–æ–∏ –∑–∞–∫–∞–∑—ã</h1>
            <p class="description">–°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –≤–∞—à–∏—Ö –ø–æ–∫—É–ø–æ–∫ –∏ –∏—Ö —Å—Ç–∞—Ç—É—Å—ã.</p>
            <div id="user-orders-history">
                <!-- –ó–∞–∫–∞–∑—ã —Ä–µ–Ω–¥–µ—Ä—è—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
            </div>
        </section>

        <!-- –°–¢–†–ê–ù–ò–¶–ê 4: –ü–†–û–§–ò–õ–¨ -->
        <section id="page-profile" class="page">
            <h1>–ü—Ä–æ—Ñ–∏–ª—å</h1>
            <div class="card" style="text-align:center;">
                <div id="prof-avatar" style="width:70px; height:70px; background:var(--accent); color:white; border-radius:50%; margin:0 auto 15px; display:flex; align-items:center; justify-content:center; font-size:28px; font-weight:900;">U</div>
                <div class="h2" style="margin:0" id="prof-name">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</div>
                <p class="description" id="prof-id" style="margin-top:5px;">ID: 000000000</p>
            </div>

            <h2>–ü–æ–¥–¥–µ—Ä–∂–∫–∞</h2>
            <div class="card" onclick="openSupport()">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <div style="font-weight:700;">–°–≤—è–∑–∞—Ç—å—Å—è —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º</div>
                    <span style="color:var(--text-secondary);">‚Üí</span>
                </div>
            </div>
        </section>

        <!-- –°–¢–†–ê–ù–ò–¶–ê 5: –ê–î–ú–ò–ù-–ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø -->
        <section id="page-admin-auth" class="page">
            <h1>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h1>
            <p class="description">–¢—Ä–µ–±—É–µ—Ç—Å—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é.</p>
            <div class="card">
                <div class="input-group">
                    <label class="label-small">–ü–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</label>
                    <input type="password" id="admin-pass-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á –¥–æ—Å—Ç—É–ø–∞...">
                </div>
                <button class="btn" onclick="doAdminLogin()">–ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è</button>
            </div>
        </section>

        <!-- –°–¢–†–ê–ù–ò–¶–ê 6: –ê–î–ú–ò–ù-–ö–û–ù–°–û–õ–¨ -->
        <section id="page-admin-console" class="page">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                <h1 style="margin:0">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h1>
                <button class="btn btn-secondary btn-sm" onclick="doAdminLogout()">–í—ã—Ö–æ–¥</button>
            </div>

            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-val" id="adm-stat-revenue">0 ‚ÇΩ</div>
                    <div class="stat-lbl">–í—ã—Ä—É—á–∫–∞</div>
                </div>
                <div class="stat-item">
                    <div class="stat-val" id="adm-stat-sales">0</div>
                    <div class="stat-lbl">–ü—Ä–æ–¥–∞–∂–∏</div>
                </div>
            </div>

            <!-- –†–∞–∑–¥–µ–ª: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã -->
            <div class="card">
                <h2 style="margin-top:0;">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</h2>
                <div class="input-group">
                    <label class="label-small">–†–µ–∫–≤–∏–∑–∏—Ç—ã –¥–ª—è –æ–ø–ª–∞—Ç—ã</label>
                    <textarea id="adm-set-reks" rows="3"></textarea>
                </div>
                <div class="input-group">
                    <label class="label-small">–°—Å—ã–ª–∫–∞ –Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫—É (t.me/username)</label>
                    <input type="text" id="adm-set-support">
                </div>
                <div class="input-group">
                    <label class="label-small">ImgBB API Key</label>
                    <input type="text" id="adm-set-imgbb">
                </div>
                <div class="input-group">
                    <label class="label-small">Telegram Bot Token</label>
                    <input type="text" id="adm-set-bot">
                </div>
                <div class="input-group">
                    <label class="label-small">–í–∞—à Telegram ID (–¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π)</label>
                    <input type="text" id="adm-set-chatid">
                </div>
                <div class="input-group">
                    <label class="label-small">Lolz Market Token</label>
                    <input type="text" id="adm-set-lzt">
                </div>
                <div class="input-group">
                    <label class="label-small">–°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∞</label>
                    <input type="text" id="adm-set-pass" placeholder="–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º, —á—Ç–æ–±—ã –Ω–µ –º–µ–Ω—è—Ç—å">
                </div>
                <button class="btn btn-sm" onclick="saveAllSettings()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é</button>
            </div>

            <!-- –†–∞–∑–¥–µ–ª: –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
            <div class="card">
                <h2>–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</h2>
                <div style="display:flex; gap:10px; margin-bottom:15px;">
                    <input type="text" id="adm-new-cat-name" placeholder="–ù–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è...">
                    <button class="btn btn-sm" onclick="addCategory()">+</button>
                </div>
                <div id="adm-cats-list"></div>
            </div>

            <!-- –†–∞–∑–¥–µ–ª: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ -->
            <div class="card">
                <h2>–°–æ–∑–¥–∞—Ç—å —Ç–æ–≤–∞—Ä</h2>
                <div class="input-group">
                    <label class="label-small">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
                    <input type="text" id="adm-p-name">
                </div>
                <div class="input-group">
                    <label class="label-small">–¶–µ–Ω–∞ (‚ÇΩ)</label>
                    <input type="number" id="adm-p-price">
                </div>
                <div class="input-group">
                    <label class="label-small">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                    <select id="adm-p-cat"></select>
                </div>
                <div class="input-group">
                    <label class="label-small">–ú–µ—Ç–æ–¥ –≤—ã–¥–∞—á–∏</label>
                    <select id="adm-p-type" onchange="toggleProductFields()">
                        <option value="text">–¢–µ–∫—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ</option>
                        <option value="file">–°—Å—ã–ª–∫–∞ –Ω–∞ —Ñ–∞–π–ª</option>
                        <option value="lolz">Lolz Market API</option>
                    </select>
                </div>
                <div id="adm-f-manual">
                    <label class="label-small">–ö–æ–Ω—Ç–µ–Ω—Ç —Ç–æ–≤–∞—Ä–∞</label>
                    <textarea id="adm-p-data" rows="3" placeholder="–ö–ª—é—á, –∞–∫–∫–∞—É–Ω—Ç –∏–ª–∏ —Å—Å—ã–ª–∫–∞..."></textarea>
                </div>
                <div id="adm-f-lolz" class="hidden">
                    <label class="label-small">–°—Å—ã–ª–∫–∞ –ø–æ–∏—Å–∫–∞ (Lolz Search URL)</label>
                    <input type="text" id="adm-p-lolz" placeholder="https://lzt.market/telegram/...">
                </div>
                <button class="btn" style="margin-top:15px;" onclick="addProduct()">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
            </div>

            <h2>–ó–∞–∫–∞–∑—ã –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏</h2>
            <div id="adm-orders-review"></div>

            <h2>–ë–∞–∑–∞ —Ç–æ–≤–∞—Ä–æ–≤</h2>
            <div id="adm-products-inventory"></div>
        </section>

    </div>

    <!-- –ù–ò–ñ–ù–ï–ï –ú–ï–ù–Æ (TAB BAR) -->
    <nav class="nav-tabs">
        <div class="tab-item active" onclick="switchTab('shop')">
            <span class="tab-icon">üõçÔ∏è</span>
            <span>–í–∏—Ç—Ä–∏–Ω–∞</span>
        </div>
        <div class="tab-item" onclick="switchTab('orders')">
            <span class="tab-icon">üì¶</span>
            <span>–ó–∞–∫–∞–∑—ã</span>
        </div>
        <div class="tab-item" onclick="switchTab('profile')">
            <span class="tab-icon">üë§</span>
            <span>–ü—Ä–æ—Ñ–∏–ª—å</span>
        </div>
        <div class="tab-item" id="nav-adm-item" onclick="switchTab('admin')">
            <span class="tab-icon">‚öôÔ∏è</span>
            <span>–ê–¥–º–∏–Ω</span>
        </div>
    </nav>

    <script>
        /* 
        ========================================
        1. –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø FIREBASE
        ========================================
        */
        const firebaseConfig = {
            apiKey: "AIzaSyApyvMlfHcFqPt1ROpnqCPXjgkuUjV1hus",
            databaseURL: "https://zikrov09-default-rtdb.firebaseio.com",
            projectId: "zikrov09",
        };

        firebase.initializeApp(firebaseConfig);
        const rdb = firebase.database();

        /* 
        ========================================
        2. –°–û–°–¢–û–Ø–ù–ò–ï –ò –ü–ï–†–ï–ú–ï–ù–ù–´–ï
        ========================================
        */
        let state = {
            products: {},
            categories: {},
            orders: {},
            settings: {},
            activeCat: 'all',
            search: ''
        };

        const tg = window.Telegram.WebApp;
        const user = tg.initDataUnsafe?.user || { id: 12345, first_name: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å' };
        let currentCheckoutId = null;

        /* 
        ========================================
        3. –°–õ–£–®–ê–¢–ï–õ–ò –ò –ó–ê–ì–†–£–ó–ö–ê
        ========================================
        */
        document.addEventListener('DOMContentLoaded', () => {
            tg.ready();
            tg.expand();
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è
            document.getElementById('prof-name').innerText = user.first_name;
            document.getElementById('prof-id').innerText = `ID: ${user.id}`;
            document.getElementById('prof-avatar').innerText = user.first_name.charAt(0).toUpperCase();

            // Realtime —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
            rdb.ref('/').on('value', snapshot => {
                const data = snapshot.val() || {};
                state.products = data.products || {};
                state.categories = data.categories || {};
                state.orders = data.orders || {};
                state.settings = data.settings || {};

                renderStore();
                renderUserOrders();
                if(sessionStorage.getItem('isAdmin')) renderAdmin();
                
                document.getElementById('master-loader').style.display = 'none';
            });
        });

        /* 
        ========================================
        4. –ù–ê–í–ò–ì–ê–¶–ò–Ø (–†–û–£–¢–ò–ù–ì)
        ========================================
        */
        function switchTab(tab) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.tab-item').forEach(t => t.classList.remove('active'));

            let pageId = `page-${tab}`;
            if(tab === 'admin') {
                pageId = sessionStorage.getItem('isAdmin') ? 'page-admin-console' : 'page-admin-auth';
            }

            const targetPage = document.getElementById(pageId);
            if(targetPage) targetPage.classList.add('active');

            const tabIndex = { 'shop': 0, 'orders': 1, 'profile': 2, 'admin': 3 }[tab];
            document.querySelectorAll('.tab-item')[tabIndex].classList.add('active');

            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        /* 
        ========================================
        5. –õ–û–ì–ò–ö–ê –í–ò–¢–†–ò–ù–´
        ========================================
        */
        function filterStore() {
            state.search = document.getElementById('shop-search').value.toLowerCase();
            renderStoreProducts();
        }

        function setCategory(id) {
            state.activeCat = id;
            renderStoreCats();
            renderStoreProducts();
        }

        function renderStore() {
            renderStoreCats();
            renderStoreProducts();
        }

        function renderStoreCats() {
            const cont = document.getElementById('shop-cats-list');
            let html = `<div class="chip ${state.activeCat === 'all' ? 'active' : ''}" onclick="setCategory('all')">–í—Å–µ —Ç–æ–≤–∞—Ä—ã</div>`;
            
            Object.keys(state.categories).forEach(id => {
                const c = state.categories[id];
                html += `<div class="chip ${state.activeCat === id ? 'active' : ''}" onclick="setCategory('${id}')">${c.name}</div>`;
            });
            cont.innerHTML = html;
        }

        function renderStoreProducts() {
            const cont = document.getElementById('shop-items-grid');
            cont.innerHTML = '';

            const filteredIds = Object.keys(state.products).filter(id => {
                const p = state.products[id];
                const matchCat = state.activeCat === 'all' || p.catId === state.activeCat;
                const matchSearch = p.name.toLowerCase().includes(state.search);
                return matchCat && matchSearch;
            });

            if(filteredIds.length === 0) {
                cont.innerHTML = `<div style="text-align:center; padding:50px 0; color:var(--text-secondary);">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>`;
                return;
            }

            filteredIds.forEach(id => {
                const p = state.products[id];
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <div style="display:flex; justify-content:space-between; align-items:flex-start;">
                        <div style="flex:1">
                            <div style="font-size:19px; font-weight:800; margin-bottom:4px;">${p.name}</div>
                            <div style="font-size:12px; color:var(--text-secondary);">–¶–∏—Ñ—Ä–æ–≤–∞—è –ª–∏—Ü–µ–Ω–∑–∏—è ‚Ä¢ ${p.type === 'lolz' ? '–ê–≤—Ç–æ' : '–í—Ä—É—á–Ω—É—é'}</div>
                        </div>
                        <div class="price-tag">${p.price} ‚ÇΩ</div>
                    </div>
                    <button class="btn btn-sm" style="margin-top:18px; width:100%;" onclick="openCheckout('${id}')">–ö—É–ø–∏—Ç—å</button>
                `;
                cont.appendChild(card);
            });
        }

        /* 
        ========================================
        6. –ß–ï–ö–ê–£–¢ –ò –û–ü–õ–ê–¢–ê
        ========================================
        */
        function openCheckout(id) {
            currentCheckoutId = id;
            const p = state.products[id];
            document.getElementById('check-reks-display').innerText = state.settings.reks || '–†–µ–∫–≤–∏–∑–∏—Ç—ã –Ω–µ —É–∫–∞–∑–∞–Ω—ã.';
            document.getElementById('check-price-display').innerText = `${p.price} ‚ÇΩ`;
            
            // –ü—Ä—è—á–µ–º –≤–∏—Ç—Ä–∏–Ω—É, –æ—Ç–∫—Ä—ã–≤–∞–µ–º —á–µ–∫–∞—É—Ç
            document.getElementById('page-shop').classList.remove('active');
            document.getElementById('page-checkout').classList.add('active');
        }

        async function createOrderRequest() {
            const fileInput = document.getElementById('check-file-input');
            const file = fileInput.files[0];

            if(!file) return alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç –æ–ø–ª–∞—Ç—ã.');
            if(!state.settings.imgbb) return alert('–û—à–∏–±–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏: API ImgBB –Ω–µ –Ω–∞–π–¥–µ–Ω.');

            showGlobalLoader('–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è...');

            try {
                // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–∫—Ä–∏–Ω—à–æ—Ç–∞ –Ω–∞ ImgBB
                const fd = new FormData();
                fd.append('image', file);
                const res = await fetch(`https://api.imgbb.com/1/upload?key=${state.settings.imgbb}`, {
                    method: 'POST', body: fd
                });
                const imgData = await res.json();
                if(!imgData.success) throw new Error('ImgBB Upload Failed');

                const product = state.products[currentCheckoutId];
                const oid = 'ORD' + Date.now();
                
                const newOrder = {
                    id: oid,
                    uId: user.id,
                    uName: user.first_name + (user.username ? ` (@${user.username})` : ''),
                    pId: currentCheckoutId,
                    pName: product.name,
                    price: Number(product.price),
                    img: imgData.data.url,
                    status: 'review',
                    date: new Date().toLocaleString('ru-RU')
                };

                // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –±–∞–∑—É
                await rdb.ref('orders/' + oid).set(newOrder);

                // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ –¢–ì –ë–æ—Ç
                await notifyAdminViaBot(newOrder);

                alert('–ó–∞–∫–∞–∑ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω! –ú—ã –ø—Ä–æ–≤–µ—Ä–∏–º –æ–ø–ª–∞—Ç—É –≤ —Ç–µ—á–µ–Ω–∏–µ 15 –º–∏–Ω—É—Ç.');
                fileInput.value = '';
                switchTab('orders');

            } catch(e) {
                alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞: ' + e.message);
            } finally {
                hideGlobalLoader();
            }
        }

        async function notifyAdminViaBot(o) {
            const token = state.settings.bot;
            const cid = state.settings.chatid;
            if(!token || !cid) return;

            const text = `üí∞ <b>–ù–û–í–´–ô –ó–ê–ö–ê–ó!</b>\n\n` +
                         `üë§ –ö–ª–∏–µ–Ω—Ç: ${o.uName}\n` +
                         `üì¶ –¢–æ–≤–∞—Ä: ${o.pName}\n` +
                         `üíµ –°—É–º–º–∞: ${o.price} ‚ÇΩ\n\n` +
                         `üîó <a href="${o.img}">–°–∫—Ä–∏–Ω—à–æ—Ç –æ–ø–ª–∞—Ç—ã</a>`;
            
            try {
                await fetch(`https://api.telegram.org/bot${token}/sendMessage`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ chat_id: cid, text: text, parse_mode: 'HTML' })
                });
            } catch(e) { console.error('Bot Notify Failed', e); }
        }

        /* 
        ========================================
        7. –ò–°–¢–û–†–ò–Ø –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø
        ========================================
        */
        function renderUserOrders() {
            const cont = document.getElementById('user-orders-history');
            const myOrders = Object.values(state.orders).filter(o => o.uId == user.id).reverse();

            if(myOrders.length === 0) {
                cont.innerHTML = `<div style="text-align:center; padding:50px 0; color:var(--text-secondary);">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–∫–∞–∑–æ–≤</div>`;
                return;
            }

            cont.innerHTML = myOrders.map(o => `
                <div class="card">
                    <div style="display:flex; justify-content:space-between; margin-bottom:12px;">
                        <div>
                            <div style="font-weight:800; font-size:16px;">${o.pName}</div>
                            <div style="font-size:12px; color:var(--text-secondary);">${o.date}</div>
                        </div>
                        <span class="badge status-${o.status}">${o.status === 'review' ? '–ü—Ä–æ–≤–µ—Ä–∫–∞' : (o.status === 'done' ? '–í—ã–ø–æ–ª–Ω–µ–Ω' : '–û—Ç–∫–ª–æ–Ω–µ–Ω')}</span>
                    </div>
                    <div style="font-weight:800; color:var(--accent); font-size:18px; margin-bottom:10px;">${o.price} ‚ÇΩ</div>
                    ${o.status === 'done' ? `
                        <div class="order-info-block">
                            <b>–ö–û–ù–¢–ï–ù–¢:</b><br>${o.data}
                        </div>
                    ` : ''}
                </div>
            `).join('');
        }

        function openSupport() {
            const support = state.settings.support;
            if(support) tg.openTelegramLink('https://' + support.replace('@', 't.me/'));
            else alert('–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞');
        }

        /* 
        ========================================
        8. –ê–î–ú–ò–ù-–ü–ê–ù–ï–õ–¨ (–õ–û–ì–ò–ö–ê –ò CRUD)
        ========================================
        */
        function doAdminLogin() {
            const pass = document.getElementById('admin-pass-input').value;
            const correctPass = state.settings.adminPass || 'admin';
            
            if(pass === correctPass) {
                sessionStorage.setItem('isAdmin', 'true');
                switchTab('admin');
            } else {
                alert('–ù–µ–≤–µ—Ä–Ω—ã–π –∫–ª—é—á –¥–æ—Å—Ç—É–ø–∞');
            }
        }

        function doAdminLogout() {
            sessionStorage.clear();
            location.reload();
        }

        function toggleProductFields() {
            const type = document.getElementById('adm-p-type').value;
            document.getElementById('adm-f-manual').classList.toggle('hidden', type === 'lolz');
            document.getElementById('adm-f-lolz').classList.toggle('hidden', type !== 'lolz');
        }

        function renderAdmin() {
            const s = state.settings;
            document.getElementById('adm-set-reks').value = s.reks || '';
            document.getElementById('adm-set-support').value = s.support || '';
            document.getElementById('adm-set-imgbb').value = s.imgbb || '';
            document.getElementById('adm-set-bot').value = s.bot || '';
            document.getElementById('adm-set-chatid').value = s.chatid || '';
            document.getElementById('adm-set-lzt').value = s.lolz || '';

            // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
            const doneOrders = Object.values(state.orders).filter(o => o.status === 'done');
            const totalRev = doneOrders.reduce((sum, o) => sum + Number(o.price), 0);
            document.getElementById('adm-stat-revenue').innerText = `${totalRev} ‚ÇΩ`;
            document.getElementById('adm-stat-sales').innerText = doneOrders.length;

            // –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –≤ —Å–µ–ª–µ–∫—Ç–µ –∏ —Å–ø–∏—Å–∫–µ
            const catSelect = document.getElementById('adm-p-cat');
            const catList = document.getElementById('adm-cats-list');
            catSelect.innerHTML = ''; catList.innerHTML = '';
            
            Object.keys(state.categories).forEach(id => {
                const c = state.categories[id];
                catSelect.innerHTML += `<option value="${id}">${c.name}</option>`;
                catList.innerHTML += `
                    <div style="display:flex; justify-content:space-between; padding:8px 0; border-bottom:1px solid var(--border);">
                        <span>${c.name}</span>
                        <span style="color:var(--error); font-weight:700;" onclick="deleteCategory('${id}')">–£–¥–∞–ª–∏—Ç—å</span>
                    </div>
                `;
            });

            // –ó–∞–∫–∞–∑—ã –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É
            const revCont = document.getElementById('adm-orders-review');
            const reviewing = Object.values(state.orders).filter(o => o.status === 'review');
            revCont.innerHTML = reviewing.map(o => `
                <div class="card" style="border-left:5px solid var(--warning);">
                    <div style="font-weight:800;">${o.pName} | ${o.price}‚ÇΩ</div>
                    <div style="font-size:12px; margin:4px 0;">–ö–ª–∏–µ–Ω—Ç: ${o.uName}</div>
                    <img src="${o.img}" class="img-full" onclick="window.open('${o.img}')">
                    <div style="display:flex; gap:10px; margin-top:10px;">
                        <button class="btn btn-sm" onclick="approveOrder('${o.id}')">–ü—Ä–∏–Ω—è—Ç—å</button>
                        <button class="btn btn-sm btn-outline btn-danger" onclick="rejectOrder('${o.id}')">–û—Ç–∫–∞–∑</button>
                    </div>
                </div>
            `).join('') || '<p style="color:var(--text-secondary); font-size:13px;">–ó–∞–∫–∞–∑–æ–≤ –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–µ—Ç</p>';

            // –ë–∞–∑–∞ —Ç–æ–≤–∞—Ä–æ–≤
            const invCont = document.getElementById('adm-products-inventory');
            invCont.innerHTML = Object.keys(state.products).map(id => `
                <div style="display:flex; justify-content:space-between; align-items:center; padding:12px 0; border-bottom:1px solid var(--border);">
                    <div>
                        <div style="font-weight:700; font-size:14px;">${state.products[id].name}</div>
                        <div style="font-size:11px; color:var(--text-secondary);">${state.products[id].price} ‚ÇΩ ‚Ä¢ ${state.products[id].type}</div>
                    </div>
                    <button class="btn btn-sm btn-danger" onclick="deleteProduct('${id}')">–£–¥–∞–ª–∏—Ç—å</button>
                </div>
            `).join('');
        }

        /* 
        ========================================
        9. API & FIREBASE ACTIONS
        ========================================
        */
        async function approveOrder(oid) {
            const o = state.orders[oid];
            const p = state.products[o.pId];
            showGlobalLoader('–í—ã–ø–æ–ª–Ω—è–µ–º –≤—ã–¥–∞—á—É...');

            try {
                let dataToIssue = "";
                
                if(p.type === 'lolz') {
                    dataToIssue = await lztAutoPurchase(p.lolzUrl);
                } else {
                    dataToIssue = p.data || "–ö–æ–Ω—Ç–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω";
                }

                await rdb.ref('orders/' + oid).update({ status: 'done', data: dataToIssue });
                alert('–ó–∞–∫–∞–∑ –æ–¥–æ–±—Ä–µ–Ω! –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∏–ª —Ç–æ–≤–∞—Ä.');
            } catch(e) {
                alert('–û—à–∏–±–∫–∞ –≤—ã–¥–∞—á–∏: ' + e.message);
            } finally {
                hideGlobalLoader();
            }
        }

        async function lztAutoPurchase(searchUrl) {
            const token = state.settings.lolz;
            if(!token) throw new Error('Lolz Token –Ω–µ —É–∫–∞–∑–∞–Ω –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö');

            const proxy = "https://corsproxy.io/?";
            const apiBase = encodeURIComponent(`https://api.lzt.market/list?${searchUrl.split('?')[1] || ''}`);
            
            const response = await fetch(proxy + apiBase, { headers: { 'Authorization': `Bearer ${token}` } });
            if(!response.ok) throw new Error('–û—à–∏–±–∫–∞ API Lolz Market (CORS)');
            
            const data = await response.json();
            if(!data.items || data.items.length === 0) throw new Error('–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ –ú–∞—Ä–∫–µ—Ç–µ');
            
            const first = data.items[0];
            return `–ê–∫–∫–∞—É–Ω—Ç: ${first.item_title}\n–¶–µ–Ω–∞: ${first.price} ${first.currency}\n–°—Å—ã–ª–∫–∞: https://lzt.market/${first.item_id}/\n–ò–Ω—Ñ–æ: –°–º. —Ä–∞–∑–¥–µ–ª "–ü–æ–∫—É–ø–∫–∏" –Ω–∞ —Å–∞–º–æ–º –ú–∞—Ä–∫–µ—Ç–µ.`;
        }

        function rejectOrder(oid) {
            if(confirm('–û—Ç–∫–ª–æ–Ω–∏—Ç—å –æ–ø–ª–∞—Ç—É?')) rdb.ref('orders/' + oid).update({ status: 'reject' });
        }

        function saveAllSettings() {
            const newPass = document.getElementById('adm-set-pass').value;
            const s = {
                reks: document.getElementById('adm-set-reks').value,
                support: document.getElementById('adm-set-support').value,
                imgbb: document.getElementById('adm-set-imgbb').value,
                bot: document.getElementById('adm-set-bot').value,
                chatid: document.getElementById('adm-set-chatid').value,
                lolz: document.getElementById('adm-set-lzt').value,
                adminPass: newPass || state.settings.adminPass || 'admin'
            };
            rdb.ref('settings').set(s).then(() => alert('–°–∏—Å—Ç–µ–º–∞ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∞!'));
        }

        function addCategory() {
            const name = document.getElementById('adm-new-cat-name').value;
            if(!name) return;
            rdb.ref('categories').push({ name: name });
            document.getElementById('adm-new-cat-name').value = '';
        }

        function deleteCategory(id) {
            if(confirm('–£–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é?')) rdb.ref('categories/' + id).remove();
        }

        function addProduct() {
            const name = document.getElementById('adm-p-name').value;
            const price = document.getElementById('adm-p-price').value;
            const catId = document.getElementById('adm-p-cat').value;
            const type = document.getElementById('adm-p-type').value;
            const data = document.getElementById('adm-p-data').value;
            const lolz = document.getElementById('adm-p-lolz').value;

            if(!name || !price || !catId) return alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');

            const pObj = {
                name, price: Number(price), catId, type,
                data: type === 'lolz' ? '' : data,
                lolzUrl: type === 'lolz' ? lolz : ''
            };

            rdb.ref('products').push(pObj).then(() => {
                alert('–¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω –Ω–∞ –≤–∏—Ç—Ä–∏–Ω—É');
                document.getElementById('adm-p-name').value = '';
                document.getElementById('adm-p-price').value = '';
                document.getElementById('adm-p-data').value = '';
            });
        }

        function deleteProduct(id) {
            if(confirm('–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä –±–µ–∑–≤–æ–∑–≤—Ä–∞—Ç–Ω–æ?')) rdb.ref('products/' + id).remove();
        }

        /* 
        ========================================
        10. –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò
        ========================================
        */
        function showGlobalLoader(text) {
            const l = document.getElementById('master-loader');
            l.style.display = 'flex';
            l.querySelector('p').innerText = text;
        }

        function hideGlobalLoader() {
            document.getElementById('master-loader').style.display = 'none';
        }

    </script>
</body>
</html>
