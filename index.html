<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Zikrov Shop</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg: var(--tg-theme-bg-color, #ffffff);
            --text: var(--tg-theme-text-color, #000000);
            --hint: var(--tg-theme-hint-color, #999999);
            --button: var(--tg-theme-button-color, #3390ec);
            --button-text: var(--tg-theme-button-text-color, #ffffff);
            --secondary: var(--tg-theme-secondary-bg-color, #f4f4f5);
        }

        body { font-family: sans-serif; background: var(--bg); color: var(--text); margin: 0; padding-bottom: 80px; overflow-x: hidden; }
        
        /* –í–∫–ª–∞–¥–∫–∏ */
        .tab-bar { display: flex; position: fixed; bottom: 0; width: 100%; background: var(--secondary); border-top: 1px solid rgba(0,0,0,0.1); z-index: 1000; }
        .tab-item { flex: 1; padding: 15px; text-align: center; font-size: 12px; font-weight: bold; color: var(--hint); cursor: pointer; }
        .tab-item.active { color: var(--button); }
        .page { display: none; padding: 15px; }
        .page.active { display: block; }

        /* –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ (–ü–∞–ø–∫–∏) */
        .category-card {
            background: var(--secondary); border-radius: 15px; padding: 20px; margin-bottom: 12px;
            display: flex; align-items: center; justify-content: space-between; cursor: pointer;
            border: 1px solid rgba(0,0,0,0.05);
        }
        .category-info { display: flex; align-items: center; gap: 15px; }
        .category-icon { font-size: 24px; }
        .category-name { font-weight: bold; font-size: 16px; }

        /* –¢–æ–≤–∞—Ä—ã */
        .back-btn { color: var(--button); font-weight: bold; margin-bottom: 15px; display: inline-block; cursor: pointer; }
        .product-card { background: var(--secondary); border-radius: 12px; padding: 15px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }

        /* –ö–Ω–æ–ø–∫–∏ */
        .btn { width: 100%; background: var(--button); color: var(--button-text); border: none; padding: 14px; border-radius: 12px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .btn:disabled { background: var(--hint); opacity: 0.6; }

        /* –ú–æ–¥–∞–ª–∫–∞ */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 2000; }
        .modal-content { position: absolute; bottom: 0; width: 100%; background: var(--bg); border-radius: 20px 20px 0 0; padding: 25px; box-sizing: border-box; }

        .requisites-box { background: var(--secondary); padding: 15px; border-radius: 10px; margin: 10px 0; border: 1px dashed var(--button); font-family: monospace; text-align: center; }
        .upload-area { border: 2px dashed var(--hint); border-radius: 10px; padding: 20px; text-align: center; margin: 15px 0; position: relative; }
        .upload-area input { position: absolute; width: 100%; height: 100%; top: 0; left: 0; opacity: 0; cursor: pointer; }
        #preview { width: 120px; margin: 10px auto; border-radius: 5px; display: none; }
    </style>
</head>
<body>

<div id="shop-page" class="page active">
    <div id="categories-screen">
        <h3 style="margin-bottom: 20px;">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤</h3>
        <div id="categories-list"></div>
    </div>

    <div id="products-screen" style="display: none;">
        <div class="back-btn" onclick="showCategories()">‚Üê –ù–∞–∑–∞–¥ –∫ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</div>
        <h3 id="current-category-name">–¢–æ–≤–∞—Ä—ã</h3>
        <div id="products-list"></div>
    </div>
</div>

<div id="profile-page" class="page">
    <div style="text-align: center; padding: 20px; background: var(--secondary); border-radius: 15px;">
        <div id="user-pic" style="width:60px; height:60px; background:var(--button); border-radius:50%; margin:0 auto 10px; display:flex; align-items:center; justify-content:center; color:white; font-size:24px; font-weight:bold;">?</div>
        <b id="user-name">User</b>
    </div>
</div>

<div id="pay-modal" class="modal">
    <div class="modal-content">
        <div id="step-1">
            <b style="font-size:18px">–°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã</b>
            <button class="btn" onclick="goToStep2('–ö–∞—Ä—Ç–∞ –°–ë–ü')">üí≥ –ö–∞—Ä—Ç–∞ / –°–ë–ü</button>
            <button class="btn" onclick="goToStep2('–ö—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞')">üíé –ö—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞</button>
            <button class="btn" style="background:var(--hint)" onclick="closeModal()">–û—Ç–º–µ–Ω–∞</button>
        </div>
        <div id="step-2" style="display:none">
            <b>–û–ø–ª–∞—Ç–∞: <span id="pay-sum">0</span> ‚ÇΩ</b>
            <div class="requisites-box" id="req-text">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
            <button class="btn" onclick="goToStep3()">‚úÖ –Ø –æ–ø–ª–∞—Ç–∏–ª(–∞)</button>
        </div>
        <div id="step-3" style="display:none">
            <b>–ó–∞–≥—Ä—É–∑–∏—Ç–µ —á–µ–∫</b>
            <div class="upload-area">
                <span id="up-text">–í—ã–±—Ä–∞—Ç—å —Ñ–æ—Ç–æ</span>
                <input type="file" accept="image/*" onchange="uploadImage(this)">
                <img id="preview" src="">
            </div>
            <button id="final-btn" class="btn" disabled onclick="redirectToChat()">üöÄ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∏ –Ω–∞–ø–∏—Å–∞—Ç—å</button>
        </div>
    </div>
</div>

<div class="tab-bar">
    <div class="tab-item active" onclick="switchTab('shop-page', this)">üõç –ú–∞–≥–∞–∑–∏–Ω</div>
    <div class="tab-item" onclick="switchTab('profile-page', this)">üë§ –ü—Ä–æ—Ñ–∏–ª—å</div>
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    // --- –ù–ê–°–¢–†–û–ô–ö–ò ---
    const IMGBB_API_KEY = "806a814f6abcc1de40b719b65d354722"; 
    const MY_USERNAME = "z1krov"; 
    const REQUISITES = {
        "–ö–∞—Ä—Ç–∞ –°–ë–ü": "2202 2081 1283 8199 (–°–±–µ—Ä)(–í–ª–∞–¥–∏–º–∏—Ä –ö.)",
        "–ö—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞": "TExxxxxxxxxxxxxxx (USDT TRC20)"
    };

    // --- –î–ê–ù–ù–´–ï –¢–û–í–ê–†–û–í –ü–û –ö–ê–¢–ï–ì–û–†–ò–Ø–ú ---
    const data = [
        {
            id: "accs",
            name: "TG –ê–∫–∫–∞—É–Ω—Ç—ã",
            icon: "üë§",
            items: [
                { name: "–ì–µ—Ä–º–∞–Ω–∏—è +49", price: 300 },
                { name: "–ö–∞–∑–∞—Ö—Å—Ç–∞–Ω +7", price: 230 },
                { name: "–ë—Ä–∞–∑–∏–ª–∏—è +55", price: 100 },
                { name: "–¢—É—Ä—Ü–∏—è +90", price: 160 },
                { name: "–í—å–µ—Ç–Ω–∞–º +84", price: 80 }
            ]
        },
        {
            id: "subs",
            name: "–ü–æ–¥–ø–∏—Å–∫–∏",
            icon: "üíé",
            items: [
                { name: "Telegram Premium 1 –º–µ—Å", price: 450 },
                { name: "Discord Nitro Full", price: 900 }
            ]
        }
    ];

    let state = { product: null, method: "", imageUrl: "" };

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —é–∑–µ—Ä–∞
    const user = tg.initDataUnsafe?.user;
    if(user) {
        document.getElementById('user-name').innerText = user.first_name;
        document.getElementById('user-pic').innerText = user.first_name.charAt(0);
    }

    // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
    function renderCategories() {
        const list = document.getElementById('categories-list');
        list.innerHTML = data.map(cat => `
            <div class="category-card" onclick="showProducts('${cat.id}')">
                <div class="category-info">
                    <span class="category-icon">${cat.icon}</span>
                    <span class="category-name">${cat.name}</span>
                </div>
                <span style="color: var(--hint)">‚Üí</span>
            </div>
        `).join('');
    }

    function showProducts(catId) {
        const category = data.find(c => c.id === catId);
        document.getElementById('current-category-name').innerText = category.name;
        const list = document.getElementById('products-list');
        
        list.innerHTML = category.items.map(p => `
            <div class="product-card">
                <div><b>${p.name}</b><br><small>${p.price} ‚ÇΩ</small></div>
                <button class="btn" style="width:auto; padding:8px 15px; margin:0;" onclick="openPay('${p.name}', ${p.price})">–ö—É–ø–∏—Ç—å</button>
            </div>
        `).join('');

        document.getElementById('categories-screen').style.display = 'none';
        document.getElementById('products-screen').style.display = 'block';
    }

    function showCategories() {
        document.getElementById('categories-screen').style.display = 'block';
        document.getElementById('products-screen').style.display = 'none';
    }

    // –õ–æ–≥–∏–∫–∞ –æ–ø–ª–∞—Ç—ã
    function openPay(name, price) {
        state.product = { name, price };
        document.getElementById('pay-modal').style.display = 'block';
        showStep(1);
    }

    function goToStep2(method) {
        state.method = method;
        document.getElementById('pay-sum').innerText = state.product.price;
        document.getElementById('req-text').innerText = REQUISITES[method];
        showStep(2);
    }

    function goToStep3() { showStep(3); }

    function showStep(step) {
        document.getElementById('step-1').style.display = step === 1 ? 'block' : 'none';
        document.getElementById('step-2').style.display = step === 2 ? 'block' : 'none';
        document.getElementById('step-3').style.display = step === 3 ? 'block' : 'none';
    }

    async function uploadImage(input) {
        if (!input.files[0]) return;
        document.getElementById('up-text').innerText = "–ó–∞–≥—Ä—É–∑–∫–∞...";
        const formData = new FormData();
        formData.append("image", input.files[0]);
        try {
            const res = await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_API_KEY}`, { method: "POST", body: formData });
            const result = await res.json();
            if(result.success) {
                state.imageUrl = result.data.url;
                document.getElementById('preview').src = state.imageUrl;
                document.getElementById('preview').style.display = "block";
                document.getElementById('up-text').innerText = "–ß–µ–∫ –∑–∞–≥—Ä—É–∂–µ–Ω ‚úÖ";
                document.getElementById('final-btn').disabled = false;
            }
        } catch (e) { tg.showAlert("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏"); }
    }

    function redirectToChat() {
        const text = `–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –ö—É–ø–∏–ª —É –≤–∞—Å —Ç–æ–≤–∞—Ä: ${state.product.name} –∑–∞ ${state.product.price}‚ÇΩ.\n–ß–µ–∫: ${state.imageUrl}`;
        tg.openTelegramLink(`https://t.me/${MY_USERNAME}?text=${encodeURIComponent(text)}`);
        tg.close();
    }

    function switchTab(id, el) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.querySelectorAll('.tab-item').forEach(t => t.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        el.classList.add('active');
        if(id === 'shop-page') showCategories();
    }

    function closeModal() { document.getElementById('pay-modal').style.display = 'none'; }

    renderCategories();
</script>
</body>
</html>

