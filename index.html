<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ultimate Mini App Shop</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap');
        body { font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; user-select: none; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .glass { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;
        const { motion, AnimatePresence } = window.Motion;
        const { 
            ShoppingBag, User, Settings, CreditCard, Coins, 
            Plus, Trash2, Palette, ChevronRight, CheckCircle2, 
            Image as ImageIcon, LayoutGrid, Zap 
        } = window.lucide;

        // --- –ù–ê–°–¢–†–û–ô–ö–ò –¢–ï–õ–ï–ì–†–ê–ú –ë–û–¢–ê ---
        const BOT_CONFIG = {
            token: '8376191518:AAGKsCRld5dFXqF0Ltr4x5KbHoUZamiUesk', // –í—Å—Ç–∞–≤—å—Ç–µ —Å—é–¥–∞ —Ç–æ–∫–µ–Ω –æ—Ç @BotFather
            adminChatId: '1577146268',    // –í—Å—Ç–∞–≤—å—Ç–µ –≤–∞—à ID (—É–∑–Ω–∞—Ç—å –≤ @userinfobot)
        };

        // --- –£–¢–ò–õ–ò–¢–´ –•–†–ê–ù–ï–ù–ò–Ø ---
        const Storage = {
            get: (key, fallback) => JSON.parse(localStorage.getItem(key)) || fallback,
            set: (key, val) => localStorage.setItem(key, JSON.stringify(val))
        };

        const App = () => {
            const [view, setView] = useState('catalog'); // catalog, profile, admin, checkout
            const [products, setProducts] = useState(() => Storage.get('shop_products', [
                { id: 1, title: 'Telegram Premium (–ì–æ–¥)', price: 2500, category: '–ü–æ–¥–ø–∏—Å–∫–∏' },
                { id: 2, title: '–ê–∫–∫–∞—É–Ω—Ç USA +1', price: 450, category: '–ê–∫–∫–∞—É–Ω—Ç—ã' }
            ]));
            const [theme, setTheme] = useState(() => Storage.get('shop_theme', {
                bg: '#0f172a', text: '#f8fafc', accent: '#3b82f6', card: '#1e293b'
            }));
            const [user, setUser] = useState(() => Storage.get('shop_user', { totalSpent: 0, orders: [] }));
            const [selectedItem, setSelectedItem] = useState(null);

            useEffect(() => { Storage.set('shop_products', products); }, [products]);
            useEffect(() => { Storage.set('shop_theme', theme); }, [theme]);
            useEffect(() => { Storage.set('shop_user', user); }, [user]);

            // –§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram
            const sendTelegramNotification = async (orderData, photoFile) => {
                const text = `üí∞ –ù–û–í–´–ô –ó–ê–ö–ê–ó!\n\nüõç –¢–æ–≤–∞—Ä: ${orderData.title}\nüíµ –°—É–º–º–∞: ${orderData.price} —Ä—É–±\nüë§ –ö–ª–∏–µ–Ω—Ç: @${window.Telegram.WebApp.initDataUnsafe?.user?.username || 'unknown'}\nüí≥ –ú–µ—Ç–æ–¥: ${orderData.method}`;
                
                const formData = new FormData();
                formData.append('chat_id', BOT_CONFIG.adminChatId);
                formData.append('caption', text);
                formData.append('photo', photoFile);

                try {
                    await fetch(`https://api.telegram.org/bot${BOT_CONFIG.token}/sendPhoto`, {
                        method: 'POST',
                        body: formData
                    });
                } catch (e) { console.error("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏:", e); }
            };

            const appStyle = { backgroundColor: theme.bg, color: theme.text, minHeight: '100vh' };

            return (
                <div style={appStyle} className="transition-all duration-500 overflow-x-hidden">
                    <AnimatePresence mode="wait">
                        {view === 'catalog' && <Catalog key="cat" products={products} theme={theme} onBuy={(p) => {setSelectedItem(p); setView('checkout');}} />}
                        {view === 'checkout' && <Checkout key="check" item={selectedItem} theme={theme} onBack={() => setView('catalog')} onFinish={sendTelegramNotification} setUser={setUser} user={user} />}
                        {view === 'profile' && <Profile key="prof" user={user} theme={theme} />}
                        {view === 'admin' && <Admin key="adm" products={products} setProducts={setProducts} theme={theme} setTheme={setTheme} />}
                    </AnimatePresence>

                    {/* –ù–∞–≤–∏–≥–∞—Ü–∏—è */}
                    <nav className="fixed bottom-6 left-1/2 -translate-x-1/2 w-[90%] glass rounded-2xl p-2 flex justify-around items-center z-50">
                        <NavBtn active={view === 'catalog'} onClick={() => setView('catalog')} icon={<ShoppingBag />} theme={theme} />
                        <NavBtn active={view === 'profile'} onClick={() => setView('profile')} icon={<User />} theme={theme} />
                        <NavBtn active={view === 'admin'} onClick={() => setView('admin')} icon={<Settings />} theme={theme} />
                    </nav>
                </div>
            );
        };

        const NavBtn = ({ active, onClick, icon, theme }) => (
            <button onClick={onClick} className={`p-3 rounded-xl transition-all ${active ? 'scale-110 shadow-lg' : 'opacity-40'}`} 
                style={{ backgroundColor: active ? theme.accent : 'transparent' }}>
                {React.cloneElement(icon, { size: 24, color: '#fff' })}
            </button>
        );

        const Catalog = ({ products, theme, onBuy }) => (
            <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0 }} className="p-6">
                <header className="mb-8">
                    <h1 className="text-3xl font-extrabold italic mb-1">STORE</h1>
                    <div className="h-1 w-12 rounded-full" style={{backgroundColor: theme.accent}}></div>
                </header>
                <div className="grid gap-4 pb-24">
                    {products.map(p => (
                        <div key={p.id} style={{backgroundColor: theme.card}} className="p-5 rounded-3xl border border-white/5 shadow-xl flex justify-between items-center group">
                            <div>
                                <span className="text-[10px] uppercase tracking-[2px] opacity-40 font-bold">{p.category}</span>
                                <h3 className="text-lg font-bold mt-1">{p.title}</h3>
                                <p className="text-xl font-mono mt-2" style={{color: theme.accent}}>{p.price} ‚ÇΩ</p>
                            </div>
                            <button onClick={() => onBuy(p)} className="p-4 rounded-2xl active:scale-90 transition-transform shadow-lg" style={{backgroundColor: theme.accent}}>
                                <Zap size={20} fill="#fff" />
                            </button>
                        </div>
                    ))}
                </div>
            </motion.div>
        );

        const Checkout = ({ item, theme, onBack, onFinish, setUser, user }) => {
            const [method, setMethod] = useState(null);
            const [screen, setScreen] = useState('select'); // select, payment, success
            const tonPrice = (item.price / 650).toFixed(2); // –ü—Ä–∏–º–µ—Ä–Ω—ã–π –∫—É—Ä—Å

            const handleFile = (e) => {
                const file = e.target.files[0];
                if (file) {
                    onFinish({ ...item, method }, file);
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ª–æ–∫–∞–ª—å–Ω–æ
                    setUser({
                        totalSpent: user.totalSpent + item.price,
                        orders: [{title: item.title, price: item.price, date: new Date().toLocaleDateString()}, ...user.orders]
                    });
                    setScreen('success');
                }
            };

            if (screen === 'success') return (
                <div className="p-6 flex flex-col items-center justify-center h-screen text-center">
                    <div className="w-20 h-20 rounded-full bg-green-500 flex items-center justify-center mb-4 shadow-lg shadow-green-500/50">
                        <CheckCircle2 size={40} color="#fff" />
                    </div>
                    <h2 className="text-2xl font-bold">–û–ø–ª–∞—á–µ–Ω–æ!</h2>
                    <p className="opacity-60 mt-2">–ß–µ–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –∞–¥–º–∏–Ω—É. –û–∂–∏–¥–∞–π—Ç–µ –≤—ã–¥–∞—á–∏ —Ç–æ–≤–∞—Ä–∞.</p>
                    <button onClick={onBack} className="mt-8 px-8 py-3 rounded-xl font-bold" style={{backgroundColor: theme.accent}}>–í –∫–∞—Ç–∞–ª–æ–≥</button>
                </div>
            );

            return (
                <motion.div initial={{ opacity: 0, x: 50 }} animate={{ opacity: 1, x: 0 }} className="p-6">
                    <button onClick={onBack} className="mb-6 opacity-50">‚Üê –ù–∞–∑–∞–¥</button>
                    <div className="glass p-6 rounded-3xl mb-6">
                        <p className="opacity-50 text-sm italic">–ö –æ–ø–ª–∞—Ç–µ:</p>
                        <h2 className="text-2xl font-bold">{item.title}</h2>
                        <p className="text-3xl font-mono font-bold mt-2" style={{color: theme.accent}}>{item.price} RUB</p>
                        <p className="text-sm opacity-40">~ {tonPrice} TON</p>
                    </div>

                    <div className="grid grid-cols-2 gap-4 mb-8">
                        <PaymentBtn active={method === 'card'} onClick={() => setMethod('card')} icon={<CreditCard />} text="–ö–∞—Ä—Ç–∞" theme={theme} />
                        <PaymentBtn active={method === 'crypto'} onClick={() => setMethod('crypto')} icon={<Coins />} text="TON" theme={theme} />
                    </div>

                    <AnimatePresence>
                        {method && (
                            <motion.div initial={{ height: 0, opacity: 0 }} animate={{ height: 'auto', opacity: 1 }} className="overflow-hidden">
                                <div className="p-6 rounded-3xl bg-black/20 border border-white/5 text-center">
                                    <p className="text-sm opacity-70 mb-4">
                                        –ü–µ—Ä–µ–≤–µ–¥–∏—Ç–µ <b>{method === 'card' ? item.price : tonPrice}</b> {method === 'card' ? 'RUB' : 'TON'} –ø–æ —Ä–µ–∫–≤–∏–∑–∏—Ç–∞–º:
                                    </p>
                                    <div className="p-3 bg-white/5 rounded-xl font-mono mb-6 select-all">
                                        {method === 'card' ? '4400 1234 5678 9000' : 'UQCx_EXAMPLE_TON_WALLET'}
                                    </div>
                                    <label className="flex flex-col items-center justify-center p-8 border-2 border-dashed border-white/20 rounded-3xl cursor-pointer hover:bg-white/5 transition-colors">
                                        <ImageIcon className="opacity-20 mb-2" size={32} />
                                        <span className="text-sm font-bold opacity-60">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç —á–µ–∫–∞</span>
                                        <input type="file" className="hidden" accept="image/*" onChange={handleFile} />
                                    </label>
                                </div>
                            </motion.div>
                        )}
                    </AnimatePresence>
                </motion.div>
            );
        };

        const PaymentBtn = ({ active, onClick, icon, text, theme }) => (
            <button onClick={onClick} className={`p-4 rounded-2xl flex flex-col items-center gap-2 border-2 transition-all ${active ? 'border-white bg-white/10' : 'border-transparent bg-white/5 opacity-50'}`}>
                {React.cloneElement(icon, { size: 24 })}
                <span className="text-xs font-bold uppercase tracking-wider">{text}</span>
            </button>
        );

        const Profile = ({ user, theme }) => (
            <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} className="p-6 pb-24">
                <div className="flex items-center gap-4 mb-8">
                    <div className="w-16 h-16 rounded-3xl bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-2xl font-black">
                        {window.Telegram.WebApp.initDataUnsafe?.user?.first_name?.[0] || 'U'}
                    </div>
                    <div>
                        <h2 className="text-xl font-bold">{window.Telegram.WebApp.initDataUnsafe?.user?.first_name || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'}</h2>
                        <p className="text-xs opacity-40 font-mono italic">ID: {window.Telegram.WebApp.initDataUnsafe?.user?.id || '000000'}</p>
                    </div>
                </div>

                <div className="grid grid-cols-2 gap-4 mb-10">
                    <div className="glass p-5 rounded-3xl text-center">
                        <p className="text-2xl font-black">{user.orders.length}</p>
                        <p className="text-[10px] uppercase opacity-40 font-bold">–ó–∞–∫–∞–∑–æ–≤</p>
                    </div>
                    <div className="glass p-5 rounded-3xl text-center">
                        <p className="text-2xl font-black">{user.totalSpent} ‚ÇΩ</p>
                        <p className="text-[10px] uppercase opacity-40 font-bold">–ü–æ—Ç—Ä–∞—á–µ–Ω–æ</p>
                    </div>
                </div>

                <h3 className="font-bold mb-4 flex items-center gap-2"><LayoutGrid size={18} /> –ò—Å—Ç–æ—Ä–∏—è</h3>
                <div className="space-y-3">
                    {user.orders.length === 0 ? <p className="opacity-20 text-center py-10 italic">–ó–∞–∫–∞–∑–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</p> : 
                        user.orders.map((o, i) => (
                            <div key={i} className="p-4 rounded-2xl bg-white/5 border border-white/5 flex justify-between">
                                <div><p className="font-bold">{o.title}</p><p className="text-[10px] opacity-40">{o.date}</p></div>
                                <p className="font-mono font-bold" style={{color: theme.accent}}>{o.price} ‚ÇΩ</p>
                            </div>
                        ))
                    }
                </div>
            </motion.div>
        );

        const Admin = ({ products, setProducts, theme, setTheme }) => {
            const [newItem, setNewItem] = useState({ title: '', price: '', category: 'Accounts' });

            return (
                <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} className="p-6 pb-24">
                    <h2 className="text-2xl font-black mb-6">ADMIN PANEL</h2>
                    
                    <div className="glass p-5 rounded-3xl mb-8">
                        <h3 className="text-sm font-bold mb-4 opacity-60 uppercase tracking-widest">–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</h3>
                        <input className="w-full bg-white/5 p-3 rounded-xl mb-2 outline-none" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" value={newItem.title} onChange={e => setNewItem({...newItem, title: e.target.value})} />
                        <input className="w-full bg-white/5 p-3 rounded-xl mb-4 outline-none font-mono" placeholder="–¶–µ–Ω–∞" type="number" value={newItem.price} onChange={e => setNewItem({...newItem, price: e.target.value})} />
                        <button onClick={() => { setProducts([...products, { ...newItem, id: Date.now(), price: Number(newItem.price) }]); setNewItem({title:'', price:'', category:'Accounts'}); }} 
                            className="w-full py-3 rounded-xl font-bold shadow-lg" style={{backgroundColor: theme.accent}}>–î–æ–±–∞–≤–∏—Ç—å</button>
                    </div>

                    <div className="glass p-5 rounded-3xl mb-8">
                        <h3 className="text-sm font-bold mb-4 opacity-60 uppercase tracking-widest">–¶–≤–µ—Ç–∞ —Ç–µ–º—ã</h3>
                        <div className="grid grid-cols-2 gap-4">
                            <div className="flex flex-col gap-1">
                                <span className="text-[10px] opacity-40 uppercase font-bold">–§–æ–Ω</span>
                                <input type="color" className="w-full h-10 rounded-lg border-none p-0" value={theme.bg} onChange={e => setTheme({...theme, bg: e.target.value})} />
                            </div>
                            <div className="flex flex-col gap-1">
                                <span className="text-[10px] opacity-40 uppercase font-bold">–ê–∫—Ü–µ–Ω—Ç</span>
                                <input type="color" className="w-full h-10 rounded-lg border-none p-0" value={theme.accent} onChange={e => setTheme({...theme, accent: e.target.value})} />
                            </div>
                        </div>
                    </div>

                    <h3 className="font-bold mb-4 opacity-60">–£–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤:</h3>
                    <div className="space-y-2">
                        {products.map(p => (
                            <div key={p.id} className="p-3 glass rounded-xl flex justify-between items-center">
                                <span className="text-sm font-bold">{p.title}</span>
                                <button onClick={() => setProducts(products.filter(i => i.id !== p.id))} className="text-red-500 p-2"><Trash2 size={16} /></button>
                            </div>
                        ))}
                    </div>
                </motion.div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
        
        // –†–µ–Ω–¥–µ—Ä –∏–∫–æ–Ω–æ–∫
        setTimeout(() => lucide.createIcons(), 500);
    </script>
</body>
</html>
