<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Digital Store Mini App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* –°—Ç–∏–ª–∏ –≤ —Å—Ç–∏–ª–µ Telegram */
        :root {
            --bg-color: var(--tg-theme-bg-color, #ffffff);
            --sec-bg-color: var(--tg-theme-secondary-bg-color, #f0f2f5);
            --text-color: var(--tg-theme-text-color, #000000);
            --hint-color: var(--tg-theme-hint-color, #999999);
            --btn-color: var(--tg-theme-button-color, #2481cc);
            --btn-text: var(--tg-theme-button-text-color, #ffffff);
            --accent: #31b545;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0; padding: 0;
            overflow-x: hidden;
        }

        .container { padding: 16px; padding-bottom: 100px; }
        .page { display: none; }
        .page.active { display: block; animation: fadeIn 0.3s ease; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        h1 { font-size: 24px; margin-bottom: 20px; }
        h2 { font-size: 20px; margin-top: 0; }

        /* –ö–∞—Ä—Ç–æ—á–∫–∏ */
        .card {
            background: var(--sec-bg-color);
            border-radius: 15px;
            padding: 16px;
            margin-bottom: 12px;
            border: 1px solid rgba(0,0,0,0.05);
        }

        /* –ö–Ω–æ–ø–∫–∏ */
        .btn {
            background: var(--btn-color);
            color: var(--btn-text);
            border: none;
            padding: 12px 20px;
            border-radius: 12px;
            font-weight: 600;
            width: 100%;
            cursor: pointer;
            font-size: 16px;
            transition: transform 0.1s;
        }
        .btn:active { transform: scale(0.98); }
        .btn-outline { background: transparent; border: 2px solid var(--btn-color); color: var(--btn-color); }
        .btn-danger { background: #e53935; }
        .btn-sm { padding: 6px 12px; font-size: 14px; width: auto; }

        /* –°–µ—Ç–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π */
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .cat-card {
            background: var(--btn-color);
            color: var(--btn-text);
            height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 15px;
            font-weight: bold;
            text-align: center;
            cursor: pointer;
            padding: 10px;
        }

        /* –§–æ—Ä–º—ã */
        input, textarea, select {
            width: 100%;
            padding: 12px;
            margin: 8px 0 16px 0;
            border-radius: 10px;
            border: 1px solid var(--hint-color);
            background: var(--bg-color);
            color: var(--text-color);
            box-sizing: border-box;
        }

        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
        .nav {
            position: fixed;
            bottom: 0; width: 100%;
            background: var(--sec-bg-color);
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            border-top: 1px solid rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }
        .nav-item {
            text-align: center;
            color: var(--hint-color);
            text-decoration: none;
            font-size: 12px;
            flex: 1;
        }
        .nav-item.active { color: var(--btn-color); }
        .nav-icon { font-size: 20px; margin-bottom: 4px; }

        /* –°—Ç–∞—Ç—É—Å—ã */
        .badge {
            font-size: 11px;
            padding: 4px 8px;
            border-radius: 6px;
            font-weight: bold;
            text-transform: uppercase;
        }
        .status-wait { background: #ffb300; color: #fff; }
        .status-paid { background: #1e88e5; color: #fff; }
        .status-done { background: #43a047; color: #fff; }

        .price { font-size: 18px; font-weight: bold; color: var(--accent); }
    </style>
</head>
<body>

<div class="container">
    <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –º–∞–≥–∞–∑–∏–Ω–∞ -->
    <div id="page-shop" class="page active">
        <h1>–ú–∞–≥–∞–∑–∏–Ω</h1>
        <div id="categories-list" class="grid"></div>
    </div>

    <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
    <div id="page-category" class="page">
        <div onclick="showPage('shop')" style="cursor:pointer; color:var(--btn-color); margin-bottom:15px;">‚Üê –ù–∞–∑–∞–¥</div>
        <h2 id="cat-title">–¢–æ–≤–∞—Ä—ã</h2>
        <div id="products-list"></div>
    </div>

    <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –æ–ø–ª–∞—Ç—ã -->
    <div id="page-pay" class="page">
        <h2>–û–ø–ª–∞—Ç–∞ –∑–∞–∫–∞–∑–∞</h2>
        <div class="card">
            <p>–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ –ø–µ—Ä–µ–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É:</p>
            <div class="price" id="pay-amount">0 ‚ÇΩ</div>
            <hr style="opacity:0.1; margin:15px 0;">
            <p><strong>–†–µ–∫–≤–∏–∑–∏—Ç—ã:</strong></p>
            <div id="payment-details" style="white-space: pre-wrap;"></div>
        </div>
        <button class="btn" onclick="confirmPayment()">–Ø –æ–ø–ª–∞—Ç–∏–ª</button>
    </div>

    <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∏—Å—Ç–æ—Ä–∏–∏ -->
    <div id="page-history" class="page">
        <h1>–ú–æ–∏ –∑–∞–∫–∞–∑—ã</h1>
        <div id="orders-list"></div>
    </div>

    <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∞–¥–º–∏–Ω–∫–∏ (–í—Ö–æ–¥) -->
    <div id="page-admin-login" class="page">
        <h2>–í—Ö–æ–¥ –≤ –ø–∞–Ω–µ–ª—å</h2>
        <input type="text" id="adm-login" placeholder="–õ–æ–≥–∏–Ω">
        <input type="password" id="adm-pass" placeholder="–ü–∞—Ä–æ–ª—å">
        <button class="btn" onclick="adminLogin()">–í–æ–π—Ç–∏</button>
    </div>

    <!-- –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
    <div id="page-admin-panel" class="page">
        <h2>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h2>
        <button class="btn btn-outline btn-sm" onclick="logout()">–í—ã–π—Ç–∏</button>
        
        <div class="card" style="margin-top:20px">
            <h3>–î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</h3>
            <input type="text" id="new-cat-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ">
            <button class="btn btn-sm" onclick="addCategory()">–î–æ–±–∞–≤–∏—Ç—å</button>
        </div>

        <div class="card">
            <h3>–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</h3>
            <select id="new-prod-cat"></select>
            <input type="text" id="new-prod-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞">
            <input type="number" id="new-prod-price" placeholder="–¶–µ–Ω–∞">
            <textarea id="new-prod-desc" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ/–°—Å—ã–ª–∫–∞ –Ω–∞ —Ç–æ–≤–∞—Ä"></textarea>
            <button class="btn btn-sm" onclick="addProduct()">–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</button>
        </div>

        <h3>–í—Å–µ –∑–∞–∫–∞–∑—ã</h3>
        <div id="admin-orders-list"></div>
    </div>
</div>

<!-- –ù–∏–∂–Ω–µ–µ –º–µ–Ω—é -->
<nav class="nav">
    <a href="#" class="nav-item active" onclick="showPage('shop', event)">
        <div class="nav-icon">üõçÔ∏è</div>
        <div>–ú–∞–≥–∞–∑–∏–Ω</div>
    </a>
    <a href="#" class="nav-item" onclick="showPage('history', event)">
        <div class="nav-icon">üì¶</div>
        <div>–ó–∞–∫–∞–∑—ã</div>
    </a>
    <a href="#" class="nav-item" onclick="showPage('admin', event)">
        <div class="nav-icon">‚öôÔ∏è</div>
        <div>–ê–¥–º–∏–Ω</div>
    </a>
</nav>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    // --- –ù–ê–°–¢–†–û–ô–ö–ò ---
    const CONFIG = {
        adminLogin: 'admin',
        adminPass: 'admin123',
        currency: '‚ÇΩ',
        paymentInfo: "üí≥ –ö–∞—Ä—Ç–∞: 4444 5555 6666 7777\nü™ô USDT (TRC20): TYourAddressHere\nüíé –ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã –ø—Ä–∏–∫—Ä–µ–ø–∏—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç –≤ —á–∞—Ç."
    };

    // --- –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –î–ê–ù–ù–´–• (LOCALSTORAGE) ---
    let db = JSON.parse(localStorage.getItem('store_db')) || {
        categories: [{id: 1, name: '–¶–∏—Ñ—Ä–æ–≤—ã–µ –∫–ª—é—á–∏'}, {id: 2, name: '–ê–∫–∫–∞—É–Ω—Ç—ã'}],
        products: [
            {id: 1, catId: 1, name: 'Windows 11 Pro', price: 450, desc: '–õ–∏—Ü–µ–Ω–∑–∏–æ–Ω–Ω—ã–π –∫–ª—é—á'},
            {id: 2, catId: 2, name: 'Telegram Premium (1 –º–µ—Å)', price: 300, desc: '–ê–∫—Ç–∏–≤–∞—Ü–∏—è –Ω–∞ –≤–∞—à –∞–∫–∫–∞—É–Ω—Ç'}
        ],
        orders: []
    };

    function saveDb() {
        localStorage.setItem('store_db', JSON.stringify(db));
    }

    // --- –†–û–£–¢–ò–ù–ì ---
    function showPage(pageId, event) {
        if(event) event.preventDefault();
        
        // –°–ø–µ—Ü-–ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª—è –∞–¥–º–∏–Ω–∫–∏
        if(pageId === 'admin') {
            const isAuth = sessionStorage.getItem('isAdmin');
            pageId = isAuth ? 'admin-panel' : 'admin-login';
        }

        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById('page-' + pageId).classList.add('active');

        document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
        if(['shop', 'category'].includes(pageId)) document.querySelectorAll('.nav-item')[0].classList.add('active');
        if(['history', 'pay'].includes(pageId)) document.querySelectorAll('.nav-item')[1].classList.add('active');
        if(['admin-login', 'admin-panel'].includes(pageId)) document.querySelectorAll('.nav-item')[2].classList.add('active');

        renderData(pageId);
    }

    // --- –†–ï–ù–î–ï–†–ò–ù–ì ---
    function renderData(pageId) {
        if(pageId === 'shop') {
            const list = document.getElementById('categories-list');
            list.innerHTML = db.categories.map(c => `
                <div class="cat-card" onclick="openCategory(${c.id})">${c.name}</div>
            `).join('');
        }

        if(pageId === 'history') {
            const list = document.getElementById('orders-list');
            const userOrders = db.orders.filter(o => o.userId === (tg.initDataUnsafe.user?.id || 'guest'));
            if(userOrders.length === 0) {
                list.innerHTML = '<p style="color:var(--hint-color)">–ó–∞–∫–∞–∑–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</p>';
                return;
            }
            list.innerHTML = userOrders.map(o => `
                <div class="card">
                    <div style="display:flex; justify-content:space-between">
                        <strong>–ó–∞–∫–∞–∑ #${o.id}</strong>
                        <span class="badge status-${getStatusClass(o.status)}">${o.status}</span>
                    </div>
                    <div style="margin-top:8px">${o.prodName}</div>
                    <div class="price">${o.price} ${CONFIG.currency}</div>
                    <div style="font-size:11px; color:var(--hint-color); margin-top:5px">${o.date}</div>
                </div>
            `).join('');
        }

        if(pageId === 'admin-panel') {
            // –°–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –≤ —Å–µ–ª–µ–∫—Ç–µ
            const select = document.getElementById('new-prod-cat');
            select.innerHTML = db.categories.map(c => `<option value="${c.id}">${c.name}</option>`).join('');

            // –°–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤ –¥–ª—è –∞–¥–º–∏–Ω–∞
            const list = document.getElementById('admin-orders-list');
            list.innerHTML = db.orders.map(o => `
                <div class="card" style="font-size:13px">
                    <b>#${o.id} | ${o.prodName}</b><br>
                    –Æ–∑–µ—Ä: ${o.userName} (${o.userId})<br>
                    –°—Ç–∞—Ç—É—Å: <b>${o.status}</b><br>
                    <div style="margin-top:10px; display:flex; gap:5px">
                        <button class="btn btn-sm" onclick="setOrderStatus(${o.id}, '–û–ø–ª–∞—á–µ–Ω')">–û–ø–ª–∞—á–µ–Ω</button>
                        <button class="btn btn-sm" style="background:#43a047" onclick="setOrderStatus(${o.id}, '–í—ã–ø–æ–ª–Ω–µ–Ω')">–í—ã–¥–∞–Ω</button>
                        <button class="btn btn-sm btn-danger" onclick="deleteOrder(${o.id})">üóëÔ∏è</button>
                    </div>
                </div>
            `).reverse().join('');
        }
    }

    function openCategory(catId) {
        const cat = db.categories.find(c => c.id === catId);
        const products = db.products.filter(p => p.catId === catId);
        document.getElementById('cat-title').innerText = cat.name;
        
        const list = document.getElementById('products-list');
        list.innerHTML = products.map(p => `
            <div class="card">
                <div style="font-size:18px; font-weight:bold">${p.name}</div>
                <div style="color:var(--hint-color); font-size:14px; margin:5px 0">${p.desc}</div>
                <div style="display:flex; justify-content:space-between; align-items:center; margin-top:10px">
                    <div class="price">${p.price} ${CONFIG.currency}</div>
                    <button class="btn btn-sm" onclick="createOrder(${p.id})">–ö—É–ø–∏—Ç—å</button>
                </div>
            </div>
        `).join('');
        showPage('category');
    }

    // --- –õ–û–ì–ò–ö–ê –ú–ê–ì–ê–ó–ò–ù–ê ---
    function createOrder(prodId) {
        const p = db.products.find(x => x.id === prodId);
        const newOrder = {
            id: Date.now(),
            userId: tg.initDataUnsafe.user?.id || 'guest',
            userName: tg.initDataUnsafe.user?.first_name || 'Guest',
            prodName: p.name,
            price: p.price,
            status: '–û–∂–∏–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—ã',
            date: new Date().toLocaleString()
        };
        db.orders.push(newOrder);
        saveDb();
        
        document.getElementById('pay-amount').innerText = p.price + ' ' + CONFIG.currency;
        document.getElementById('payment-details').innerText = CONFIG.paymentInfo;
        showPage('pay');
    }

    function confirmPayment() {
        tg.showAlert("–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É! –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—ã—á–Ω–æ –∑–∞–Ω–∏–º–∞–µ—Ç –æ—Ç 15 –º–∏–Ω—É—Ç.");
        showPage('history');
    }

    function getStatusClass(s) {
        if(s === '–û–ø–ª–∞—á–µ–Ω') return 'paid';
        if(s === '–í—ã–ø–æ–ª–Ω–µ–Ω') return 'done';
        return 'wait';
    }

    // --- –ê–î–ú–ò–ù–ö–ê ---
    function adminLogin() {
        const l = document.getElementById('adm-login').value;
        const p = document.getElementById('adm-pass').value;
        if(l === CONFIG.adminLogin && p === CONFIG.adminPass) {
            sessionStorage.setItem('isAdmin', 'true');
            showPage('admin-panel');
        } else {
            alert('–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å');
        }
    }

    function logout() {
        sessionStorage.removeItem('isAdmin');
        showPage('shop');
    }

    function addCategory() {
        const name = document.getElementById('new-cat-name').value;
        if(!name) return;
        db.categories.push({id: Date.now(), name: name});
        saveDb();
        renderData('admin-panel');
        document.getElementById('new-cat-name').value = '';
    }

    function addProduct() {
        const catId = parseInt(document.getElementById('new-prod-cat').value);
        const name = document.getElementById('new-prod-name').value;
        const price = document.getElementById('new-prod-price').value;
        const desc = document.getElementById('new-prod-desc').value;

        if(!name || !price) return;
        db.products.push({id: Date.now(), catId, name, price, desc});
        saveDb();
        renderData('admin-panel');
        alert('–¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω!');
    }

    function setOrderStatus(id, status) {
        const order = db.orders.find(o => o.id === id);
        if(order) order.status = status;
        saveDb();
        renderData('admin-panel');
    }

    function deleteOrder(id) {
        db.orders = db.orders.filter(o => o.id !== id);
        saveDb();
        renderData('admin-panel');
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    renderData('shop');
</script>

</body>
</html>


