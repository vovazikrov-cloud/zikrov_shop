<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Zikrov Shop - Full Inventory</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style id="dynamic-theme">
        :root {
            --bg-color: var(--tg-theme-bg-color, #ffffff);
            --text-color: var(--tg-theme-text-color, #000000);
            --hint-color: var(--tg-theme-hint-color, #999999);
            --button-color: var(--tg-theme-button-color, #007aff);
            --button-text-color: var(--tg-theme-button-text-color, #ffffff);
            --secondary-bg: var(--tg-theme-secondary-bg-color, #f4f4f5);
            --card-border-radius: 16px;
            --card-border-width: 0px;
            --card-border-color: rgba(0,0,0,0.1);
        }
    </style>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0; padding-bottom: 100px;
            transition: background 0.3s ease;
        }

        .container { padding: 20px; }
        .header-title { font-size: 26px; font-weight: 800; margin-bottom: 20px; letter-spacing: -0.5px; }

        .card {
            background-color: var(--secondary-bg);
            border-radius: var(--card-border-radius);
            border: var(--card-border-width) solid var(--card-border-color);
            padding: 16px; margin-bottom: 10px;
            display: flex; align-items: center; justify-content: space-between;
        }

        .btn-main {
            background-color: var(--button-color); color: var(--button-text-color);
            border: none; padding: 16px; border-radius: var(--card-border-radius);
            font-size: 16px; font-weight: 700; width: 100%; cursor: pointer;
        }

        .btn-cancel {
            background: none; border: none; color: var(--hint-color);
            padding: 12px; font-size: 15px; width: 100%; cursor: pointer;
        }

        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
        .nav-bar {
            position: fixed; bottom: 0; left: 0; right: 0; height: 75px;
            background: var(--secondary-bg); display: flex;
            border-top: 1px solid rgba(0,0,0,0.05); backdrop-filter: blur(15px); z-index: 1000;
        }
        .nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .nav-item svg { width: 22px; height: 22px; fill: var(--hint-color); }
        .nav-item.active svg { fill: var(--button-color); }
        .nav-item span { font-size: 10px; margin-top: 4px; color: var(--hint-color); }
        .nav-item.active span { color: var(--button-color); font-weight: 600; }

        /* –ú–æ–¥–∞–ª–∫–∏ */
        .modal-box {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.85); display: none;
            align-items: center; justify-content: center; z-index: 5000;
            backdrop-filter: blur(8px); padding: 20px;
        }
        .modal-box.active { display: flex; }
        .modal-content {
            background: var(--bg-color); width: 100%; max-width: 400px;
            border-radius: 24px; padding: 24px; box-sizing: border-box;
        }

        /* –ù–∞—Å—Ç—Ä–æ–π–∫–∏ */
        .setting-group { margin-bottom: 15px; }
        .setting-label { font-size: 12px; color: var(--hint-color); display: block; margin-bottom: 8px; }
        .color-row { display: flex; gap: 10px; align-items: center; background: var(--secondary-bg); padding: 8px; border-radius: 12px; }
        
        .history-scroll { max-height: 350px; overflow-y: auto; }
        .history-card { background: var(--secondary-bg); padding: 12px; border-radius: 12px; margin-bottom: 8px; font-size: 14px; }
    </style>
</head>
<body>

<div id="page-shop" class="container">
    <div id="view-categories">
        <h1 class="header-title">Zikrov Shop</h1>
        <div id="list-categories"></div>
    </div>
    <div id="view-products" style="display: none;">
        <div class="btn-cancel" style="text-align: left; padding: 0; margin-bottom: 10px;" onclick="renderCategories()">‚Üê –ù–∞–∑–∞–¥</div>
        <h1 id="cat-title" class="header-title">–¢–æ–≤–∞—Ä—ã</h1>
        <div id="list-products"></div>
    </div>
</div>

<div id="page-profile" class="container" style="display: none;">
    <h1 class="header-title">–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</h1>
    <div class="card" style="flex-direction: column; text-align: center; padding: 25px;">
        <div id="user-icon" style="width: 70px; height: 70px; border-radius: 50%; background: var(--button-color); color: #fff; font-size: 28px; display: flex; align-items: center; justify-content: center; margin-bottom: 10px;">?</div>
        <b id="user-name">–ó–∞–≥—Ä—É–∑–∫–∞...</b>
    </div>

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px;">
        <div class="card" style="flex-direction: column;">
            <span id="stat-count" style="font-size: 20px; font-weight: 800; color: var(--button-color);">0</span>
            <small>–ü–æ–∫—É–ø–æ–∫</small>
        </div>
        <div class="card" style="flex-direction: column;">
            <span id="stat-sum" style="font-size: 20px; font-weight: 800; color: var(--button-color);">0 ‚ÇΩ</span>
            <small>–¢—Ä–∞—Ç—ã</small>
        </div>
    </div>

    <button class="btn-main" style="margin-top: 15px;" onclick="openModal('modal-history')">üìã –ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤</button>
    <button class="btn-cancel" onclick="openModal('modal-settings')">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –¥–∏–∑–∞–π–Ω</button>
</div>

<div id="modal-pay" class="modal-box">
    <div class="modal-content">
        <div id="pay-s1">
            <h2 style="margin-top: 0;">–û–ø–ª–∞—Ç–∞</h2>
            <button class="btn-main" onclick="nextStep(2)">–°–±–µ—Ä–±–∞–Ω–∫ / –°–ë–ü</button>
            <button class="btn-cancel" onclick="closeModals()">–û—Ç–º–µ–Ω–∞</button>
        </div>
        <div id="pay-s2" style="display: none;">
            <h2 style="margin-top: 0;">–†–µ–∫–≤–∏–∑–∏—Ç—ã</h2>
            <div style="background: var(--secondary-bg); padding: 15px; border-radius: 15px; margin-bottom: 15px;">
                <small>–ö –û–ü–õ–ê–¢–ï</small>
                <div style="font-size: 20px; font-weight: 800; margin-bottom: 10px;"><span id="sum-val">0</span> ‚ÇΩ</div>
                <small>–ö–ê–†–¢–ê</small>
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <b id="card-val">2202 2081 1283 8199</b>
                    <button onclick="copy('card-val')" style="background: var(--button-color); color: #fff; border: none; padding: 5px; border-radius: 5px; font-size: 10px;">COPY</button>
                </div>
                <small>–ü–û–õ–£–ß–ê–¢–ï–õ–¨: –í–õ–ê–î–ò–ú–ò–† –ö.</small>
            </div>
            <button class="btn-main" onclick="nextStep(3)">–Ø –æ–ø–ª–∞—Ç–∏–ª(–∞)</button>
            <button class="btn-cancel" onclick="nextStep(1)">–ù–∞–∑–∞–¥</button>
        </div>
        <div id="pay-s3" style="display: none;">
            <h2 style="margin-top: 0;">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</h2>
            <div style="border: 2px dashed var(--button-color); padding: 20px; text-align: center; border-radius: 15px;" onclick="document.getElementById('file-in').click()">
                <span id="file-label">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç —á–µ–∫–∞</span>
                <input type="file" id="file-in" style="display: none;" onchange="handleFile(this)">
                <img id="file-prev" style="width: 100%; display: none; margin-top: 10px; border-radius: 10px;">
            </div>
            <button id="btn-done" class="btn-main" style="margin-top: 15px;" disabled onclick="sendOrder()">–ó–∞–≤–µ—Ä—à–∏—Ç—å</button>
        </div>
    </div>
</div>

<div id="modal-history" class="modal-box">
    <div class="modal-content">
        <h2 style="margin-top: 0;">–ò—Å—Ç–æ—Ä–∏—è</h2>
        <div id="history-list" class="history-scroll"></div>
        <button class="btn-main" style="margin-top: 15px;" onclick="closeModals()">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
</div>

<div id="modal-settings" class="modal-box">
    <div class="modal-content">
        <h2 style="margin-top: 0;">–î–∏–∑–∞–π–Ω</h2>
        <div class="setting-group">
            <span class="setting-label">–¶–≤–µ—Ç –∫–Ω–æ–ø–æ–∫</span>
            <div class="color-row"><input type="color" id="cfg-btn" oninput="applyStyle()"></div>
        </div>
        <div class="setting-group">
            <span class="setting-label">–¶–≤–µ—Ç —Ñ–æ–Ω–∞</span>
            <div class="color-row"><input type="color" id="cfg-bg" oninput="applyStyle()"></div>
        </div>
        <div class="setting-group">
            <span class="setting-label">–°–∫—Ä—É–≥–ª–µ–Ω–∏–µ (px)</span>
            <input type="range" id="cfg-rad" min="0" max="30" oninput="applyStyle()">
        </div>
        <button class="btn-main" onclick="closeModals()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </div>
</div>

<div class="nav-bar">
    <div class="nav-item active" id="tab-shop" onclick="tab('shop')">
        <svg viewBox="0 0 24 24"><path d="M12 3L4 9v12h16V9l-8-6zm6 16H6v-9l6-4.5 6 4.5v9z"/></svg>
        <span>–ú–∞–≥–∞–∑–∏–Ω</span>
    </div>
    <div class="nav-item" id="tab-profile" onclick="tab('profile')">
        <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3z"/></svg>
        <span>–ü—Ä–æ—Ñ–∏–ª—å</span>
    </div>
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    const IMGBB_KEY = "806a814f6abcc1de40b719b65d354722";
    const ADMIN_USER = "Z1KROV";

    const shopData = [
        {
            id: 'accs_standard',
            name: 'TG –ê–∫–∫–∞—É–Ω—Ç—ã',
            icon: 'üë§',
            items: [
                { name: '–ì–µ—Ä–º–∞–Ω–∏—è +49', price: 300 },
                { name: '–ö–∞–∑–∞—Ö—Å—Ç–∞–Ω +7', price: 230 },
                { name: '–ë—Ä–∞–∑–∏–ª–∏—è +55', price: 100 },
                { name: '–¢—É—Ä—Ü–∏—è +90', price: 160 },
                { name: '–í—å–µ—Ç–Ω–∞–º +84', price: 80 },
                { name: '–ö–æ–ª—É–º–±–∏—è +57', price: 140 },
                { name: '–ú–µ–∫—Å–∏–∫–∞ +52', price: 140 },
                { name: '–¢–∞–π–ª–∞–Ω–¥ +66', price: 190 },
                { name: '–ö–∞–Ω–∞–¥–∞ +1', price: 70 },
                { name: '–ë–∞–Ω–≥–ª–∞–¥–µ—à +880', price: 90 },
                { name: '–£–∫—Ä–∞–∏–Ω–∞ +380', price: 230 },
                { name: '–ò–Ω–¥–∏—è +91', price: 60 },
                { name: '–°–®–ê +1', price: 60 }
            ]
        },
        {
            id: 'accs_aged',
            name: 'TG –ê–∫–∫–∞—É–Ω—Ç—ã (–û—Ç–ª–µ–≥–∞)',
            icon: '‚è≥',
            items: [
                { name: '–ì–µ—Ä–º–∞–Ω–∏—è 30+ –¥–Ω–µ–π', price: 340 },
                { name: '–ì–µ—Ä–º–∞–Ω–∏—è 7+ –¥–Ω–µ–π', price: 320 },
                { name: '–ö–∞–∑–∞—Ö—Å—Ç–∞–Ω 30+ –¥–Ω–µ–π', price: 270 },
                { name: '–ö–∞–∑–∞—Ö—Å—Ç–∞–Ω 7+ –¥–Ω–µ–π', price: 250 },
                { name: '–£–∫—Ä–∞–∏–Ω–∞ 30+ –¥–Ω–µ–π', price: 280 },
                { name: '–£–∫—Ä–∞–∏–Ω–∞ 7+ –¥–Ω–µ–π', price: 260 },
                { name: '–¢–∞–π–ª–∞–Ω–¥ 30+ –¥–Ω–µ–π', price: 260 },
                { name: '–¢–∞–π–ª–∞–Ω–¥ 7+ –¥–Ω–µ–π', price: 230 },
                { name: '–¢—É—Ä—Ü–∏—è 30+ –¥–Ω–µ–π', price: 200 },
                { name: '–¢—É—Ä—Ü–∏—è 7+ –¥–Ω–µ–π', price: 180 },
                { name: '–ú–µ–∫—Å–∏–∫–∞ 30+ –¥–Ω–µ–π', price: 180 },
                { name: '–ú–µ–∫—Å–∏–∫–∞ 7+ –¥–Ω–µ–π', price: 160 },
                { name: '–ö–æ–ª—É–º–±–∏—è 30+ –¥–Ω–µ–π', price: 180 },
                { name: '–ö–æ–ª—É–º–±–∏—è 7+ –¥–Ω–µ–π', price: 160 },
                { name: '–ë—Ä–∞–∑–∏–ª–∏—è 30+ –¥–Ω–µ–π', price: 140 },
                { name: '–ë—Ä–∞–∑–∏–ª–∏—è 7+ –¥–Ω–µ–π', price: 120 },
                { name: '–ë–∞–Ω–≥–ª–∞–¥–µ—à 30+ –¥–Ω–µ–π', price: 130 },
                { name: '–ë–∞–Ω–≥–ª–∞–¥–µ—à 7+ –¥–Ω–µ–π', price: 110 },
                { name: '–í—å–µ—Ç–Ω–∞–º 30+ –¥–Ω–µ–π', price: 120 },
                { name: '–í—å–µ—Ç–Ω–∞–º 7+ –¥–Ω–µ–π', price: 100 },
                { name: '–ò–Ω–¥–∏—è 30+ –¥–Ω–µ–π', price: 100 },
                { name: '–ò–Ω–¥–∏—è 7+ –¥–Ω–µ–π', price: 80 },
                { name: '–°–®–ê 30+ –¥–Ω–µ–π', price: 100 },
                { name: '–°–®–ê 7+ –¥–Ω–µ–π', price: 80 }
            ]
        },
        {
            id: 'subs',
            name: '–ü–æ–¥–ø–∏—Å–∫–∏',
            icon: 'üíé',
            items: [
                { name: 'Premium 1 –º–µ—Å', price: 450 },
                { name: 'Premium 12 –º–µ—Å', price: 3400 }
            ]
        }
    ];

    let order = null;

    function copy(id) {
        navigator.clipboard.writeText(document.getElementById(id).innerText);
        tg.showAlert("–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!");
    }

    function tab(p) {
        document.getElementById('page-shop').style.display = p === 'shop' ? 'block' : 'none';
        document.getElementById('page-profile').style.display = p === 'profile' ? 'block' : 'none';
        document.getElementById('tab-shop').classList.toggle('active', p === 'shop');
        document.getElementById('tab-profile').classList.toggle('active', p === 'profile');
        if(p === 'profile') loadStats();
    }

    function renderCategories() {
        document.getElementById('view-categories').style.display = 'block';
        document.getElementById('view-products').style.display = 'none';
        document.getElementById('list-categories').innerHTML = shopData.map(c => `
            <div class="card" onclick="renderProducts('${c.id}')">
                <span>${c.icon} ${c.name}</span>
                <span>‚Üí</span>
            </div>
        `).join('');
    }

    function renderProducts(id) {
        const cat = shopData.find(x => x.id === id);
        document.getElementById('cat-title').innerText = cat.name;
        document.getElementById('list-products').innerHTML = cat.items.map(i => `
            <div class="card">
                <div><b>${i.name}</b><br><small>${i.price} ‚ÇΩ</small></div>
                <button class="btn-main" style="width: auto; padding: 10px;" onclick="pay('${i.name}', ${i.price})">–ö—É–ø–∏—Ç—å</button>
            </div>
        `).join('');
        document.getElementById('view-categories').style.display = 'none';
        document.getElementById('view-products').style.display = 'block';
    }

    function pay(n, p) {
        order = { id: Math.floor(10000000 + Math.random() * 90000000), name: n, price: p };
        document.getElementById('sum-val').innerText = p;
        openModal('modal-pay');
        nextStep(1);
    }

    function nextStep(s) {
        [1,2,3].forEach(n => document.getElementById('pay-s'+n).style.display = s === n ? 'block' : 'none');
    }

    async function handleFile(input) {
        if(!input.files[0]) return;
        document.getElementById('file-label').innerText = "–ó–∞–≥—Ä—É–∑–∫–∞...";
        const form = new FormData();
        form.append("image", input.files[0]);
        const res = await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_KEY}`, { method: 'POST', body: form });
        const json = await res.json();
        if(json.success) {
            order.img = json.data.url;
            document.getElementById('file-prev').src = order.img;
            document.getElementById('file-prev').style.display = 'block';
            document.getElementById('file-label').style.display = 'none';
            document.getElementById('btn-done').disabled = false;
        }
    }

    function sendOrder() {
        const history = JSON.parse(localStorage.getItem('h_zik') || '[]');
        history.unshift({ ...order, date: new Date().toLocaleString() });
        localStorage.setItem('h_zik', JSON.stringify(history));

        const msg = `üì¶ –ó–ê–ö–ê–ó #${order.id}\n–¢–æ–≤–∞—Ä: ${order.name}\n–°—É–º–º–∞: ${order.price}‚ÇΩ\n–ß–µ–∫: ${order.img}`;
        tg.openTelegramLink(`https://t.me/${ADMIN_USER}?text=${encodeURIComponent(msg)}`);
        tg.close();
    }

    function loadStats() {
        const history = JSON.parse(localStorage.getItem('h_zik') || '[]');
        document.getElementById('stat-count').innerText = history.length;
        document.getElementById('stat-sum').innerText = history.reduce((a,b) => a + b.price, 0) + " ‚ÇΩ";
        document.getElementById('history-list').innerHTML = history.map(h => `
            <div class="history-card">
                <b>#${h.id}</b> | ${h.name}<br>
                <small>${h.date} ‚Äî ${h.price} ‚ÇΩ</small>
            </div>
        `).join('') || "–ó–∞–∫–∞–∑–æ–≤ –Ω–µ—Ç";
    }

    function applyStyle() {
        const btn = document.getElementById('cfg-btn').value;
        const bg = document.getElementById('cfg-bg').value;
        const rad = document.getElementById('cfg-rad').value;
        document.documentElement.style.setProperty('--button-color', btn);
        document.documentElement.style.setProperty('--bg-color', bg);
        document.documentElement.style.setProperty('--card-border-radius', rad + 'px');
        localStorage.setItem('cfg_zik', JSON.stringify({ btn, bg, rad }));
    }

    function openModal(id) { document.getElementById(id).style.display = 'flex'; }
    function closeModals() { document.querySelectorAll('.modal-box').forEach(m => m.style.display = 'none'); }

    // Init
    const u = tg.initDataUnsafe.user;
    if(u) { document.getElementById('user-name').innerText = u.first_name; document.getElementById('user-icon').innerText = u.first_name.charAt(0); }
    
    const savedCfg = JSON.parse(localStorage.getItem('cfg_zik'));
    if(savedCfg) {
        document.getElementById('cfg-btn').value = savedCfg.btn;
        document.getElementById('cfg-bg').value = savedCfg.bg;
        document.getElementById('cfg-rad').value = savedCfg.rad;
        applyStyle();
    }

    renderCategories();
</script>
</body>
</html>

