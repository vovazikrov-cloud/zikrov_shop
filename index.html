<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Zikrov Shop Luxury</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style id="dynamic-theme">
        :root {
            --bg-color: var(--tg-theme-bg-color, #ffffff);
            --text-color: var(--tg-theme-text-color, #000000);
            --hint-color: var(--tg-theme-hint-color, #999999);
            --button-color: var(--tg-theme-button-color, #007aff);
            --button-text-color: var(--tg-theme-button-text-color, #ffffff);
            --secondary-bg: var(--tg-theme-secondary-bg-color, #f4f4f5);
            --card-border-radius: 16px;
            --card-border-width: 0px;
            --card-border-color: rgba(0,0,0,0.1);
        }
    </style>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            transition: background 0.3s ease;
            padding-bottom: 100px;
        }

        /* --- UI –≠–õ–ï–ú–ï–ù–¢–´ --- */
        .container { padding: 20px; }
        
        .header-title { font-size: 28px; font-weight: 800; margin-bottom: 20px; letter-spacing: -0.5px; }

        .card {
            background-color: var(--secondary-bg);
            border-radius: var(--card-border-radius);
            border: var(--card-border-width) solid var(--card-border-color);
            padding: 16px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: transform 0.1s ease;
        }
        .card:active { transform: scale(0.98); }

        .btn-main {
            background-color: var(--button-color);
            color: var(--button-text-color);
            border: none;
            padding: 16px 20px;
            border-radius: var(--card-border-radius);
            font-size: 16px;
            font-weight: 700;
            width: 100%;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .btn-cancel {
            background: none;
            border: none;
            color: var(--hint-color);
            padding: 12px;
            font-size: 15px;
            font-weight: 500;
            width: 100%;
            cursor: pointer;
            margin-top: 8px;
            text-decoration: none;
        }
        .btn-cancel:active { opacity: 0.6; }

        /* --- –¢–ê–ë –ë–ê–† --- */
        .nav-bar {
            position: fixed; bottom: 0; left: 0; right: 0;
            height: 75px; background: var(--secondary-bg);
            display: flex; border-top: 1px solid rgba(0,0,0,0.05);
            backdrop-filter: blur(15px); z-index: 1000;
        }
        .nav-item {
            flex: 1; display: flex; flex-direction: column;
            align-items: center; justify-content: center;
        }
        .nav-item svg { width: 24px; height: 24px; fill: var(--hint-color); }
        .nav-item.active svg { fill: var(--button-color); }
        .nav-item span { font-size: 10px; margin-top: 4px; color: var(--hint-color); }
        .nav-item.active span { color: var(--button-color); font-weight: 600; }

        /* --- –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê --- */
        .modal-box {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.85); display: none;
            align-items: center; justify-content: center; z-index: 5000;
            backdrop-filter: blur(8px); padding: 20px;
        }
        .modal-box.active { display: flex; animation: modalIn 0.3s ease; }
        .modal-content {
            background: var(--bg-color); width: 100%; max-width: 400px;
            border-radius: 28px; padding: 24px; box-sizing: border-box;
            position: relative;
        }
        @keyframes modalIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }

        /* --- –ù–ê–°–¢–†–û–ô–ö–ò –î–ò–ó–ê–ô–ù–ê --- */
        .setting-group { margin-bottom: 20px; }
        .setting-label { font-size: 13px; color: var(--hint-color); margin-bottom: 10px; display: block; text-transform: uppercase; }
        .color-picker-wrapper { display: flex; gap: 10px; align-items: center; background: var(--secondary-bg); padding: 10px; border-radius: 12px; }
        input[type="color"] { border: none; width: 40px; height: 40px; border-radius: 8px; background: none; }
        input[type="range"] { width: 100%; accent-color: var(--button-color); }

        /* --- –ò–°–¢–û–†–ò–Ø --- */
        .history-item { padding: 12px; border-bottom: 1px solid var(--secondary-bg); }
        .history-item:last-child { border: none; }
    </style>
</head>
<body>

<div id="page-shop" class="container">
    <div id="view-categories">
        <h1 class="header-title">Zikrov Shop</h1>
        <div id="list-categories"></div>
    </div>
    <div id="view-products" style="display: none;">
        <div class="btn-cancel" style="text-align: left; padding: 0; width: auto;" onclick="renderCategories()">‚Üê –ö –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</div>
        <h1 id="cat-title" class="header-title">–¢–æ–≤–∞—Ä—ã</h1>
        <div id="list-products"></div>
    </div>
</div>

<div id="page-profile" class="container" style="display: none;">
    <h1 class="header-title">–ü—Ä–æ—Ñ–∏–ª—å</h1>
    <div class="card" style="justify-content: center; flex-direction: column; padding: 30px;">
        <div id="user-icon" style="width: 80px; height: 80px; border-radius: 50%; background: var(--button-color); color: #fff; font-size: 32px; display: flex; align-items: center; justify-content: center; margin-bottom: 15px;">?</div>
        <b id="user-name" style="font-size: 20px;">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</b>
    </div>

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px;">
        <div class="card" style="flex-direction: column; align-items: center;">
            <span id="stat-deals" style="font-size: 24px; font-weight: 800; color: var(--button-color);">0</span>
            <span style="font-size: 12px; color: var(--hint-color);">–°–¥–µ–ª–æ–∫</span>
        </div>
        <div class="card" style="flex-direction: column; align-items: center;">
            <span id="stat-spent" style="font-size: 24px; font-weight: 800; color: var(--button-color);">0 ‚ÇΩ</span>
            <span style="font-size: 12px; color: var(--hint-color);">–ü–æ—Ç—Ä–∞—á–µ–Ω–æ</span>
        </div>
    </div>

    <button class="btn-main" onclick="openModal('modal-history')">üïí –ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤</button>
    <button class="btn-cancel" onclick="openModal('modal-settings')">üé® –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –≤–Ω–µ—à–Ω–∏–π –≤–∏–¥</button>
</div>

<div id="modal-pay" class="modal-box">
    <div class="modal-content">
        <div id="pay-s1">
            <h2 style="margin-top: 0;">–û–ø–ª–∞—Ç–∞</h2>
            <button class="btn-main" onclick="nextPayStep(2)">–°–±–µ—Ä–±–∞–Ω–∫ / –°–ë–ü</button>
            <button class="btn-cancel" onclick="closeAllModals()">–û—Ç–º–µ–Ω–∞</button>
        </div>
        <div id="pay-s2" style="display: none;">
            <h2 style="margin-top: 0;">–†–µ–∫–≤–∏–∑–∏—Ç—ã</h2>
            <div style="background: var(--secondary-bg); padding: 15px; border-radius: 15px; margin-bottom: 15px;">
                <small style="color: var(--hint-color);">–°–£–ú–ú–ê</small>
                <div style="font-size: 22px; font-weight: 800; margin-bottom: 15px;"><span id="pay-sum-val">0</span> ‚ÇΩ</div>
                
                <small style="color: var(--hint-color);">–ö–ê–†–¢–ê</small>
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <b id="val-card">2202 2081 1283 8199</b>
                    <button onclick="copy('val-card')" style="background: var(--button-color); color: #fff; border: none; border-radius: 8px; padding: 4px 8px; font-size: 10px;">–ö–û–ü–ò–Ø</button>
                </div>
                <div style="margin-top: 10px;">
                    <small style="color: var(--hint-color);">–ü–û–õ–£–ß–ê–¢–ï–õ–¨</small>
                    <div>–í–õ–ê–î–ò–ú–ò–† –ö.</div>
                </div>
            </div>
            <button class="btn-main" onclick="nextPayStep(3)">–Ø –æ–ø–ª–∞—Ç–∏–ª(–∞)</button>
            <button class="btn-cancel" onclick="nextPayStep(1)">–ù–∞–∑–∞–¥</button>
        </div>
        <div id="pay-s3" style="display: none;">
            <h2 style="margin-top: 0;">–ß–µ–∫</h2>
            <div id="upload-zone" style="border: 2px dashed var(--button-color); padding: 30px; text-align: center; border-radius: 20px; cursor: pointer;" onclick="document.getElementById('file-input').click()">
                <span id="up-label">–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –≤—ã–±—Ä–∞—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç</span>
                <input type="file" id="file-input" style="display: none;" accept="image/*" onchange="processFile(this)">
                <img id="up-preview" style="width: 100%; display: none; margin-top: 15px; border-radius: 12px;">
            </div>
            <button id="btn-finish" class="btn-main" style="margin-top: 20px;" disabled onclick="finalizeOrder()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
            <button class="btn-cancel" onclick="nextPayStep(2)">–ù–∞–∑–∞–¥</button>
        </div>
    </div>
</div>

<div id="modal-settings" class="modal-box">
    <div class="modal-content">
        <h2 style="margin-top: 0;">–î–∏–∑–∞–π–Ω</h2>
        
        <div class="setting-group">
            <span class="setting-label">–¶–≤–µ—Ç –∫–Ω–æ–ø–æ–∫ –∏ –∞–∫—Ü–µ–Ω—Ç–æ–≤</span>
            <div class="color-picker-wrapper">
                <input type="color" id="cfg-color-btn" oninput="applyDesign()">
                <span id="cfg-hex-btn">#007aff</span>
            </div>
        </div>

        <div class="setting-group">
            <span class="setting-label">–¶–≤–µ—Ç —Ñ–æ–Ω–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</span>
            <div class="color-picker-wrapper">
                <input type="color" id="cfg-color-bg" oninput="applyDesign()">
                <span id="cfg-hex-bg">#ffffff</span>
            </div>
        </div>

        <div class="setting-group">
            <span class="setting-label">–°–∫—Ä—É–≥–ª–µ–Ω–∏–µ —É–≥–ª–æ–≤</span>
            <input type="range" id="cfg-radius" min="0" max="30" value="16" oninput="applyDesign()">
        </div>

        <div class="setting-group">
            <span class="setting-label">–û–±–≤–æ–¥–∫–∞ –∫–∞—Ä—Ç–æ—á–µ–∫</span>
            <input type="range" id="cfg-border" min="0" max="4" value="0" oninput="applyDesign()">
        </div>

        <button class="btn-main" onclick="closeAllModals()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
    </div>
</div>

<div id="modal-history" class="modal-box">
    <div class="modal-content" style="max-height: 80vh; overflow-y: auto;">
        <h2 style="margin-top: 0;">–ú–æ–∏ –∑–∞–∫–∞–∑—ã</h2>
        <div id="history-container"></div>
        <button class="btn-main" style="margin-top: 20px;" onclick="closeAllModals()">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
</div>

<div class="nav-bar">
    <div class="nav-item active" id="tab-shop" onclick="nav('shop')">
        <svg viewBox="0 0 24 24"><path d="M12 3L4 9v12h16V9l-8-6zm6 16H6v-9l6-4.5 6 4.5v9z"/></svg>
        <span>–ú–∞–≥–∞–∑–∏–Ω</span>
    </div>
    <div class="nav-item" id="tab-profile" onclick="nav('profile')">
        <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/></svg>
        <span>–ü—Ä–æ—Ñ–∏–ª—å</span>
    </div>
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    const IMGBB_KEY = "806a814f6abcc1de40b719b65d354722";
    const ADMIN = "Z1KROV";

    const shopData = [
        { id: 'accs', name: 'TG –ê–∫–∫–∞—É–Ω—Ç—ã', icon: 'üë§', items: [
            { name: '–ì–µ—Ä–º–∞–Ω–∏—è +49', price: 300 }, { name: '–°–®–ê +1', price: 60 }, { name: '–ö–∞–∑–∞—Ö—Å—Ç–∞–Ω +7', price: 230 }
        ]},
        { id: 'premium', name: 'Telegram Premium', icon: 'üíé', items: [
            { name: 'Premium 1 –º–µ—Å—è—Ü', price: 450 }, { name: 'Premium 12 –º–µ—Å—è—Ü–µ–≤', price: 3400 }
        ]}
    ];

    let currentOrder = null;

    // --- –°–ï–†–í–ò–°–ù–´–ï –§–£–ù–ö–¶–ò–ò ---
    function genID() { return Math.floor(10000000 + Math.random() * 90000000); }

    function copy(id) {
        navigator.clipboard.writeText(document.getElementById(id).innerText);
        tg.HapticFeedback.notificationOccurred('success');
        tg.showAlert("–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!");
    }

    // --- –ù–ê–í–ò–ì–ê–¶–ò–Ø ---
    function nav(p) {
        document.getElementById('page-shop').style.display = p === 'shop' ? 'block' : 'none';
        document.getElementById('page-profile').style.display = p === 'profile' ? 'block' : 'none';
        document.getElementById('tab-shop').classList.toggle('active', p === 'shop');
        document.getElementById('tab-profile').classList.toggle('active', p === 'profile');
        if(p === 'profile') refreshStats();
    }

    // --- –ú–ê–ì–ê–ó–ò–ù ---
    function renderCategories() {
        document.getElementById('view-categories').style.display = 'block';
        document.getElementById('view-products').style.display = 'none';
        const list = document.getElementById('list-categories');
        list.innerHTML = shopData.map(c => `
            <div class="card" onclick="renderProducts('${c.id}')">
                <span>${c.icon} ${c.name}</span>
                <span>‚Üí</span>
            </div>
        `).join('');
    }

    function renderProducts(cid) {
        const cat = shopData.find(c => c.id === cid);
        document.getElementById('cat-title').innerText = cat.name;
        const list = document.getElementById('list-products');
        list.innerHTML = cat.items.map(i => `
            <div class="card">
                <div><b>${i.name}</b><br><small>${i.price} ‚ÇΩ</small></div>
                <button class="btn-main" style="width: auto; padding: 10px 15px;" onclick="initPay('${i.name}', ${i.price})">–ö—É–ø–∏—Ç—å</button>
            </div>
        `).join('');
        document.getElementById('view-categories').style.display = 'none';
        document.getElementById('view-products').style.display = 'block';
    }

    // --- –û–ü–õ–ê–¢–ê ---
    function initPay(n, p) {
        currentOrder = { id: genID(), name: n, price: p, step: 1 };
        document.getElementById('pay-sum-val').innerText = p;
        openModal('modal-pay');
        nextPayStep(1);
    }

    function nextPayStep(s) {
        [1,2,3].forEach(n => document.getElementById('pay-s'+n).style.display = s === n ? 'block' : 'none');
    }

    async function processFile(input) {
        if(!input.files[0]) return;
        const label = document.getElementById('up-label');
        const preview = document.getElementById('up-preview');
        label.innerText = "–ó–∞–≥—Ä—É–∑–∫–∞ —á–µ–∫–∞...";
        
        const form = new FormData();
        form.append("image", input.files[0]);
        
        try {
            const res = await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_KEY}`, { method: 'POST', body: form });
            const json = await res.json();
            if(json.success) {
                currentOrder.img = json.data.url;
                preview.src = json.data.url;
                preview.style.display = 'block';
                label.style.display = 'none';
                document.getElementById('btn-finish').disabled = false;
            }
        } catch(e) { tg.showAlert("–û—à–∏–±–∫–∞ —Å–µ—Ç–∏!"); label.innerText = "–û—à–∏–±–∫–∞! –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞"; }
    }

    function finalizeOrder() {
        const history = JSON.parse(localStorage.getItem('zik_history') || '[]');
        history.unshift({ ...currentOrder, date: new Date().toLocaleString() });
        localStorage.setItem('zik_history', JSON.stringify(history));

        const msg = `üì¶ –ó–ê–ö–ê–ó #${currentOrder.id}\n–¢–æ–≤–∞—Ä: ${currentOrder.name}\n–°—É–º–º–∞: ${currentOrder.price}‚ÇΩ\n–ß–µ–∫: ${currentOrder.img}`;
        tg.openTelegramLink(`https://t.me/${ADMIN}?text=${encodeURIComponent(msg)}`);
        tg.close();
    }

    // --- –ù–ê–°–¢–†–û–ô–ö–ò ---
    function applyDesign() {
        const cBtn = document.getElementById('cfg-color-btn').value;
        const cBg = document.getElementById('cfg-color-bg').value;
        const radius = document.getElementById('cfg-radius').value;
        const border = document.getElementById('cfg-border').value;

        document.getElementById('cfg-hex-btn').innerText = cBtn;
        document.getElementById('cfg-hex-bg').innerText = cBg;

        const root = document.documentElement;
        root.style.setProperty('--button-color', cBtn);
        root.style.setProperty('--bg-color', cBg);
        root.style.setProperty('--card-border-radius', radius + 'px');
        root.style.setProperty('--card-border-width', border + 'px');

        localStorage.setItem('zik_config', JSON.stringify({ cBtn, cBg, radius, border }));
    }

    function loadDesign() {
        const cfg = JSON.parse(localStorage.getItem('zik_config'));
        if(cfg) {
            document.getElementById('cfg-color-btn').value = cfg.cBtn;
            document.getElementById('cfg-color-bg').value = cfg.cBg;
            document.getElementById('cfg-radius').value = cfg.radius;
            document.getElementById('cfg-border').value = cfg.border;
            applyDesign();
        }
    }

    // --- –ü–†–û–§–ò–õ–¨ ---
    function refreshStats() {
        const history = JSON.parse(localStorage.getItem('zik_history') || '[]');
        const spent = history.reduce((a, b) => a + b.price, 0);
        document.getElementById('stat-deals').innerText = history.length;
        document.getElementById('stat-spent').innerText = spent + " ‚ÇΩ";

        const container = document.getElementById('history-container');
        if(history.length === 0) {
            container.innerHTML = "<p style='text-align:center; color:var(--hint-color);'>–ó–∞–∫–∞–∑–æ–≤ –Ω–µ—Ç</p>";
        } else {
            container.innerHTML = history.map(h => `
                <div class="history-item">
                    <div style="display:flex; justify-content:space-between;">
                        <b>#${h.id}</b>
                        <b style="color:var(--button-color);">${h.price} ‚ÇΩ</b>
                    </div>
                    <div style="font-size:13px; margin-top:4px;">${h.name}</div>
                    <div style="font-size:11px; color:var(--hint-color); margin-top:4px;">${h.date}</div>
                </div>
            `).join('');
        }
    }

    function openModal(id) { document.getElementById(id).classList.add('active'); }
    function closeAllModals() { document.querySelectorAll('.modal-box').forEach(m => m.classList.remove('active')); }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    const u = tg.initDataUnsafe.user;
    if(u) {
        document.getElementById('user-name').innerText = u.first_name;
        document.getElementById('user-icon').innerText = u.first_name.charAt(0);
    }

    renderCategories();
    loadDesign();
</script>
</body>
</html>

