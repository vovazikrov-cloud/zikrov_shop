<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Zikrov Shop</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg: var(--tg-theme-bg-color, #ffffff);
            --text: var(--tg-theme-text-color, #000000);
            --hint: var(--tg-theme-hint-color, #999999);
            --button: var(--tg-theme-button-color, #3390ec);
            --button-text: var(--tg-theme-button-text-color, #ffffff);
            --secondary: var(--tg-theme-secondary-bg-color, #f4f4f5);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 15px;
            padding-bottom: 80px;
        }

        /* –ë–ª–æ–∫ –ü—Ä–æ—Ñ–∏–ª—è */
        .profile-card {
            background: var(--secondary);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 20px;
            border: 1px solid rgba(0,0,0,0.05);
        }
        .profile-header { display: flex; align-items: center; gap: 12px; margin-bottom: 10px; }
        .avatar { width: 45px; height: 45px; background: var(--button); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 20px; }
        .user-info b { display: block; font-size: 16px; }
        .user-info span { font-size: 12px; color: var(--hint); }

        .history-title { font-size: 14px; font-weight: bold; margin-bottom: 5px; color: var(--text); }
        .history-list { font-size: 12px; color: var(--hint); max-height: 60px; overflow-y: auto; list-style: none; padding: 0; margin: 0; }
        .history-item { margin-bottom: 4px; border-bottom: 1px solid rgba(0,0,0,0.05); }

        /* –°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ */
        h3 { font-size: 18px; margin: 20px 0 10px 0; border-left: 4px solid var(--button); padding-left: 10px; }
        
        .product-card {
            background: var(--secondary);
            border-radius: 12px;
            padding: 12px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .product-info b { display: block; font-size: 15px; }
        .product-info span { color: var(--button); font-weight: bold; font-size: 14px; }

        .btn-add {
            background: var(--button);
            color: var(--button-text);
            border: none;
            padding: 8px 14px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
        }
    </style>
</head>
<body>

<div class="profile-card">
    <div class="profile-header">
        <div id="user-avatar" class="avatar">?</div>
        <div class="user-info">
            <b id="user-name">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</b>
            <span id="user-status">–ü–æ—Å—Ç–æ—è–Ω–Ω—ã–π –∫–ª–∏–µ–Ω—Ç</span>
        </div>
    </div>
    <div class="history-title">üïí –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø–æ–∫—É–ø–∫–∏:</div>
    <ul id="history-list" class="history-list">
        <li class="history-item">–ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞</li>
    </ul>
</div>

<h3>TG –ê–∫–∫–∞—É–Ω—Ç—ã</h3>
<div id="accs-list"></div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    // –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Telegram
    const user = tg.initDataUnsafe?.user;
    if (user) {
        document.getElementById('user-name').innerText = user.first_name + (user.last_name ? ' ' + user.last_name : '');
        document.getElementById('user-avatar').innerText = user.first_name.charAt(0);
    }

    // –°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ (–ê–∫–∫–∞—É–Ω—Ç—ã)
    const accsProducts = [
        { id: 1, name: "–ì–µ—Ä–º–∞–Ω–∏—è +49", price: 300 },
        { id: 2, name: "–ö–∞–∑–∞—Ö—Å—Ç–∞–Ω +7", price: 230 },
        { id: 3, name: "–ë—Ä–∞–∑–∏–ª–∏—è +55", price: 100 },
        { id: 4, name: "–¢—É—Ä—Ü–∏—è +90", price: 160 },
        { id: 5, name: "–í—å–µ—Ç–Ω–∞–º +84", price: 80 },
        { id: 6, name: "–ö–æ–ª—É–º–±–∏—è +57", price: 140 },
        { id: 7, name: "–ú–µ–∫—Å–∏–∫–∞ +52", price: 140 },
        { id: 8, name: "–¢–∞–π–ª–∞–Ω–¥ +66", price: 190 },
        { id: 9, name: "–ö–∞–Ω–∞–¥–∞ +1", price: 70 },
        { id: 10, name: "–ë–∞–Ω–≥–ª–∞–¥–µ—à +880", price: 90 },
        { id: 11, name: "–£–∫—Ä–∞–∏–Ω–∞ +380", price: 230 },
        { id: 12, name: "–ò–Ω–¥–∏—è +91", price: 60 },
        { id: 13, name: "–°–®–ê +1", price: 60 }
    ];

    let cart = [];

    // –ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑ –ø–∞–º—è—Ç–∏ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
    function loadHistory() {
        const history = JSON.parse(localStorage.getItem('order_history') || '[]');
        const list = document.getElementById('history-list');
        if (history.length > 0) {
            list.innerHTML = history.map(item => `<li class="history-item">${item}</li>`).join('');
        }
    }

    function renderProducts() {
        const list = document.getElementById('accs-list');
        list.innerHTML = accsProducts.map(p => `
            <div class="product-card">
                <div class="product-info">
                    <b>${p.name}</b>
                    <span>${p.price} ‚ÇΩ</span>
                </div>
                <button class="btn-add" onclick="addToCart(${p.id})">–ö—É–ø–∏—Ç—å</button>
            </div>
        `).join('');
    }

    function addToCart(id) {
        const product = accsProducts.find(p => p.id === id);
        cart.push(product);
        updateMainButton();
        tg.HapticFeedback.impactOccurred('light');
    }

    function updateMainButton() {
        if (cart.length > 0) {
            const total = cart.reduce((sum, p) => sum + p.price, 0);
            tg.MainButton.setText(`–û–ü–õ–ê–¢–ò–¢–¨: ${total} ‚ÇΩ (${cart.length} —à—Ç.)`);
            tg.MainButton.show();
        } else {
            tg.MainButton.hide();
        }
    }

    // –ö–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ "–û–ø–ª–∞—Ç–∏—Ç—å"
    tg.MainButton.onClick(() => {
        const total = cart.reduce((sum, p) => sum + p.price, 0);
        const itemsNames = cart.map(p => p.name).join(", ");
        
        // –î–æ–±–∞–≤–ª—è–µ–º –≤ –ª–æ–∫–∞–ª—å–Ω—É—é –∏—Å—Ç–æ—Ä–∏—é
        const history = JSON.parse(localStorage.getItem('order_history') || '[]');
        history.unshift(`${new Date().toLocaleDateString()}: ${itemsNames}`);
        localStorage.setItem('order_history', JSON.stringify(history.slice(0, 5))); // –•—Ä–∞–Ω–∏–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5

        const message = `üõç –ó–ê–ö–ê–ó –ê–ö–ö–ê–£–ù–¢–û–í\n\nüìã –°–ø–∏—Å–æ–∫: ${itemsNames}\nüí∞ –°—É–º–º–∞: ${total} ‚ÇΩ`;
        
        tg.sendData(message);
    });

    renderProducts();
    loadHistory();
</script>
</body>
</html>
